<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Amazon Review Recommendation System - Data Science Blog | Andrew Schultz</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://adataschultz.github.io/second-post.html">

        <meta name="author" content="Andrew Schultz" />
        <meta name="keywords" content="collaborative filtering,svd,ranking" />
        <meta name="description" content="   Recommendation systems are widely utilized in the digital age, whether it is recommending what to purchase on a website or what to watch/listen to online. They can be leveraged to increase profitability by using the information obtained from a large number of individuals to personalize the experience for an individual. They can be used to generate analytical reports containing information about products&#39; costs and profits for the business and the projected demand so the needed supply is purchased." />

        <meta property="og:site_name" content="Data Science Blog | Andrew Schultz" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Amazon Review Recommendation System"/>
        <meta property="og:url" content="https://adataschultz.github.io/second-post.html"/>
        <meta property="og:description" content="   Recommendation systems are widely utilized in the digital age, whether it is recommending what to purchase on a website or what to watch/listen to online. They can be leveraged to increase profitability by using the information obtained from a large number of individuals to personalize the experience for an individual. They can be used to generate analytical reports containing information about products&#39; costs and profits for the business and the projected demand so the needed supply is purchased."/>
        <meta property="article:published_time" content="2023-06-15" />
            <meta property="article:section" content="projects" />
            <meta property="article:tag" content="collaborative filtering" />
            <meta property="article:tag" content="svd" />
            <meta property="article:tag" content="ranking" />
            <meta property="article:author" content="Andrew Schultz" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://adataschultz.github.io/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://adataschultz.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://adataschultz.github.io/theme/css/pygments/default.css" rel="stylesheet">
    <link rel="stylesheet" href="https://adataschultz.github.io/theme/css/style.css" type="text/css"/>

        <link href="https://adataschultz.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Data Science Blog | Andrew Schultz ATOM Feed"/>

        <link href="https://adataschultz.github.io/feeds/projects.atom.xml" type="application/atom+xml" rel="alternate"
              title="Data Science Blog | Andrew Schultz projects ATOM Feed"/>
</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://adataschultz.github.io/" class="navbar-brand">
Data Science Blog | Andrew Schultz            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/archives.html">Archives</a></li>
                    <li><a href="/tags.html">Tags</a></li>
                         <li><a href="https://adataschultz.github.io/about/">
                             About Me
                          </a></li>
                        <li class="active">
                            <a href="https://adataschultz.github.io/category/projects.html">Projects</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://adataschultz.github.io/second-post.html"
                       rel="bookmark"
                       title="Permalink to Amazon Review Recommendation System">
                        Amazon Review Recommendation System
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2023-06-15T00:00:00-04:00"> Thu 15 June 2023</time>
    </span>



        <span class="label label-default">Category</span>
        <a href="https://adataschultz.github.io/category/projects.html">projects</a>


<span class="label label-default">Tags</span>
	<a href="https://adataschultz.github.io/tag/collaborative-filtering.html">collaborative filtering</a>
        /
	<a href="https://adataschultz.github.io/tag/svd.html">svd</a>
        /
	<a href="https://adataschultz.github.io/tag/ranking.html">ranking</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <style type="text/css">/*!
*
* IPython notebook
*
*/
/* CSS font colors for translated ANSI escape sequences */
/* The color values are a mix of
   http://www.xcolors.net/dl/baskerville-ivorylight and
   http://www.xcolors.net/dl/euphrasia */
.ansi-black-fg {
  color: #3E424D;
}
.ansi-black-bg {
  background-color: #3E424D;
}
.ansi-black-intense-fg {
  color: #282C36;
}
.ansi-black-intense-bg {
  background-color: #282C36;
}
.ansi-red-fg {
  color: #E75C58;
}
.ansi-red-bg {
  background-color: #E75C58;
}
.ansi-red-intense-fg {
  color: #B22B31;
}
.ansi-red-intense-bg {
  background-color: #B22B31;
}
.ansi-green-fg {
  color: #00A250;
}
.ansi-green-bg {
  background-color: #00A250;
}
.ansi-green-intense-fg {
  color: #007427;
}
.ansi-green-intense-bg {
  background-color: #007427;
}
.ansi-yellow-fg {
  color: #DDB62B;
}
.ansi-yellow-bg {
  background-color: #DDB62B;
}
.ansi-yellow-intense-fg {
  color: #B27D12;
}
.ansi-yellow-intense-bg {
  background-color: #B27D12;
}
.ansi-blue-fg {
  color: #208FFB;
}
.ansi-blue-bg {
  background-color: #208FFB;
}
.ansi-blue-intense-fg {
  color: #0065CA;
}
.ansi-blue-intense-bg {
  background-color: #0065CA;
}
.ansi-magenta-fg {
  color: #D160C4;
}
.ansi-magenta-bg {
  background-color: #D160C4;
}
.ansi-magenta-intense-fg {
  color: #A03196;
}
.ansi-magenta-intense-bg {
  background-color: #A03196;
}
.ansi-cyan-fg {
  color: #60C6C8;
}
.ansi-cyan-bg {
  background-color: #60C6C8;
}
.ansi-cyan-intense-fg {
  color: #258F8F;
}
.ansi-cyan-intense-bg {
  background-color: #258F8F;
}
.ansi-white-fg {
  color: #C5C1B4;
}
.ansi-white-bg {
  background-color: #C5C1B4;
}
.ansi-white-intense-fg {
  color: #A1A6B2;
}
.ansi-white-intense-bg {
  background-color: #A1A6B2;
}
.ansi-default-inverse-fg {
  color: #FFFFFF;
}
.ansi-default-inverse-bg {
  background-color: #000000;
}
.ansi-bold {
  font-weight: bold;
}
.ansi-underline {
  text-decoration: underline;
}
/* The following styles are deprecated an will be removed in a future version */
.ansibold {
  font-weight: bold;
}
.ansi-inverse {
  outline: 0.5px dotted;
}
/* use dark versions for foreground, to improve visibility */
.ansiblack {
  color: black;
}
.ansired {
  color: darkred;
}
.ansigreen {
  color: darkgreen;
}
.ansiyellow {
  color: #c4a000;
}
.ansiblue {
  color: darkblue;
}
.ansipurple {
  color: darkviolet;
}
.ansicyan {
  color: steelblue;
}
.ansigray {
  color: gray;
}
/* and light for background, for the same reason */
.ansibgblack {
  background-color: black;
}
.ansibgred {
  background-color: red;
}
.ansibggreen {
  background-color: green;
}
.ansibgyellow {
  background-color: yellow;
}
.ansibgblue {
  background-color: blue;
}
.ansibgpurple {
  background-color: magenta;
}
.ansibgcyan {
  background-color: cyan;
}
.ansibggray {
  background-color: gray;
}
div.cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border-radius: 2px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  border-width: 1px;
  border-style: solid;
  border-color: transparent;
  width: 100%;
  padding: 5px;
  /* This acts as a spacer between cells, that is outside the border */
  margin: 0px;
  outline: none;
  position: relative;
  overflow: visible;
}
div.cell:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: transparent;
}
div.cell.jupyter-soft-selected {
  border-left-color: #E3F2FD;
  border-left-width: 1px;
  padding-left: 5px;
  border-right-color: #E3F2FD;
  border-right-width: 1px;
  background: #E3F2FD;
}
@media print {
  div.cell.jupyter-soft-selected {
    border-color: transparent;
  }
}
div.cell.selected,
div.cell.selected.jupyter-soft-selected {
  border-color: #ababab;
}
div.cell.selected:before,
div.cell.selected.jupyter-soft-selected:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: #42A5F5;
}
@media print {
  div.cell.selected,
  div.cell.selected.jupyter-soft-selected {
    border-color: transparent;
  }
}
.edit_mode div.cell.selected {
  border-color: #66BB6A;
}
.edit_mode div.cell.selected:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: #66BB6A;
}
@media print {
  .edit_mode div.cell.selected {
    border-color: transparent;
  }
}
.prompt {
  /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */
  min-width: 14ex;
  /* This padding is tuned to match the padding on the CodeMirror editor. */
  padding: 0.4em;
  margin: 0px;
  font-family: monospace;
  text-align: right;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
  /* Don't highlight prompt number selection */
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Use default cursor */
  cursor: default;
}
@media (max-width: 540px) {
  .prompt {
    text-align: left;
  }
}
div.inner_cell {
  min-width: 0;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_area {
  border: 1px solid #cfcfcf;
  border-radius: 2px;
  background: #f7f7f7;
  line-height: 1.21429em;
}
/* This is needed so that empty prompt areas can collapse to zero height when there
   is no content in the output_subarea and the prompt. The main purpose of this is
   to make sure that empty JavaScript output_subareas have no height. */
div.prompt:empty {
  padding-top: 0;
  padding-bottom: 0;
}
div.unrecognized_cell {
  padding: 5px 5px 5px 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.unrecognized_cell .inner_cell {
  border-radius: 2px;
  padding: 5px;
  font-weight: bold;
  color: red;
  border: 1px solid #cfcfcf;
  background: #eaeaea;
}
div.unrecognized_cell .inner_cell a {
  color: inherit;
  text-decoration: none;
}
div.unrecognized_cell .inner_cell a:hover {
  color: inherit;
  text-decoration: none;
}
@media (max-width: 540px) {
  div.unrecognized_cell > div.prompt {
    display: none;
  }
}
div.code_cell {
  /* avoid page breaking on code cells when printing */
}
@media print {
  div.code_cell {
    page-break-inside: avoid;
  }
}
/* any special styling for code cells that are currently running goes here */
div.input {
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.input {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_prompt {
  color: #303F9F;
  border-top: 1px solid transparent;
}
div.input_area > div.highlight {
  margin: 0.4em;
  border: none;
  padding: 0px;
  background-color: transparent;
}
div.input_area > div.highlight > pre {
  margin: 0px;
  border: none;
  padding: 0px;
  background-color: transparent;
}
/* The following gets added to the <head> if it is detected that the user has a
 * monospace font with inconsistent normal/bold/italic height.  See
 * notebookmain.js.  Such fonts will have keywords vertically offset with
 * respect to the rest of the text.  The user should select a better font.
 * See: https://github.com/ipython/ipython/issues/1503
 *
 * .CodeMirror span {
 *      vertical-align: bottom;
 * }
 */
.CodeMirror {
  line-height: 1.21429em;
  /* Changed from 1em to our global default */
  font-size: 14px;
  height: auto;
  /* Changed to auto to autogrow */
  background: none;
  /* Changed from white to allow our bg to show through */
}
.CodeMirror-scroll {
  /*  The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/
  /*  We have found that if it is visible, vertical scrollbars appear with font size changes.*/
  overflow-y: hidden;
  overflow-x: auto;
}
.CodeMirror-lines {
  /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */
  /* we have set a different line-height and want this to scale with that. */
  /* Note that this should set vertical padding only, since CodeMirror assumes
       that horizontal padding will be set on CodeMirror pre */
  padding: 0.4em 0;
}
.CodeMirror-linenumber {
  padding: 0 8px 0 4px;
}
.CodeMirror-gutters {
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.CodeMirror pre {
  /* In CM3 this went to 4px from 0 in CM2. This sets horizontal padding only,
    use .CodeMirror-lines for vertical */
  padding: 0 0.4em;
  border: 0;
  border-radius: 0;
}
.CodeMirror-cursor {
  border-left: 1.4px solid black;
}
@media screen and (min-width: 2138px) and (max-width: 4319px) {
  .CodeMirror-cursor {
    border-left: 2px solid black;
  }
}
@media screen and (min-width: 4320px) {
  .CodeMirror-cursor {
    border-left: 4px solid black;
  }
}
/*

Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org>
Adapted from GitHub theme

*/
.highlight-base {
  color: #000;
}
.highlight-variable {
  color: #000;
}
.highlight-variable-2 {
  color: #1a1a1a;
}
.highlight-variable-3 {
  color: #333333;
}
.highlight-string {
  color: #BA2121;
}
.highlight-comment {
  color: #408080;
  font-style: italic;
}
.highlight-number {
  color: #080;
}
.highlight-atom {
  color: #88F;
}
.highlight-keyword {
  color: #008000;
  font-weight: bold;
}
.highlight-builtin {
  color: #008000;
}
.highlight-error {
  color: #f00;
}
.highlight-operator {
  color: #AA22FF;
  font-weight: bold;
}
.highlight-meta {
  color: #AA22FF;
}
/* previously not defined, copying from default codemirror */
.highlight-def {
  color: #00f;
}
.highlight-string-2 {
  color: #f50;
}
.highlight-qualifier {
  color: #555;
}
.highlight-bracket {
  color: #997;
}
.highlight-tag {
  color: #170;
}
.highlight-attribute {
  color: #00c;
}
.highlight-header {
  color: blue;
}
.highlight-quote {
  color: #090;
}
.highlight-link {
  color: #00c;
}
/* apply the same style to codemirror */
.cm-s-ipython span.cm-keyword {
  color: #008000;
  font-weight: bold;
}
.cm-s-ipython span.cm-atom {
  color: #88F;
}
.cm-s-ipython span.cm-number {
  color: #080;
}
.cm-s-ipython span.cm-def {
  color: #00f;
}
.cm-s-ipython span.cm-variable {
  color: #000;
}
.cm-s-ipython span.cm-operator {
  color: #AA22FF;
  font-weight: bold;
}
.cm-s-ipython span.cm-variable-2 {
  color: #1a1a1a;
}
.cm-s-ipython span.cm-variable-3 {
  color: #333333;
}
.cm-s-ipython span.cm-comment {
  color: #408080;
  font-style: italic;
}
.cm-s-ipython span.cm-string {
  color: #BA2121;
}
.cm-s-ipython span.cm-string-2 {
  color: #f50;
}
.cm-s-ipython span.cm-meta {
  color: #AA22FF;
}
.cm-s-ipython span.cm-qualifier {
  color: #555;
}
.cm-s-ipython span.cm-builtin {
  color: #008000;
}
.cm-s-ipython span.cm-bracket {
  color: #997;
}
.cm-s-ipython span.cm-tag {
  color: #170;
}
.cm-s-ipython span.cm-attribute {
  color: #00c;
}
.cm-s-ipython span.cm-header {
  color: blue;
}
.cm-s-ipython span.cm-quote {
  color: #090;
}
.cm-s-ipython span.cm-link {
  color: #00c;
}
.cm-s-ipython span.cm-error {
  color: #f00;
}
.cm-s-ipython span.cm-tab {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=);
  background-position: right;
  background-repeat: no-repeat;
}
div.output_wrapper {
  /* this position must be relative to enable descendents to be absolute within it */
  position: relative;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  z-index: 1;
}
/* class for the output area when it should be height-limited */
div.output_scroll {
  /* ideally, this would be max-height, but FF barfs all over that */
  height: 24em;
  /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */
  width: 100%;
  overflow: auto;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  display: block;
}
/* output div while it is collapsed */
div.output_collapsed {
  margin: 0px;
  padding: 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
div.out_prompt_overlay {
  height: 100%;
  padding: 0px 0.4em;
  position: absolute;
  border-radius: 2px;
}
div.out_prompt_overlay:hover {
  /* use inner shadow to get border that is computed the same on WebKit/FF */
  -webkit-box-shadow: inset 0 0 1px #000;
  box-shadow: inset 0 0 1px #000;
  background: rgba(240, 240, 240, 0.5);
}
div.output_prompt {
  color: #D84315;
}
/* This class is the outer container of all output sections. */
div.output_area {
  padding: 0px;
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.output_area .MathJax_Display {
  text-align: left !important;
}
div.output_area 
div.output_area 
div.output_area img,
div.output_area svg {
  max-width: 100%;
  height: auto;
}
div.output_area img.unconfined,
div.output_area svg.unconfined {
  max-width: none;
}
div.output_area .mglyph > img {
  max-width: none;
}
/* This is needed to protect the pre formating from global settings such
   as that of bootstrap */
.output {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.output_area {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
div.output_area pre {
  margin: 0;
  padding: 1px 0 1px 0;
  border: 0;
  vertical-align: baseline;
  color: black;
  background-color: transparent;
  border-radius: 0;
}
/* This class is for the output subarea inside the output_area and after
   the prompt div. */
div.output_subarea {
  overflow-x: auto;
  padding: 0.4em;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
  max-width: calc(100% - 14ex);
}
div.output_scroll div.output_subarea {
  overflow-x: visible;
}
/* The rest of the output_* classes are for special styling of the different
   output types */
/* all text output has this class: */
div.output_text {
  text-align: left;
  color: #000;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
}
/* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */
div.output_stderr {
  background: #fdd;
  /* very light red background for stderr */
}
div.output_latex {
  text-align: left;
}
/* Empty output_javascript divs should have no height */
div.output_javascript:empty {
  padding: 0;
}
.js-error {
  color: darkred;
}
/* raw_input styles */
div.raw_input_container {
  line-height: 1.21429em;
  padding-top: 5px;
}
pre.raw_input_prompt {
  /* nothing needed here. */
}
input.raw_input {
  font-family: monospace;
  font-size: inherit;
  color: inherit;
  width: auto;
  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;
  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0em 0.25em;
  margin: 0em 0.25em;
}
input.raw_input:focus {
  box-shadow: none;
}
p.p-space {
  margin-bottom: 10px;
}
div.output_unrecognized {
  padding: 5px;
  font-weight: bold;
  color: red;
}
div.output_unrecognized a {
  color: inherit;
  text-decoration: none;
}
div.output_unrecognized a:hover {
  color: inherit;
  text-decoration: none;
}
.rendered_html {
  color: #000;
  /* any extras will just be numbers: */
}



.rendered_html :link {
  text-decoration: underline;
}
.rendered_html :visited {
  text-decoration: underline;
}






.rendered_html h1:first-child {
  margin-top: 0.538em;
}
.rendered_html h2:first-child {
  margin-top: 0.636em;
}
.rendered_html h3:first-child {
  margin-top: 0.777em;
}
.rendered_html h4:first-child {
  margin-top: 1em;
}
.rendered_html h5:first-child {
  margin-top: 1em;
}
.rendered_html h6:first-child {
  margin-top: 1em;
}
.rendered_html ul:not(.list-inline),
.rendered_html ol:not(.list-inline) {
  padding-left: 2em;
}








.rendered_html * + ul {
  margin-top: 1em;
}
.rendered_html * + ol {
  margin-top: 1em;
}





.rendered_html pre,




.rendered_html tr,
.rendered_html th,


.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
.rendered_html * + table {
  margin-top: 1em;
}

.rendered_html * + p {
  margin-top: 1em;
}

.rendered_html * + img {
  margin-top: 1em;
}
.rendered_html img,

.rendered_html img.unconfined,


.rendered_html * + .alert {
  margin-top: 1em;
}
[dir="rtl"] 
div.text_cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.text_cell > div.prompt {
    display: none;
  }
}
div.text_cell_render {
  /*font-family: "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;*/
  outline: none;
  resize: none;
  width: inherit;
  border-style: none;
  padding: 0.5em 0.5em 0.5em 0.4em;
  color: #000;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
a.anchor-link:link {
  text-decoration: none;
  padding: 0px 20px;
  visibility: hidden;
}
h1:hover .anchor-link,
h2:hover .anchor-link,
h3:hover .anchor-link,
h4:hover .anchor-link,
h5:hover .anchor-link,
h6:hover .anchor-link {
  visibility: visible;
}
.text_cell.rendered .input_area {
  display: none;
}
.text_cell.rendered 
.text_cell.rendered .rendered_html tr,
.text_cell.rendered .rendered_html th,
.text_cell.rendered 
.text_cell.unrendered .text_cell_render {
  display: none;
}
.text_cell .dropzone .input_area {
  border: 2px dashed #bababa;
  margin: -1px;
}
.cm-header-1,
.cm-header-2,
.cm-header-3,
.cm-header-4,
.cm-header-5,
.cm-header-6 {
  font-weight: bold;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
.cm-header-1 {
  font-size: 185.7%;
}
.cm-header-2 {
  font-size: 157.1%;
}
.cm-header-3 {
  font-size: 128.6%;
}
.cm-header-4 {
  font-size: 110%;
}
.cm-header-5 {
  font-size: 100%;
  font-style: italic;
}
.cm-header-6 {
  font-size: 100%;
  font-style: italic;
}
</style>
<style type="text/css">pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #f8f8f8; }
.highlight .c { color: #3D7B7B; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #9C6500 } /* Comment.Preproc */
.highlight .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.highlight .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight .gr { color: #E40000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #008400 } /* Generic.Inserted */
.highlight .go { color: #717171 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #687822 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #717171; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #767600 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #A45A77 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style></head><body><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Recommendation systems are widely utilized in the digital age, whether it is recommending what to purchase on a website or what to watch/listen to online. They can be leveraged to increase profitability by using the information obtained from a large number of individuals to personalize the experience for an individual. They can be used to generate analytical reports containing information about products' costs and profits for the business and the projected demand so the needed supply is purchased. <font></font></font></p>
<p>   <font size="4">In this project, the user ratings from a subset of Amazon Reviews are used to train different recommendation systems which evaluate various algorithms. The models return a list of recommended items based on the reviewer's previous actions.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Data"><code>Data</code><a class="anchor-link" href="#Data">¶</a></h1><p>   <font size="4">The <code>Movies_and_TV</code> ratings data was retrieved from <a href="https://jmcauley.ucsd.edu/data/amazon/">Recommender Systems and Personalization Datasets</a>. This includes (item, user, rating, timestamp) tuples. A subset of the data was used in the analysis due to constraints of sparcity for computations.<font></font></font></p>
<h1 id="Preprocessing"><code>Preprocessing</code><a class="anchor-link" href="#Preprocessing">¶</a></h1><p>   <font size="4">The code that was used for preprocessing and EDA can be found <a href="https://github.com/adataschultz/RecSys/blob/main/Notebooks_Scripts/">Recommender System Github repository</a>. First, the environment is set up with the dependencies, library options, the seed for reproducibility, and setting the location of the project directory. Then the data is read, duplicate observations dropped and columns named.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">os</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">random</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">warnings</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></span>
<span class="code-line"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_columns'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></span>
<span class="code-line"><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_rows'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">seed_value</span> <span class="o">=</span> <span class="mi">42</span></span>
<span class="code-line"><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'Recommender'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seed_value</span><span class="p">)</span></span>
<span class="code-line"><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed_value</span><span class="p">)</span></span>
<span class="code-line"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed_value</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'Movies_and_TV.csv'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span></span>
<span class="code-line">                 <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'item'</span><span class="p">,</span> <span class="s1">'reviewerID'</span><span class="p">,</span> <span class="s1">'rating'</span><span class="p">,</span> <span class="s1">'timestamp'</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Sample observations:'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Sample observations:</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe table-striped table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>item</th>
<th>reviewerID</th>
<th>rating</th>
<th>timestamp</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0001527665</td>
<td>A2VHSG6TZHU1OB</td>
<td>5.0</td>
<td>1361145600</td>
</tr>
<tr>
<th>1</th>
<td>0001527665</td>
<td>A23EJWOW1TLENE</td>
<td>5.0</td>
<td>1358380800</td>
</tr>
<tr>
<th>2</th>
<td>0001527665</td>
<td>A1KM9FNEJ8Q171</td>
<td>5.0</td>
<td>1357776000</td>
</tr>
<tr>
<th>3</th>
<td>0001527665</td>
<td>A38LY2SSHVHRYB</td>
<td>4.0</td>
<td>1356480000</td>
</tr>
<tr>
<th>4</th>
<td>0001527665</td>
<td>AHTYUW2H1276L</td>
<td>5.0</td>
<td>1353024000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Then a function <code>data_summary</code> is defined to examine the data for the number of missing observations, data types and the amount of unique values in the initial set. The <code>timestamp</code> variable is dropped since it will not be used.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">data_summary</span><span class="p">(</span><span class="n">df</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="s1">'Number of Rows: </span><span class="si">{}</span><span class="s1">, Columns: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span></span>
<span class="code-line">    <span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></span>
<span class="code-line">    <span class="n">a</span><span class="p">[</span><span class="s1">'Number of Missing Values'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></span>
<span class="code-line">    <span class="n">a</span><span class="p">[</span><span class="s1">'Data type of variable'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dtypes</span></span>
<span class="code-line">    <span class="n">a</span><span class="p">[</span><span class="s1">'Number of Unique Values'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Initial Data Summary:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">data_summary</span><span class="p">(</span><span class="n">df</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'timestamp'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Initial Data Summary:</span>
<span class="code-line">Number of Rows: 8522125, Columns: 4</span>
<span class="code-line">            Number of Missing Values Data type of variable  \</span>
<span class="code-line">item                               0                object   </span>
<span class="code-line">reviewerID                         0                object   </span>
<span class="code-line">rating                             0               float64   </span>
<span class="code-line">timestamp                          0                 int64   </span>
<span class="code-line"></span>
<span class="code-line">            Number of Unique Values  </span>
<span class="code-line">item                         182032  </span>
<span class="code-line">reviewerID                  3826085  </span>
<span class="code-line">rating                            5  </span>
<span class="code-line">timestamp                      7476  </span>
<span class="code-line">None</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><font size="4">The top 10 items in the initial set shows the highest item has 24,554 ratings while the 10th highest items has 14,174 ratings. <font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">items_top10</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'item'</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Items with highest number of ratings in initial set:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">items_top10</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Items with highest number of ratings in initial set:</span>
<span class="code-line">item</span>
<span class="code-line">B00YSG2ZPA    24554</span>
<span class="code-line">B00006CXSS    24485</span>
<span class="code-line">B00AQVMZKQ    21015</span>
<span class="code-line">B01BHTSIOC    20889</span>
<span class="code-line">B00NAQ3EOK    16857</span>
<span class="code-line">6305837325    16671</span>
<span class="code-line">B00WNBABVC    15205</span>
<span class="code-line">B017S3OP7A    14795</span>
<span class="code-line">B009934S5M    14481</span>
<span class="code-line">B00FL31UF0    14174</span>
<span class="code-line">dtype: int64</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><font size="4">The top 10 reviewers with the most number of ratings in the initial set shows that they have over 1,600 reviews.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">reviewers_top10</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'reviewerID'</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Reviewers with highest number of ratings in initial set:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">reviewers_top10</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Reviewers with highest number of ratings in initial set:</span>
<span class="code-line">reviewerID</span>
<span class="code-line">AV6QDP8Q0ONK4     4101</span>
<span class="code-line">A1GGOC9PVDXW7Z    2114</span>
<span class="code-line">ABO2ZI2Y5DQ9T     2073</span>
<span class="code-line">A328S9RN3U5M68    2059</span>
<span class="code-line">A3MV1KKHX51FYT    1989</span>
<span class="code-line">A2EDZH51XHFA9B    1842</span>
<span class="code-line">A3LZGLA88K0LA0    1814</span>
<span class="code-line">A16CZRQL23NOIW    1808</span>
<span class="code-line">AIMR915K4YCN      1719</span>
<span class="code-line">A2NJO6YE954DBH    1699</span>
<span class="code-line">dtype: int64</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><font size="4">Since the data is sparse, a new integer id is created for <code>item</code> rather the initial string variable. <font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">value_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'item'</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">value_counts</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df1</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'item_unique'</span><span class="p">,</span> <span class="s1">'counts'</span><span class="p">]</span></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df1</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'index'</span><span class="p">:</span> <span class="s1">'item_id'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'counts'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'left'</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'item'</span><span class="p">],</span></span>
<span class="code-line">              <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'item_unique'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'item_unique'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">value_counts</span><span class="p">,</span> <span class="n">df1</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">The same process is used for <code>reviewerID</code>. A key is created for merging the new integer variables that later be used to join the original data. For this set, the unnecessary keys are then dropped.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">value_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'reviewerID'</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">value_counts</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df1</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'id_unique'</span><span class="p">,</span> <span class="s1">'counts'</span><span class="p">]</span></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df1</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'index'</span><span class="p">:</span> <span class="s1">'reviewer_id'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'counts'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'left'</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewerID'</span><span class="p">],</span></span>
<span class="code-line">              <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'id_unique'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'id_unique'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">value_counts</span><span class="p">,</span> <span class="n">df1</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'item'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'reviewerID'</span><span class="p">,</span> <span class="s1">'reviewer_id'</span><span class="p">]]</span></span>
<span class="code-line"><span class="n">df1</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">'Movies_and_TV_idMatch.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">df1</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">The data is then filtered to reviewers who have greater than or equal to 25 ratings/reviews due to sparsity. This results in a set containing 1,114,877 ratings with 19,702 unique reviewers and 103,687 unique items. The majority of items are rated 5 star.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">reviewer_count</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reviewerID</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">reviewerID</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">reviewer_count</span><span class="p">[</span><span class="n">reviewer_count</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">reviewer_count</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'- Number of ratings after filtering: '</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'- Number of unique reviewers: '</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">'reviewerID'</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'- Number of unique items: '</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">'itemID'</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">())</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span></span>
<span class="code-line">  <span class="nb">print</span><span class="p">(</span><span class="s1">'- Number of items with </span><span class="si">{0}</span><span class="s1"> rating = </span><span class="si">{1}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span></span>
<span class="code-line">                                                         <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">- Number of ratings after filtering:  1114877</span>
<span class="code-line">- Number of unique reviewers:  19702</span>
<span class="code-line">- Number of unique items:  103731</span>
<span class="code-line">- Number of items with 1 rating = 59576</span>
<span class="code-line">- Number of items with 2 rating = 65630</span>
<span class="code-line">- Number of items with 3 rating = 141579</span>
<span class="code-line">- Number of items with 4 rating = 252845</span>
<span class="code-line">- Number of items with 5 rating = 595247</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">The top 10 items in the filtered set shows a large reduction with the highest item reducing from 24,554 to 1,136 ratings for the highest item while the 10th highest item reducing from 14,174 to 853 ratings. <font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">items_top10</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'item'</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Items with highest number of ratings in the filtered set:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">items_top10</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Items with highest number of ratings in the filtered set:</span>
<span class="code-line">item</span>
<span class="code-line">B009934S5M    1136</span>
<span class="code-line">B00PY4Q9OS    1042</span>
<span class="code-line">B00R8GUXPG    1040</span>
<span class="code-line">B00Q0G2VXM    1040</span>
<span class="code-line">B00NYC65M8     965</span>
<span class="code-line">B00OV3VGP0     903</span>
<span class="code-line">B00DY64A3U     895</span>
<span class="code-line">B00D91GRA4     870</span>
<span class="code-line">B0059XTU3G     860</span>
<span class="code-line">B005LAIHY0     853</span>
<span class="code-line">dtype: int64</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">The top 10 reviewers in the filtered set reduced from 4,101 to 3,981 ratings, while the 10th highest item reducing from 1,699 to 1,634 ratings.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">reviewers_top10</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'reviewerID'</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Reviewers with highest number of ratings in the filtered set:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">reviewers_top10</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Reviewers with highest number of ratings in the filtered set:</span>
<span class="code-line">reviewerID</span>
<span class="code-line">AV6QDP8Q0ONK4     3981</span>
<span class="code-line">ABO2ZI2Y5DQ9T     2068</span>
<span class="code-line">A328S9RN3U5M68    1997</span>
<span class="code-line">A3MV1KKHX51FYT    1986</span>
<span class="code-line">A2EDZH51XHFA9B    1838</span>
<span class="code-line">A3LZGLA88K0LA0    1811</span>
<span class="code-line">A16CZRQL23NOIW    1797</span>
<span class="code-line">A1GGOC9PVDXW7Z    1733</span>
<span class="code-line">AIMR915K4YCN      1706</span>
<span class="code-line">A20EEWWSFMZ1PN    1634</span>
<span class="code-line">dtype: int64</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Item-item-collaborative-filtering"><code>Item-item collaborative filtering</code><a class="anchor-link" href="#Item-item-collaborative-filtering">¶</a></h2><p>   <font size="4">Item-item collaborative filtering is one kind of recommendation method which looks for similar items based on the items users have already liked or positively interacted with. How IBCF works is that it suggests an item based on items the user has previously consumed. It looks for the items the user has consumed then it finds other items similar to consumed items and recommends accordingly.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Collaborative-Filtering-in-Tensorflow"><code>Collaborative Filtering in Tensorflow</code><a class="anchor-link" href="#Collaborative-Filtering-in-Tensorflow">¶</a></h1><p>   <font size="4">Let's first set up the environment by importing the necessary packages and examining the <code>CUDA and NVIDIA GPU Information</code> as well as the <code>Tensorflow</code> and <code>Keras</code> versions for the runtime. To set the seed for reproducibility, we can use a function <code>init_seeds</code> that defines the <code>random</code>, <code>numpy</code> and <code>tensorflow</code> seed as well as the environment and session.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'CUDA and NVIDIA GPU Information'</span><span class="p">)</span></span>
<span class="code-line"><span class="o">!</span>/usr/local/cuda/bin/nvcc<span class="w"> </span>--version</span>
<span class="code-line"><span class="o">!</span>nvidia-smi</span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'TensorFlow version: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Eager execution is: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">()))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Keras version: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Num GPUs Available: '</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s1">'GPU'</span><span class="p">)))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">CUDA and NVIDIA GPU Information</span>
<span class="code-line">nvcc: NVIDIA (R) Cuda compiler driver</span>
<span class="code-line">Copyright (c) 2005-2021 NVIDIA Corporation</span>
<span class="code-line">Built on Sun_Feb_14_21:12:58_PST_2021</span>
<span class="code-line">Cuda compilation tools, release 11.2, V11.2.152</span>
<span class="code-line">Build cuda_11.2.r11.2/compiler.29618528_0</span>
<span class="code-line">Mon Jan  9 22:34:20 2023       </span>
<span class="code-line">+-----------------------------------------------------------------------------+</span>
<span class="code-line">| NVIDIA-SMI 460.32.03    Driver Version: 460.32.03    CUDA Version: 11.2     |</span>
<span class="code-line">|-------------------------------+----------------------+----------------------+</span>
<span class="code-line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span>
<span class="code-line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span>
<span class="code-line">|                               |                      |               MIG M. |</span>
<span class="code-line">|===============================+======================+======================|</span>
<span class="code-line">|   0  Tesla T4            Off  | 00000000:00:04.0 Off |                    0 |</span>
<span class="code-line">| N/A   44C    P0    25W /  70W |      0MiB / 15109MiB |      0%      Default |</span>
<span class="code-line">|                               |                      |                  N/A |</span>
<span class="code-line">+-------------------------------+----------------------+----------------------+</span>
<span class="code-line">                                                                               </span>
<span class="code-line">+-----------------------------------------------------------------------------+</span>
<span class="code-line">| Processes:                                                                  |</span>
<span class="code-line">|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |</span>
<span class="code-line">|        ID   ID                                                   Usage      |</span>
<span class="code-line">|=============================================================================|</span>
<span class="code-line">|  No running processes found                                                 |</span>
<span class="code-line">+-----------------------------------------------------------------------------+</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">TensorFlow version: 2.9.2</span>
<span class="code-line">Eager execution is: True</span>
<span class="code-line">Keras version: 2.9.0</span>
<span class="code-line">Num GPUs Available:  1</span>
<span class="code-line"></span>
<span class="code-line"></span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">init_seeds</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span></span>
<span class="code-line">    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">session_conf</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">ConfigProto</span><span class="p">()</span></span>
<span class="code-line">    <span class="n">session_conf</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">ConfigProto</span><span class="p">(</span><span class="n">intra_op_parallelism_threads</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span></span>
<span class="code-line">                                            <span class="n">inter_op_parallelism_threads</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'AmazonReviews_RecSysDL'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'TF_CUDNN_DETERMINISTIC'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'True'</span></span>
<span class="code-line">    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'TF_DETERMINISTIC_OPS'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'True'</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">get_default_graph</span><span class="p">(),</span></span>
<span class="code-line">                                <span class="n">config</span><span class="o">=</span><span class="n">session_conf</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">set_session</span><span class="p">(</span><span class="n">sess</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">sess</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">init_seeds</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">&lt;tensorflow.python.client.session.Session at 0x7fab7f7b9e80&gt;</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now, we can use the <code>LabelEncoder</code> to encode  <code>reviewerID</code> and <code>itemID</code> and create sets containing the unique users and items. Then, we can create minimum and maximum rating variables and set the number of factors (50) to be considered in the model. Let's examine the number of unique items and users as well as the minimum and maximum rating:</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">user_encode</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_encode</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'reviewerID'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></span>
<span class="code-line"><span class="n">n_users</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">item_encode</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df</span><span class="p">[</span><span class="s1">'Item'</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_encode</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'itemID'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></span>
<span class="code-line"><span class="n">n_items</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Item'</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df</span><span class="p">[</span><span class="s1">'stars'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">min_rating</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'stars'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">max_rating</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'stars'</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">n_factors</span> <span class="o">=</span> <span class="mi">50</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Number of unique items:'</span><span class="p">,</span> <span class="n">n_items</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Number of unique users:'</span><span class="p">,</span> <span class="n">n_users</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Minimum rating:'</span><span class="p">,</span> <span class="n">min_rating</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Maximum rating:'</span><span class="p">,</span> <span class="n">max_rating</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Number of unique items: 103731</span>
<span class="code-line">Number of unique users: 19702</span>
<span class="code-line">Minimum rating: 1.0</span>
<span class="code-line">Maximum rating: 5.0</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">There are more unique items than the number of users and the minimum rating is 1 while the maximum rating is 5. Let's now set up the train/test sets using a <code>test_size=0.2</code> and examine the number of observations in each set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'user'</span><span class="p">,</span> <span class="s1">'Item'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span></span>
<span class="code-line"><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'stars'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span></span>
<span class="code-line">                                                    <span class="n">random_state</span><span class="o">=</span><span class="n">seed_value</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Train data split:'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Eval data split:'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">X_train_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]]</span></span>
<span class="code-line"><span class="n">X_test_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_test</span><span class="p">[:</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]]</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Train data split: 891901</span>
<span class="code-line">Eval data split: 222976</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's now set up the model architecture by creating the <code>EmbeddingLayer</code> class with the items and number of factors as the input containing <code>embeddings_initializer='he_normal'</code> and <code>embeddings_regularizer=l2(1e-6)</code>, which is then reshaped.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Embedding</span><span class="p">,</span> <span class="n">Reshape</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">keras.regularizers</span> <span class="kn">import</span> <span class="n">l2</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">class</span> <span class="nc">EmbeddingLayer</span><span class="p">:</span></span>
<span class="code-line">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_items</span><span class="p">,</span> <span class="n">n_factors</span><span class="p">):</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="n">n_items</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">n_factors</span> <span class="o">=</span> <span class="n">n_factors</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span></span>
<span class="code-line">        <span class="n">x</span> <span class="o">=</span> <span class="n">Embedding</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_items</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_factors</span><span class="p">,</span></span>
<span class="code-line">                      <span class="n">embeddings_initializer</span><span class="o">=</span><span class="s1">'he_normal'</span><span class="p">,</span></span>
<span class="code-line">                      <span class="n">embeddings_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">))(</span><span class="n">x</span><span class="p">)</span></span>
<span class="code-line">        <span class="n">x</span> <span class="o">=</span> <span class="n">Reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_factors</span><span class="p">,))(</span><span class="n">x</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="k">return</span> <span class="n">x</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can define the <code>Recommender</code> function to set up the model architecture with the input containing the created unique <code>n_users</code>, unique <code>n_items</code>, the defined <code>n_factors</code>, <code>min_rating</code> and <code>max_rating</code>. The user and item embeddings can be concatenated, then 5% <code>Dropout</code>, <code>Dense</code> layer with 10 nodes using the <code>kernel_initializer='he_normal'</code>, which draws samples from a truncated normal distribution, followed by a <code>relu</code> activation function and 20% <code>Dropout</code> fed into an <code>Dense</code> layer with a <code>sigmoid</code> activation function and a final <code>Lambda</code> layer that finds the difference between the <code>min_rating</code> and the <code>max_rating</code> and then adds the <code>min_rating</code>. The model can then be compiled using <code>loss='mean_squared_error</code> and <code>optimizer=Adam(lr=0.001)</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Concatenate</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Activation</span><span class="p">,</span> <span class="n">Lambda</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Model</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span><span class="p">,</span> <span class="n">n_factors</span><span class="p">,</span> <span class="n">min_rating</span><span class="p">,</span> <span class="n">max_rating</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">user</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span></span>
<span class="code-line">    <span class="n">u</span> <span class="o">=</span> <span class="n">EmbeddingLayer</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_factors</span><span class="p">)(</span><span class="n">user</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">Item</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span></span>
<span class="code-line">    <span class="n">m</span> <span class="o">=</span> <span class="n">EmbeddingLayer</span><span class="p">(</span><span class="n">n_items</span><span class="p">,</span> <span class="n">n_factors</span><span class="p">)(</span><span class="n">Item</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">x</span> <span class="o">=</span> <span class="n">Concatenate</span><span class="p">()([</span><span class="n">u</span><span class="p">,</span> <span class="n">m</span><span class="p">])</span></span>
<span class="code-line">    <span class="n">x</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">x</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">'he_normal'</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">x</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s1">'relu'</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">x</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">x</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">'he_normal'</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">x</span> <span class="o">=</span> <span class="n">Activation</span><span class="p">(</span><span class="s1">'sigmoid'</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">x</span> <span class="o">=</span> <span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_rating</span> <span class="o">-</span> <span class="n">min_rating</span><span class="p">)</span> <span class="o">+</span> <span class="n">min_rating</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">user</span><span class="p">,</span> <span class="n">Item</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="n">x</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">opt</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'mean_squared_error'</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">opt</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">return</span> <span class="n">model</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now, we can examine the model architecture by saving the <code>Recomender</code> class with the input containing <code>n_users</code>, <code>n_items</code>, <code>n_factors</code>, <code>min_rating</code>, <code>max_rating</code> as <code>keras_model</code> and calling <code>summary</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">keras_model</span> <span class="o">=</span> <span class="n">Recommender</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span><span class="p">,</span> <span class="n">n_factors</span><span class="p">,</span> <span class="n">min_rating</span><span class="p">,</span> <span class="n">max_rating</span><span class="p">)</span></span>
<span class="code-line"><span class="n">keras_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Model: "model"</span>
<span class="code-line">__________________________________________________________________________________________________</span>
<span class="code-line"> Layer (type)                   Output Shape         Param #     Connected to                     </span>
<span class="code-line">==================================================================================================</span>
<span class="code-line"> input_2 (InputLayer)           [(None, 1)]          0           []                               </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> input_3 (InputLayer)           [(None, 1)]          0           []                               </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> embedding (Embedding)          (None, 1, 50)        985100      ['input_2[0][0]']                </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> embedding_1 (Embedding)        (None, 1, 50)        5186550     ['input_3[0][0]']                </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> reshape (Reshape)              (None, 50)           0           ['embedding[0][0]']              </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> reshape_1 (Reshape)            (None, 50)           0           ['embedding_1[0][0]']            </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> concatenate (Concatenate)      (None, 100)          0           ['reshape[0][0]',                </span>
<span class="code-line">                                                                  'reshape_1[0][0]']              </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> dropout (Dropout)              (None, 100)          0           ['concatenate[0][0]']            </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> dense (Dense)                  (None, 10)           1010        ['dropout[0][0]']                </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> activation (Activation)        (None, 10)           0           ['dense[0][0]']                  </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> dropout_1 (Dropout)            (None, 10)           0           ['activation[0][0]']             </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> dense_1 (Dense)                (None, 1)            11          ['dropout_1[0][0]']              </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> activation_1 (Activation)      (None, 1)            0           ['dense_1[0][0]']                </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> lambda (Lambda)                (None, 1)            0           ['activation_1[0][0]']           </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line">==================================================================================================</span>
<span class="code-line">Total params: 6,172,671</span>
<span class="code-line">Trainable params: 6,172,671</span>
<span class="code-line">Non-trainable params: 0</span>
<span class="code-line">__________________________________________________________________________________________________</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Batch-Size-=-16"><code>Batch Size = 16</code><a class="anchor-link" href="#Batch-Size-=-16">¶</a></h2><p>   <font size="4">Let's now set the path where model is saved and set up the logs/callbacks containing the <code>EarlyStopping</code> class that monitors the <code>val_loss</code> and will stop training if it does not improve after 3 <code>epochs</code>, the <code>ModelCheckpoint</code> class that monitors the <code>val_loss</code> saving only the best one with a <code>min</code> loss as well as the <code>TensorBoard</code> class that enables visualizations using the <code>TensorBoard</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">datetime</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span><span class="p">,</span> <span class="n">ModelCheckpoint</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="o">!</span>rm<span class="w"> </span>-rf<span class="w"> </span>/logs/</span>
<span class="code-line"></span>
<span class="code-line"><span class="o">%</span><span class="k">load_ext</span> tensorboard</span>
<span class="code-line"></span>
<span class="code-line"><span class="n">log_folder</span> <span class="o">=</span> <span class="s1">'logs/fit/'</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y%m</span><span class="si">%d</span><span class="s1">-%H%M%S'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">filepath</span> <span class="o">=</span> <span class="s1">'CF_Baseline_b16_dropout0.2_weights_only.h5'</span></span>
<span class="code-line"><span class="n">checkpoint_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">tensorboard_callback</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">TensorBoard</span><span class="p">(</span><span class="n">log_folder</span><span class="p">,</span></span>
<span class="code-line">                                                      <span class="n">histogram_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">callbacks_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">'val_loss'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">'val_loss'</span><span class="p">,</span></span>
<span class="code-line">                                  <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'min'</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">tensorboard_callback</span><span class="p">]</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now the model can be trained by calling <code>fit</code> utilizing the train dataset for 10 <code>epochs</code>, which is the iterations over the entire <code>X_train</code> and <code>y_train</code>, using a <code>batch_size=16</code>, which is the number of samples per gradient update, and the specified callbacks from the <code>callbacks_list</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">keras_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train_array</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span></span>
<span class="code-line">                          <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test_array</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span></span>
<span class="code-line">                          <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks_list</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Epoch 1/10</span>
<span class="code-line">55744/55744 [==============================] - 289s 5ms/step - loss: 1.0271 - val_loss: 0.9597</span>
<span class="code-line">Epoch 2/10</span>
<span class="code-line">55744/55744 [==============================] - 291s 5ms/step - loss: 0.9599 - val_loss: 0.9527</span>
<span class="code-line">Epoch 3/10</span>
<span class="code-line">55744/55744 [==============================] - 281s 5ms/step - loss: 0.9551 - val_loss: 0.9528</span>
<span class="code-line">Epoch 4/10</span>
<span class="code-line">55744/55744 [==============================] - 281s 5ms/step - loss: 0.9517 - val_loss: 0.9474</span>
<span class="code-line">Epoch 5/10</span>
<span class="code-line">55744/55744 [==============================] - 279s 5ms/step - loss: 0.9516 - val_loss: 0.9447</span>
<span class="code-line">Epoch 6/10</span>
<span class="code-line">55744/55744 [==============================] - 277s 5ms/step - loss: 0.9535 - val_loss: 0.9471</span>
<span class="code-line">Epoch 7/10</span>
<span class="code-line">55744/55744 [==============================] - 277s 5ms/step - loss: 0.9508 - val_loss: 0.9534</span>
<span class="code-line">Epoch 8/10</span>
<span class="code-line">55744/55744 [==============================] - 277s 5ms/step - loss: 0.9506 - val_loss: 0.9445</span>
<span class="code-line">Epoch 9/10</span>
<span class="code-line">55744/55744 [==============================] - 275s 5ms/step - loss: 0.9485 - val_loss: 0.9482</span>
<span class="code-line">Epoch 10/10</span>
<span class="code-line">55744/55744 [==============================] - 277s 5ms/step - loss: 0.9490 - val_loss: 0.9456</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now, let's save the model if we need to reload it in the future and predict on the test set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">keras_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'./baselineCF_Model2_batch16_dropout0.2_tf.h5'</span><span class="p">,</span></span>
<span class="code-line">                 <span class="n">save_format</span><span class="o">=</span><span class="s1">'tf'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">#filepath = 'CF_Baseline_b16_dropout0.2_weights_only.h5'</span></span>
<span class="code-line"><span class="c1">#model = tf.keras.models.load_model('./baselineCF_Model2_batch16_dropout0.2_tf.h5')</span></span>
<span class="code-line"><span class="c1">#model.load_weights(filepath)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">predictions</span> <span class="o">=</span> <span class="n">keras_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_array</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">6968/6968 [==============================] - 9s 1ms/step</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Then, we create a <code>pandas.Dataframe</code> containing the test set's <code>review_id</code>, <code>item_id</code>, <code>rating</code> and <code>prediction</code> results.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df_test</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">'user'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df_test</span><span class="p">[</span><span class="s1">'items'</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span></span>
<span class="code-line"><span class="n">df_test</span><span class="p">[</span><span class="s1">'stars'</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_test</span></span>
<span class="code-line"><span class="n">df_test</span><span class="p">[</span><span class="s1">'predictions'</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span></span>
<span class="code-line"><span class="n">df_test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div id="df-c9833b21-52c4-48b8-833b-bc10c0ebbc3f">
<div class="colab-df-container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe table-striped table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>user</th>
<th>items</th>
<th>stars</th>
<th>predictions</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>14701</td>
<td>17937</td>
<td>3.0</td>
<td>1.903274</td>
</tr>
<tr>
<th>1</th>
<td>17387</td>
<td>97250</td>
<td>5.0</td>
<td>3.822067</td>
</tr>
<tr>
<th>2</th>
<td>17411</td>
<td>66343</td>
<td>4.0</td>
<td>4.709871</td>
</tr>
<tr>
<th>3</th>
<td>6792</td>
<td>10159</td>
<td>5.0</td>
<td>3.698924</td>
</tr>
<tr>
<th>4</th>
<td>2965</td>
<td>77733</td>
<td>5.0</td>
<td>4.655035</td>
</tr>
</tbody>
</table>
</div>
<button class="colab-df-convert" onclick="convertToInteractive('df-c9833b21-52c4-48b8-833b-bc10c0ebbc3f')" style="display:none;" title="Convert this dataframe to an interactive table.">
<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
</svg>
</button>
<style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>
<script>
        const buttonEl =
          document.querySelector('#df-c9833b21-52c4-48b8-833b-bc10c0ebbc3f button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-c9833b21-52c4-48b8-833b-bc10c0ebbc3f');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can utilize the actual <code>ratings</code> from the original test set and the predicted ones to plot the distribution of the actual ratings using <code>matplotlib.pyplot.bar</code> and the predicted ratings using <code>matplotlib.pyplot.hist</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">values</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="s1">'stars'</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">tick_label</span><span class="o">=</span><span class="p">[</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'2'</span><span class="p">,</span><span class="s1">'3'</span><span class="p">,</span><span class="s1">'4'</span><span class="p">,</span><span class="s1">'5'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'true value'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'predicted value'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Ratings'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Ratings Histogram'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,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j3HnnXfyL//yLwB069aNjTbaaJk+kyZNYtKkSey4444MHTqUxx57jFmzZvGf//mfHHrooay77rpsuOGGyz1VMWbMGK6//noAxo8fv6T2hx9+mN13353tttuOa6+9lkceeaTh72bSpElcffXV7LDDDuyyyy4sXLiQWbNmNby9JKl1TbnPQUT8L2AxcG0zjt8iMy8HLgcYNmzY2pkAsJYtPehR/3699dYDatfz77vvvvz0pz+t9J0xY8ZaqyMzOfPMM/nCF75Qaf/hD3/Y0PajR4/ma1/7Gi+88ALTpk1jr732AuDYY4/l5ptvZsiQIVx11VVMnjx5mW27d+++5JRE/WWJmcnFF1/M/vvvv5qfSpLUmnYPBxFxLLWJintnZssP8jygb123PqWN5bQvBDaOiO5ldKC+f8u+5kZEd2Cj0r9T+stf/sK9997LiBEjuO6669htt92W6bPrrrty8sknM3v2bD7+8Y/z2muvMW/ePAYOHMicOXN44okn2GqrrZYJDy323ntvLrvsMr785S/zzjvvsGjRIjbYYANeffXVJX32339/vvGNb3DUUUex/vrrM2/ePHr06MEee+zBsccey5lnnsnixYu59dZblwkQAOuvvz4777wzp556KqNGjVoygfLVV19liy224O233+baa6+ld+/ey2zbr18/pk2bxvDhw7nxxhuXtO+///5cdtll7LXXXvTo0YM//elP9O7de0loktS59Tvjl80uoUOZc95B7Xasdj2tUK48+DdgdGbWzzybABwRER8sVyEMAB4ApgADIqJ/RKxDbdLihBIq7gIOK9sfA9xSt69jyvJhwJ11IaTT2XrrrbnkkkvYZpttePHFF5cM/9fbbLPNuOqqqzjyyCPZfvvtGTFiBI899hg9e/bk8ssv56CDDmLo0KF85CMfafUYF154IXfddRfbbbcdO+20EzNnzqRXr16MHDmSwYMHc/rpp7Pffvvxj//4j4wYMYLtttuOww47jFdffZWhQ4cyZswYhgwZwoEHHsjOO++83M8yZswYrrnmmiWnFADOOeccdtllF0aOHMnAgQNb3e5f//Vfueyyy9hxxx15/vnnl7R//vOfZ9CgQQwdOpTBgwfzhS98gcWLF7e6D0lS46Ktfjcj4qfAnsCmwHPAWdSuTvgg7/0lf19m/nPp/7+ozUNYDHw5M39V2j8J/JDapYxjM/Pc0v731CYofhh4EDg6M9+MiJ7AT4AdqU2IPCIzn1xZvcOGDcuWGfEtHn30UbbZZpvV/QrW2Jw5cxg1ahQPP/xw02roCpr931HS6nHkoGptjxxExLTMHNbaujY7rZCZR7bSvNyp6OVH/9xW2icCE1tpf5La1QxLt78BHL5KxUqSpCW8Q2IH1q9fP0cNJEntznAgSZIqDAeSJKnCcCBJkioMB5IkqcJw0IGt7mOT20r9w5okSV1XU26f3Fmt7WtuV3bN6ooem7x48WK6d/c/nyRp7XPkoANb+rHJkydPZvfdd2f06NEMGjSIOXPmMHjw4CX9zz//fM4++2wAnnjiCQ444AB22mkndt99dx577LHKvt9991369evHSy+9tKRtwIABPPfcc9x6663ssssu7Ljjjuyzzz4899xzy9R27LHHVm5lvP766y9ZXt6jnSVJnYPhoANb+rHJANOnT+fCCy/kT3/60wq3PfHEE7n44ouZNm0a559//jKjDx/4wAc4+OCD+cUvfgHA/fffz5Zbbsnmm2/Obrvtxn333ceDDz7IEUccwfe+972Ga17eo50lSZ2H49KdzPDhw+nfv/8K+yxatIjf//73HH74ezeKfPPNN5fpN2bMGL797W9z3HHHVR6jPHfuXMaMGcMzzzzDW2+9tdLj1at/tHNLLbNmzWKPPfZoeB+SpOYyHHQy9U8crH+UMbz3OON3332XjTfeeKWPbB4xYgSzZ89mwYIF3HzzzXz9618H4Itf/CKnnXYao0ePZvLkyUtOVdSrP/a7777LW2+9BSz/0c6SpM7D0wod2NKPTV7a5ptvzvz581m4cCFvvvkmt912GwAbbrgh/fv354YbbgBqP9gPPfTQMttHBIceeiinnXYa22yzDb169QLg5ZdfXvLo5HHjxrV67JbHKANMmDCBt99+G6g9Rnns2LEsWrQIgHnz5jF//vzV+fiSpCYxHHRgSz82eWk9evTgm9/8JsOHD2ffffetPPL42muv5corr2TIkCFsu+223HLLLctsD60/Rvnss8/m8MMPZ6eddmLTTTdtdbsTTjiBu+++myFDhnDvvfcuGdFY3qOdJUmdR5s9srmz6YiPbNba4X9HqXPykc1V7fnIZkcOJElSheFAkiRVGA4kSVKF4WAlnJPRufnfT5JWneFgBXr27MnChQv9gemkMpOFCxfSs2fPZpciSZ2KN0FagT59+jB37lwWLFjQ7FK0mnr27EmfPn2aXYYkdSqGgxXo0aPHKt06WJKkrsDTCpIkqcJwIEmSKgwHkiSpwnAgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIq2iwcRMTYiJgfEQ/XtX04Iu6IiFnl301Ke0TERRExOyL+EBFD67Y5pvSfFRHH1LXvFBF/LNtcFBGxomNIkqTGtOXIwVXAAUu1nQH8NjMHAL8t7wEOBAaU14nAZVD7oQfOAnYBhgNn1f3YXwacULfdASs5hiRJakCbhYPM/B3wwlLNBwPjyvI44JC69quz5j5g44jYAtgfuCMzX8jMF4E7gAPKug0z877MTODqpfbV2jEkSVID2nvOweaZ+UxZfhbYvCz3Bp6u6ze3tK2ofW4r7Ss6xjIi4sSImBoRUxcsWLAaH0eSpK6naRMSy1/82cxjZOblmTksM4dtttlmbVmKJEmdRnuHg+fKKQHKv/NL+zygb12/PqVtRe19Wmlf0TEkSVID2jscTABarjg4Brilrv1z5aqFXYGXy6mB24H9ImKTMhFxP+D2su6ViNi1XKXwuaX21doxJElSA7q31Y4j4qfAnsCmETGX2lUH5wE/i4jjgaeAz5buE4FPArOB14HjADLzhYg4B5hS+n07M1smOZ5E7YqIDwG/Ki9WcAxJktSANgsHmXnkclbt3UrfBE5ezn7GAmNbaZ8KDG6lfWFrx5AkSY3xDomSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIqDAeSJKmiKeEgIv5nRDwSEQ9HxE8jomdE9I+I+yNidkRcHxHrlL4fLO9nl/X96vZzZml/PCL2r2s/oLTNjogz2v8TSpLUebV7OIiI3sCXgGGZORjoBhwBfBe4IDM/DrwIHF82OR54sbRfUPoREYPKdtsCBwCXRkS3iOgGXAIcCAwCjix9JUlSA5p1WqE78KGI6A6sCzwD7AXcWNaPAw4pyweX95T1e0dElPbxmflmZv4ZmA0ML6/ZmflkZr4FjC99JUlSA9o9HGTmPOB84C/UQsHLwDTgpcxcXLrNBXqX5d7A02XbxaV/r/r2pbZZXvsyIuLEiJgaEVMXLFiw5h9OkqQuoBmnFTah9pd8f+CjwHrUTgu0u8y8PDOHZeawzTbbrBklSJLU4TTjtMI+wJ8zc0Fmvg3cBIwENi6nGQD6APPK8jygL0BZvxGwsL59qW2W1y5JkhrQjHDwF2DXiFi3zB3YG5gJ3AUcVvocA9xSlieU95T1d2ZmlvYjytUM/YEBwAPAFGBAufphHWqTFie0w+eSJKlL6L7yLmtXZt4fETcC04HFwIPA5cAvgfER8Z3SdmXZ5ErgJxExG3iB2o89mflIRPyMWrBYDJycme8ARMQpwO3UroQYm5mPtNfnkySps2v3cACQmWcBZy3V/CS1Kw2W7vsGcPhy9nMucG4r7ROBiWteqSRJ7z/eIVGSJFUYDiRJUoXhQJIkVRgOJElSheFAkiRVGA4kSVKF4UCSJFUYDiRJUoXhQJIkVRgOJElSheFAkiRVGA4kSVKF4UCSJFUYDiRJUoXhQJIkVRgOJElSRUPhICK2a+tCJElSx9DoyMGlEfFARJwUERu1aUWSJKmpGgoHmbk7cBTQF5gWEddFxL5tWpkkSWqKhuccZOYs4OvAV4FPABdFxGMR8em2Kk6SJLW/RuccbB8RFwCPAnsBn8rMbcryBW1YnyRJamfdG+x3MfBj4GuZ+beWxsz8a0R8vU0qkyRJTdFoODgI+FtmvgMQER8Aembm65n5kzarTpIktbtGw8FvgH2AReX9usAk4L+1RVGSJAHM2X5Us0ug3x9ua3YJ7a7RCYk9M7MlGFCW122bkiRJUjM1Gg5ei4ihLW8iYifgbyvoL0mSOqlGTyt8GbghIv4KBPB3wJg2q0qSJDVNQ+EgM6dExEBg69L0eGa+3XZlSZKkZml05ABgZ6Bf2WZoRJCZV7dJVZIkqWkaCgcR8RNgK2AG8E5pTsBwIElSF9PoyMEwYFBmZlsWI0mSmq/RqxUepjYJUZIkdXGNjhxsCsyMiAeAN1saM3N0m1QlSZKaptFwcHZbFiFJkjqORi9lvDsitgQGZOZvImJdoFvbliZJkpqh0Uc2nwDcCPyoNPUGbm6roiRJUvM0OiHxZGAk8ApAZs4CPtJWRUmSpOZpNBy8mZlvtbyJiO7U7nMgSZK6mEbDwd0R8TXgQxGxL3ADcGvblSVJkpql0XBwBrAA+CPwBWAi8PW2KkqSJDVPo1crvAtcUV6SJKkLa/TZCn+mlTkGmfn3a70iSZLUVKvybIUWPYHDgQ+v/XIkSVKzNTTnIDMX1r3mZeYPgYNW96ARsXFE3BgRj0XEoxExIiI+HBF3RMSs8u8mpW9ExEURMTsi/hARQ+v2c0zpPysijqlr3yki/li2uSgiYnVrlSTp/abRmyANrXsNi4h/pvFRh9ZcCPw6MwcCQ4BHqU16/G1mDgB+W94DHAgMKK8TgctKTR8GzgJ2AYYDZ7UEitLnhLrtDliDWiVJel9p9Af+P+qWFwNzgM+uzgEjYiNgD+BYgHL/hLci4mBgz9JtHDAZ+CpwMHB1eVz0fWXUYYvS947MfKHs9w7ggIiYDGyYmfeV9quBQ4BfrU69kiS93zR6tcJ/X4vH7E/tssj/FxFDgGnAqcDmmflM6fMssHlZ7g08Xbf93NK2ova5rbQvIyJOpDYawcc+9rHV/0SSJHUhjV6tcNqK1mfmD1bxmEOBL2bm/RFxIe+dQmjZX0ZEm9+BMTMvBy4HGDZsmHd8lCSJxm+CNAz4F977y/yfqf3Ab1Beq2IuMDcz7y/vbyz7eq6cLqD8O7+snwf0rdu+T2lbUXufVtolSVIDGg0HfYChmfmVzPwKsBPwscz8VmZ+a1UOmJnPAk9HxNalaW9gJjABaLni4BjglrI8AfhcuWphV+DlcvrhdmC/iNikTETcD7i9rHslInYtVyl8rm5fkiRpJRqdkLg58Fbd+7d4b07A6vgicG1ErAM8CRxHLaj8LCKOB57ivQmPE4FPArOB10tfMvOFiDgHmFL6fbtlciJwEnAV8CFqExGdjChJUoMaDQdXAw9ExC/K+0OoXVGwWjJzBtUbK7XYu5W+Se2R0a3tZywwtpX2qcDg1a1PkqT3s0avVjg3In4F7F6ajsvMB9uuLEmS1CyNzjkAWBd4JTMvBOZGRP82qkmSJDVRo3dIPIvaDYnOLE09gGvaqihJktQ8jY4cHAqMBl4DyMy/suqXMEqSpE6g0XDwVpkYmAARsV7blSRJkpqp0XDws4j4EbBxRJwA/Aa4ou3KkiRJzbLSqxXKjYSuBwYCrwBbA9/MzDvauDZJktQEKw0H5TkHEzNzO8BAIElSF9foaYXpEbFzm1YiSZI6hEbvkLgLcHREzKF2xUJQG1TYvq0KkyRJzbHCcBARH8vMvwD7t1M9kiSpyVY2cnAztacxPhURP8/Mz7RHUZIkqXlWNucg6pb/vi0LkSRJHcPKwkEuZ1mSJHVRKzutMCQiXqE2gvChsgzvTUjcsE2rkyRJ7W6F4SAzu7VXIZIkqWNYlUc2S5Kk9wHDgSRJqjAcSJKkikbvkChJWol+Z/yy2SV0KHPOO6jZJWg1OXIgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKgwHkiSpwnAgSZIqvM+BJKlVc7YftWY7uG5Nj79m22v1OXIgSZIqDAeSJKnCcCBJkioMB5IkqcJwIEmSKrxaQZI6oDW+UkBaA44cSJKkCsOBJEmqMBxIkqQKw4EkSaowHEiSpArDgSRJqjAcSJKkCsOBJEmqMBxIkqSKpoWDiOgWEQ9GxG3lff+IuD8iZkfE9RGxTmn/YHk/u6zvV7ePM0v74xGxf137AaVtdkSc0d6fTZKkzqyZIwenAo/Wvf8ucEFmfhx4ETi+tB8PvFjaLyj9iIhBwBHAtsABwKUlcHQDLgEOBAYBR5a+kiSpAU0JBxHRBzgI+HF5H8BewI2lyzjgkLJ8cHlPWb936X8wMD4z38zMPwOzgeHlNTszn8zMt4Dxpa8kSWpAs0YOfgj8G/Bued8LeCkzF5f3c4HeZbk38DRAWf9y6b+kfaltltcuSZIa0O7hICJGAfMzc1p7H7uVWk6MiKkRMXXBggXNLkeSpA6hGSMHI4HRETGH2pD/XsCFwMYR0fII6T7AvLI8D+gLUNZvBCysb19qm+W1LyMzL8/MYZk5bLPNNlvzTyZJUhfQ7uEgM8/MzD6Z2Y/ahMI7M/Mo4C7gsNLtGOCWsjyhvKesvzMzs7QfUa5m6A8MAB4ApgADytUP65RjTGiHjyZJUpfQfeVd2s1XgfER8R3gQeDK0n4l8JOImA28QO3Hnsx8JCJ+BswEFgMnZ+Y7ABFxCnA70A0Ym5mPtOsnkSSpE2tqOMjMycDksvwktSsNlu7zBnD4crY/Fzi3lfaJwMS1WKokSe8b3iFRkiRVGA4kSVKF4UCSJFUYDiRJUoXhQJIkVRgOJElSheFAkiRVGA4kSVKF4UCSJFUYDiRJUoXhQJIkVRgOJElSheFAkiRVGA4kSVKF4UCSJFUYDiRJUoXhQJIkVRgOJElSheFAkiRVGA4kSVKF4UCSJFV0b3YBktThXBertdmc7ddyHVKTOHIgSZIqDAeSJKnCcCBJkiqccyC9T/U745fNLqFDmXPeQc0uQeowHDmQJEkVhgNJklRhOJAkSRWGA0mSVGE4kCRJFYYDSbhxoSwAAAjNSURBVJJUYTiQJEkVhgNJklRhOJAkSRWGA0mSVGE4kCRJFYYDSZJUYTiQJEkVhgNJklRhOJAkSRWGA0mSVGE4kCRJFe0eDiKib0TcFREzI+KRiDi1tH84Iu6IiFnl301Ke0TERRExOyL+EBFD6/Z1TOk/KyKOqWvfKSL+WLa5KCKivT+nJEmdVTNGDhYDX8nMQcCuwMkRMQg4A/htZg4AflveAxwIDCivE4HLoBYmgLOAXYDhwFktgaL0OaFuuwPa4XNJktQltHs4yMxnMnN6WX4VeBToDRwMjCvdxgGHlOWDgauz5j5g44jYAtgfuCMzX8jMF4E7gAPKug0z877MTODqun1JkqSVaOqcg4joB+wI3A9snpnPlFXPApuX5d7A03WbzS1tK2qf20q7JElqQNPCQUSsD/wc+HJmvlK/rvzFn+1Qw4kRMTUipi5YsKCtDydJUqfQlHAQET2oBYNrM/Om0vxcOSVA+Xd+aZ8H9K3bvE9pW1F7n1bal5GZl2fmsMwcttlmm63Zh5IkqYtoxtUKAVwJPJqZP6hbNQFoueLgGOCWuvbPlasWdgVeLqcfbgf2i4hNykTE/YDby7pXImLXcqzP1e1LkiStRPcmHHMk8E/AHyNiRmn7GnAe8LOIOB54CvhsWTcR+CQwG3gdOA4gM1+IiHOAKaXftzPzhbJ8EnAV8CHgV+UlSZIa0O7hIDPvAZZ334G9W+mfwMnL2ddYYGwr7VOBwWtQpiRJ71veIVGSJFUYDiRJUoXhQJIkVRgOJElSheFAkiRVNONSRklarjnbj2rOga9rzmGljsiRA0mSVGE4kCRJFYYDSZJUYTiQJEkVhgNJklRhOJAkSRWGA0mSVOF9DtRp9Dvjl80uocOYc95BzS5BUhfmyIEkSaowHEiSpApPK7QRh8CrHAaXpM7DkQNJklRhOJAkSRWGA0mSVGE4kCRJFYYDSZJUYTiQJEkVhgNJklThfQ4kLTFn+1HNLkFSB+DIgSRJqjAcSJKkCsOBJEmqMBxIkqQKw4EkSaowHEiSpArDgSRJqjAcSJKkCsOBJEmqMBxIkqQKw4EkSarw2QpSB7FKzzW4bm0cb833IalrcuRAkiRVGA4kSVKF4UCSJFUYDiRJUoXhQJIkVXi1gsQqXikgSV1clx05iIgDIuLxiJgdEWc0ux5JkjqLLhkOIqIbcAlwIDAIODIiBjW3KkmSOoeuelphODA7M58EiIjxwMHAzKZWpdZdFw1186Y9ktQ+umo46A08Xfd+LrBLk2rpsNr1PPtauKOfJKl9dNVw0JCIOBE4sbxdFBGPN7OeNrIp8HxrKxr7e12tWO53qtXi97n2+Z2uVaM6xPcZ313ru9xyeSu6ajiYB/Ste9+ntFVk5uXA5e1VVDNExNTMHNbsOroSv9O1y+9z7fM7Xbvej99nl5yQCEwBBkRE/4hYBzgCmNDkmiRJ6hS65MhBZi6OiFOA24FuwNjMfKTJZUmS1Cl0yXAAkJkTgYnNrqMD6NKnTZrE73Tt8vtc+/xO16733fcZmdnsGiRJUgfSVeccSJKk1WQ46KIiYmxEzI+Ih5tdS1cQEX0j4q6ImBkRj0TEqc2uqbOLiJ4R8UBEPFS+0281u6auICK6RcSDEXFbs2vpCiJiTkT8MSJmRMTUZtfTXjyt0EVFxB7AIuDqzBzc7Ho6u4jYAtgiM6dHxAbANOCQzPSum6spIgJYLzMXRUQP4B7g1My8r8mldWoRcRowDNgwM32i2BqKiDnAsMxs+n0O2pMjB11UZv4OeKHZdXQVmflMZk4vy68Cj1K7E6dWU9YsKm97lJd/rayBiOgDHAT8uNm1qHMzHEirKCL6ATsC9ze3ks6vDIHPAOYDd2Sm3+ma+SHwb8C7zS6kC0lgUkRMK3fVfV8wHEirICLWB34OfDkzX2l2PZ1dZr6TmTtQu4vp8IjwFNhqiohRwPzMnNbsWrqY3TJzKLWn/J5cTtl2eYYDqUHlvPjPgWsz86Zm19OVZOZLwF3AAc2upRMbCYwu58jHA3tFxDXNLanzy8x55d/5wC+oPfW3yzMcSA0ok+euBB7NzB80u56uICI2i4iNy/KHgH2Bx5pbVeeVmWdmZp/M7EftlvF3ZubRTS6rU4uI9coEZCJiPWA/4H1xBZjhoIuKiJ8C9wJbR8TciDi+2TV1ciOBf6L219iM8vpks4vq5LYA7oqIP1B7Hsodmenld+pINgfuiYiHgAeAX2bmr5tcU7vwUkZJklThyIEkSaowHEiSpArDgSRJqjAcSJKkCsOBJEmqMBxIWi0R8U65pPPhiLi15Z4FK+i/Q/3lnxExOiLOaPtKJa0qL2WUtFoiYlFmrl+WxwF/ysxzV9D/WGpPtzulnUqUtJocOZC0NtxLeUplRAyPiHsj4sGI+H1EbB0R6wDfBsaU0YYxEXFsRPyfss1VEXFR6f9kRBxW2j8QEZdGxGMRcUdETKxbd15EzIyIP0TE+U363FKX1L3ZBUjq3CKiG7A3tdtLQ+0WyLtn5uKI2Af498z8TER8k7qRgzKSUG8LYDdgIDABuBH4NNAPGAR8hNqjssdGRC/gUGBgZubKTmlIWjWGA0mr60Plccu9qf1o31HaNwLGRcQAao+77dHg/m7OzHeBmRGxeWnbDbihtD8bEXeV9peBN4ArI+I2wNsuS2uRpxUkra6/lcctbwkEcHJpPwe4KzMHA58Ceja4vzfrlmNFHTNzMbWn490IjALeF/e7l9qL4UDSGsnM14EvAV+JiO7URg7mldXH1nV9FdhgFXf/X8BnytyDzYE9ASJifWCjzJwI/E9gyGp/AEnLMBxIWmOZ+SDwB+BI4HvA/46IB6meurwLGNQyIbHBXf8cmAvMBK4BplM7pbABcFt5ouM9wGlr5YNIAryUUVIHFxHrZ+aiMgnxAWBkZj7b7LqkrswJiZI6utvK1QjrAOcYDKS258iBJEmqcM6BJEmqMBxIkqQKw4EkSaowHEiSpArDgSRJqjAcSJKkiv8PKdEExvXgrf0AAAAASUVORK5CYII=
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now, let's examine metrics from the model and plot the model <code>loss</code> and <code>val_loss</code> over the training epochs.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'loss'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'val_loss'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Model Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epoch'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">'Train'</span><span class="p">,</span> <span class="s1">'Eval'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYgAAAEWCAYAAAB8LwAVAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjIsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+WH4yJAAAgAElEQVR4nO3deXhc5Znn/e+t0i5rsSQvskt4AeMNq2TimABJDGRzgDTdnSaBdCfQ6W5eyJ5MNjKToTtv82YjmQ5DuqeTDk32hJckc4U1YYdMCLYB7zZgLBvLqxZbsiXLllT3/HGOFttlW7JVOiXV73NddanqnFNVt2Srfnqe55znMXdHRETkeDlRFyAiIplJASEiIikpIEREJCUFhIiIpKSAEBGRlBQQIiKSkgJC5AyZ2UwzczPLHcKxN5rZH0ajLpGRooCQrGBm28zsqJlVH7f9pfBDfmY0lQ0vaERGkwJCskkDcH3fAzNbBBRHV45IZlNASDb5MfChQY9vAH40+AAzKzezH5lZk5ltN7P/ZmY54b6Ymd1hZs1mthW4KsVzf2Bmu81sp5n9s5nFzqZgM5tmZr81s1Yz22Jm/zBo31IzW2Vm7Wa218y+HW4vNLOfmFmLmR0ws5VmNuVs6pDspICQbPInoMzM5ocf3NcBPznumP8JlAOzgWUEgfK34b5/AK4GFgNLgL867rn3AD3AeeEx7wT+/ixr/gXQCEwL3+//M7Mrwn3fAb7j7mXAucC94fYbwu+hFqgCbgYOn2UdkoUUEJJt+loR7wA2ATv7dgwKjVvd/aC7bwO+BXwwPOR9wL+4+w53bwW+Oui5U4ArgU+5e4e77wP+R/h6Z8TMaoFLgS+4e5e7rwb+g4FWUDdwnplVu/shd//ToO1VwHnu3uvuL7h7+5nWIdlLASHZ5sfAB4AbOa57CagG8oDtg7ZtB6aH96cBO47b12dG+NzdYbfOAeDfgclnUes0oNXdD56knr8Dzgc2h91IV4fbfwz8DviFme0ys2+YWd5Z1CFZSgEhWcXdtxMMVl8J/Pq43c0Ef33PGLTtHAZaGbsJum0G7+uzAzgCVLt7RXgrc/eFZ1HuLqDSzEpT1ePur7r79QQh9HXgPjMrcfdud/8nd18AXELQLfYhRIZJASHZ6O+AK9y9Y/BGd+8l6Me/3cxKzWwG8BkGxinuBT5hZnEzmwh8cdBzdwO/B75lZmVmlmNm55rZsmHUVRAOMBeaWSFBEPwR+Gq4rS6s/ScAZvY3ZjbJ3ZPAgfA1kmZ2uZktCrvM2glCLzmMOkQABYRkIXd/zd1XnWT3x4EOYCvwB+BnwN3hvu8TdN2sAV7kxBbIh4B8YCOwH7gPqBlGaYcIBpP7blcQnJY7k6A18RvgNnd/LDx+ObDBzA4RDFhf5+6Hganhe7cTjLM8TdDtJDIspgWDREQkFbUgREQkJQWEiIikpIAQEZGUFBAiIpLSuJk9srq62mfOnBl1GSIiY8oLL7zQ7O6TUu0bNwExc+ZMVq062ZmLIiKSipltP9k+dTGJiEhKCggREUlJASEiIimNmzEIEZHh6u7uprGxka6urqhLSbvCwkLi8Th5eUOf2FcBISJZq7GxkdLSUmbOnImZRV1O2rg7LS0tNDY2MmvWrCE/T11MIpK1urq6qKqqGtfhAGBmVFVVDbulpIAQkaw23sOhz5l8n1kfEAc6j3Ln46+yfmdb1KWIiGSUrA+IWI7xPx57hSc374u6FBHJMi0tLdTX11NfX8/UqVOZPn16/+OjR4+e8rmrVq3iE5/4RFrry/pB6tLCPM6dNIE1jQdOf7CIyAiqqqpi9erVAPzjP/4jEyZM4LOf/Wz//p6eHnJzU39ML1myhCVLlqS1vqxvQQAk4hWs3tGGFk8SkajdeOON3HzzzVx00UV8/vOfZ8WKFVx88cUsXryYSy65hJdffhmAp556iquvvhoIwuXDH/4wl112GbNnz+bOO+8ckVqyvgUBUF9bzq9ebGRXWxfTK4qiLkdEIvBP929g4672EX3NBdPKuO09C4f9vMbGRv74xz8Si8Vob2/n2WefJTc3l8cee4wvfelL/OpXvzrhOZs3b+bJJ5/k4MGDzJ07l1tuuWVY1zykooAAErUVAKzZcUABISKRu/baa4nFYgC0tbVxww038Oqrr2JmdHd3p3zOVVddRUFBAQUFBUyePJm9e/cSj8fPqg4FBDBvahn5sRzWNB7gykXDWWNeRMaLM/lLP11KSkr673/5y1/m8ssv5ze/+Q3btm3jsssuS/mcgoKC/vuxWIyenp6zrkNjEEB+bg7zp5WxZocGqkUks7S1tTF9+nQA7rnnnlF9bwVEqD5ezrrGNnqTGqgWkczx+c9/nltvvZXFixePSKtgOGy8nLmzZMkSP5sFg379YiOfuXcNv//0Wzl/SukIViYimWrTpk3Mnz8/6jJGTarv18xecPeU58uqBRHqG6herW4mERFAAdFvVlUJpYW5GocQEQkpIEI5OUYiXqErqkVEQgqIQRK15WzefZCu7t6oSxERiZwCYpC6eAU9SWfj7pG9mlJEZCxKW0CY2d1mts/M1p9kv5nZnWa2xczWmtmF4fZ6M3vOzDaE29+frhqPVz/oimoRkWyXzhbEPcDyU+x/NzAnvN0E/Fu4vRP4kLsvDJ//L2ZWkcY6+00pK2RqWaECQkRGTSwW65/iu76+nq997Wtn9DqXXXYZZ3Oqfyppm2rD3Z8xs5mnOOQa4EceXIjxJzOrMLMad39l0GvsMrN9wCRgVD61E7XlrGnU4kEiMjqKior6p/zONFGOQUwHdgx63Bhu62dmS4F84LVUL2BmN5nZKjNb1dTUNCJFJWoraGjuoK0z9YRYIiLp9sgjj3Dttdf2Px48tfctt9zCkiVLWLhwIbfddlta68jYyfrMrAb4MXCDuydTHePu3wO+B8GV1CPxvvXxoDdr7c4DvGXOpJF4SREZCx7+IuxZN7KvOXURvPvUXUaHDx+mvr6+//Gtt97Ke9/7Xm666SY6OjooKSnhl7/8Jddddx0At99+O5WVlfT29vK2t72NtWvXUldXN7J1h6JsQewEagc9jofbMLMy4EHgv7r7n0azqAvi5YAGqkVkdPR1MfXd3v/+95Obm8vy5cu5//776enp4cEHH+Saa64B4N577+XCCy9k8eLFbNiwgY0bN6attihbEL8FPmZmvwAuAtrcfbeZ5QO/IRifuG+0iyorzOPcSSWs3qFxCJGscpq/9Efbddddx1133UVlZSVLliyhtLSUhoYG7rjjDlauXMnEiRO58cYb6erqSlsN6TzN9efAc8BcM2s0s78zs5vN7ObwkIeArcAW4PvAR8Lt7wPeCtxoZqvDW/3xr59OidoKVu84oCVIRSQyy5Yt48UXX+T73/9+f/dSe3s7JSUllJeXs3fvXh5++OG01pDOs5iuP81+Bz6aYvtPgJ+kq66hqK+t4Ncv7mR3WxfTtMKciKTR8WMQy5cv52tf+xqxWIyrr76ae+65hx/+8IcAJBIJFi9ezLx586itreXSSy9Na20ZO0gdpUR84II5BYSIpFNv78mn9rnrrru46667jtl2skWDnnrqqRGsKqCpNlKYV1MaLkGqcQgRyV4KiBQKcmPMrynVmUwiktUUECeRqK1g3U4tQSoy3mXLyShn8n0qIE4iEa/g0JEetjYdiroUEUmTwsJCWlpaxn1IuDstLS0UFhYO63kapD6JwUuQztEa1SLjUjwep7GxkZGaqieTFRYWEo/Hh/UcBcRJzK4uobQglzWNB7h2Se3pnyAiY05eXh6zZs2KuoyMpS6mk8jJMepqy1mjK6pFJEspIE4hEa9g8552LUEqIllJAXEKdfEKunudTVqCVESykALiFLQEqYhkMwXEKUwtL2RKWYGuqBaRrKSAOI1EvEItCBHJSgqI00jUVrC1uYO2w1qCVESyiwLiNPrGIdapm0lEsowC4jQumB4uQdqobiYRyS4KiNMoL8pj9qQSVmscQkSyjAJiCOrjWoJURLKPAmIIErUVNB08wp729C0OLiKSaRQQQ5DQBXMikoUUEEMwv6aUvJixWhP3iUgWUUAMQbAEaRlrdSaTiGQRBcQQJeIVrG1sI6klSEUkSygghihRGy5B2qwlSEUkOygghqi+NrhgTuMQIpItFBBDNLt6AhMKcnUmk4hkDQXEEOXkGHXxck25ISJZQwExDInaCjbtbudIj5YgFZHxTwExDIl4ebgE6cGoSxERSTsFxDDoimoRySYKiGGYWlbI5NICBYSIZAUFxDCYGYnaClZroFpEsoACYpjqayvY2qQlSEVk/FNADFMiriVIRSQ7KCCGaVFcS5CKSHZQQAxTeVEes6tLNFAtIuOeAuIMJGor1IIQkXFPAXEGEvFy9rYfYU+bliAVkfFLAXEG+i6YW61uJhEZx9IWEGZ2t5ntM7P1J9lvZnanmW0xs7VmduGgfTeY2avh7YZ01Xim5teUkRczdTOJyLiWzhbEPcDyU+x/NzAnvN0E/BuAmVUCtwEXAUuB28xsYhrrHLbCvBjzpmoJUhEZ39IWEO7+DNB6ikOuAX7kgT8BFWZWA7wLeNTdW919P/Aopw6aSCRqy1m7Q0uQisj4FeUYxHRgx6DHjeG2k20/gZndZGarzGxVU1NT2gpNJRGv4OCRHrY2d4zq+4qIjJYxPUjt7t9z9yXuvmTSpEmj+t71mtlVRMa5KANiJ1A76HE83Hay7Rll9qRwCVKNQ4jIOBVlQPwW+FB4NtObgDZ33w38DninmU0MB6ffGW7LKLEcY9H0crUgRGTcyk3XC5vZz4HLgGozayQ4MykPwN3/F/AQcCWwBegE/jbc12pm/y+wMnypr7j7qQa7I5OoreAHf9jKkZ5eCnJjUZcjIjKi0hYQ7n79afY78NGT7LsbuDsddY2kviVIN+8+2H/xnIjIeDGmB6mj1r8EqcYhRGQcUkCchZryQiaVFmjKDREZlxQQZ8HMSMQrNFAtIuOSAuIs1deW81pTB+1dWoJURMYXBcRZ6huH0BKkIjLeKCDOUt10DVSLyPikgDhL5cV5zNISpCIyDikgRkAiXs6aHepiEpHxRQExAhK1Fexp79ISpCIyriggRoAumBOR8UgBMQIW1JSRm2MahxCRcUUBMQIK82LMqylVC0JExhUFxAhJxCtY26glSEVk/FBAjJBEbQUHu3poaNESpCIyPiggRoiWIBWR8UYBMULOnTSBkvyYAkJExg0FxAiJ5RiL4uWs1pxMIjJOKCBGUKK2gk272jnak4y6FBGRs6aAGEGJeAVHe5Ns3tMedSkiImdNATGCEhqoFpFxZEgBYWYlZpYT3j/fzP7MzPLSW9rYM628kOoJBazWxH0iMg4MtQXxDFBoZtOB3wMfBO5JV1FjlZlRX1uuK6pFZFwYakCYu3cCfwn8q7tfCyxMX1ljVyJewWtNh7QEqYiMeUMOCDO7GPhr4MFwWyw9JY1tidoK3GG9TncVkTFuqAHxKeBW4DfuvsHMZgNPpq+ssasuXg7AanUzicgYlzuUg9z9aeBpgHCwutndP5HOwsaqiuJ8ZlYVs1YD1SIyxg31LKafmVmZmZUA64GNZva59JY2diVqKzRQLSJj3lC7mBa4ezvw58DDwCyCM5kkhUS8gt1tXext1xKkIjJ2DTUg8sLrHv4c+K27dwNa+OAkdMGciIwHQw2Ifwe2ASXAM2Y2A9B8EiexcFq4BKm6mURkDBvqIPWdwJ2DNm03s8vTU9LYV5gXY+7UUtZooFpExrChDlKXm9m3zWxVePsWQWtCTiJRW8HaxgNaglRExqyhdjHdDRwE3hfe2oH/TFdR40F9vIL2rh62aQlSERmjhtTFBJzr7u8d9PifzGx1OgoaL/oHqhsPMHvShIirEREZvqG2IA6b2Zv7HpjZpcDh9JQ0Ppw3eQLF+TGNQ4jImDXUFsTNwI/MrDx8vB+4IT0ljQ+xHGPR9HJW61RXERmjhtSCcPc17p4A6oA6d18MXJHWysaB+toKNmoJUhEZo4a1opy7t4dXVAN8Jg31jCt1WoJURMaws1ly1EasinEqURv0yK3R1N8iMgadTUCc9gR/M1tuZi+b2RYz+2KK/TPM7HEzW2tmT5lZfNC+b5jZBjPbZGZ3mtmYC6TpFUVUT8jXlBsiMiadMiDM7KCZtae4HQSmnea5MeC7wLuBBcD1ZrbguMPuAH7k7nXAV4Cvhs+9BLiUYMzjAuCNwLLhf3vRMjMS8QoFhIiMSacMCHcvdfeyFLdSdz/dGVBLgS3uvtXdjwK/AK457pgFwBPh/ScH7XegEMgHCoA8YO/Qv63MkaitYEvTIQ5qCVIRGWPOpovpdKYDOwY9bgy3DbaGYJ1rgL8ASs2syt2fIwiM3eHtd+6+6fg3MLOb+qb/aGpqGvFvYCT0LUG6bqfGIURkbElnQAzFZ4FlZvYSQRfSTqDXzM4D5gNxglC5wszecvyT3f177r7E3ZdMmjRpNOsesrrp4UC1LpgTkTFmqBfKnYmdQO2gx/FwWz9330XYgjCzCcB73f2Amf0D8Cd3PxTuexi4GHg2jfWmxcSSfGZUFbNWU3+LyBiTzhbESmCOmc0ys3zgOuC3gw8ws+pwjWuAWwkmBQR4naBlkRsuVLQMOKGLaazQQLWIjEVpCwh37wE+BvyO4MP9XnffYGZfMbM/Cw+7DHjZzF4BpgC3h9vvA14D1hGMU6xx9/vTVWu6JWor2NXWxT4tQSoiY0g6u5hw94eAh47b9t8H3b+PIAyOf14v8P+ks7bRVD/ogrl3LCiMuBoRkaGJepA6KyycVk4sx9TNJCJjigJiFBTmxZg3tVRrVIvImKKAGCV14UC1u5YgFZGxQQExSupry8MlSDujLkVEZEgUEKOkfwlSjUOIyBihgBglcyaXUpwf0wpzIjJmKCBGSSzHuGB6uQaqRWTMUECMovraCjZoCVIRGSMUEKOoLl7O0Z4kL+85GHUpIiKnpYAYRYl4OFCtbiYRGQMUEKMoPrGIqhItQSoiY4MCYhSZGYnaCrUgRGRMUECMskS8glf3HeLQkZ6oSxEROSUFxChL1JYHS5A2aoU5EclsCohRVqeBahEZIxQQo6yyJJ9zKrUEqYhkPgVEBBK1FazZoS4mEclsCogIJOLl7DxwmH0HtQSpiGQuBUQE6sOZXdeqFSEiGUwBEYH+JUg1DiEiGUwBEYGi/Bhzp5Rq6m8RyWgKiIgkastZ29imJUhFJGMpICKSiFfQdrib7VqCVEQylAIiIv1LkGocQkQylAIiInMmT6AoT0uQikjmUkBEJDeWw6Lp5Zr6W0QylgIiQonactbvaqe7V0uQikjmUUBEqC5eoSVIRSRjKSAiVK+BahHJYAqICMUnFlGpJUhFJEMpICJkZiTi5ZrZVUQykgIiYonaCl7Zd1BLkIpIxlFARCxRW4E7rN+pVoSIZBYFRMQSfUuQahxCRDKMAiJilSX51FYW6UwmEck4CogMkIhrCVIRyTwKiAxQX1vBzgOHaTp4JOpSRET6KSAyQN/MrmvVzSQiGUQBkQEWTisLliDVQLWIZJC0BoSZLTezl81si5l9McX+GWb2uJmtNbOnzCw+aN85ZvZ7M9tkZhvNbGY6a41ScX4u508pZXWjxiFEJHOkLSDMLAZ8F3g3sAC43swWHHfYHcCP3L0O+Arw1UH7fgR8093nA0uBfemqNRMk4uWsbTygJUhFJGOkswWxFNji7lvd/SjwC+Ca445ZADwR3n+yb38YJLnu/iiAux9y9/Stzdn8KkT8wZyoreBAZzc/+EMDzYc0WC0i0UtnQEwHdgx63BhuG2wN8Jfh/b8ASs2sCjgfOGBmvzazl8zsm2GL5BhmdpOZrTKzVU1NTWdW5YEd8K8Xw93LYcvjkQXFOxZMYX5NGf/84CaW3v4YH/zB8/xy5esc6DwaST0iIlEPUn8WWGZmLwHLgJ1AL5ALvCXc/0ZgNnDj8U929++5+xJ3XzJp0qQzq6BkEiz/KrTtgJ/8JfzgHfDqo6MeFNUTCnjoE2/mkU+9hY9cdh6vt3byhV+t4423P8aH71nJb15q5GBX96jWJCLZzdLV521mFwP/6O7vCh/fCuDuXz3J8ROAze4eN7M3AV9392Xhvg8Cb3L3j57s/ZYsWeKrVq0684J7jsDqn8Kz3w7CYtqFsOwLcP67wOzMX/cMuTvrdrbxwNrdPLBmF7vauijIzeHyuZN5T2IaV8ybTFH+CY0qEZFhMbMX3H1Jyn1pDIhc4BXgbQQtg5XAB9x9w6BjqoFWd0+a2e1Ar7v/97A76UXg7e7eZGb/Caxy9++e7P3OOiD69ByFNT+HZ++AA69DTSIIirlXRhIUAMmk89KO/dy/ZjcPrttN08EjFOfHePv8KVxdV8OyuZMoyFVYiMjwRRIQ4RtfCfwLEAPudvfbzewrBB/2vzWzvyI4c8mBZ4CPuvuR8LnvAL4FGPACcFM42J3SiAVEn95uWPtLeOYO2N8AUxbBss/BvPdATnQ9c71J5/mGFu5fs5tH1u9mf2c3pYW5vGvhVK6uq+HS86rJi0XdcygiY0VkATGaRjwg+vT2wLr/H575JrS+BpMXwFs/Bwv+PNKgAOjuTfJ/tjTzwNrd/G79Hg4e6WFicR7LL6jhPYkaLppVRSwnmlaPiIwNCoiRkOyF9b+GZ74Bza/ApHlBUCz8C8iJvnvnSE8vz7zSzP1rdvHYpr10Hu1lUmkBVy2q4eq6Gi48ZyI5CgsROY4CYiQle2Hj/4anvwlNm6BqThAUF7wXYrnpf/8hOHy0lyc27+P+Nbt44uV9HO1JMq28kKvqanhPYhqLppdjEY2niEhmUUCkQzIJm34LT38D9m2AynPhrZ+FRe/LmKAAONjVzWOb9vLAmt0882oT3b3OjKpirg7DYu6UUoWFSBZTQKRTMgkvPwhPfx32rIOJM+Et/wUS10Msb/TrOYW2zm5+t2EP96/dxR9fa6E36Zw3eQLvqZvG1Ykazp00IeoSRWSUKSBGgzu88gg89TXYvRoqzoE3fwbq/xpy86Or6ySaDx3h4fV7uH/NLlZua8UdFtSUcXWihqsW1TCjqiTqEkVkFCggRpN7cCX201+DnS9AWRze8mlY/EHILYi6upT2tHXx4LrdPLB2Fy+9Hkw5Pq28kKWzKlk6q4qlsyo5d1KJuqJExiEFRBTc4bXH4amvQ+MKKJ0Gb/40XPghyCuMurqT2tHayROb97FiWysrGlr7V7mrKsnnjTMrw9CoZH5NmU6hFRkHFBBRcoetTwVjFK8/BxOmwps/BW+4EfKKoq7ulNydbS2drGhoYUXDflZsa2FH62EASgtyecPMiSydVclFsypZNL2C/FxdoCcy1iggMoE7bPtDEBTbnoWSyXDpJ2HJ30L+2Onv33XgMCvD1sWKhlZe3XcIgILcHBafU8HSWVVcNKuSxedUUJyfOWdzjUVd3b3saO1ke0snO/Z3Uj2hgIXTyphZVaJrWmTEKCAyzbb/EwRFw9NQXA2XfBze+PdQMPbOImo5dISV2/b3h8aGXW0kHXJzjAuml3NR2CW1ZEYl5cWZdVZXJmjr7GZ7awfbWzp5vbWTbc0dbG/t5PWWTva0d6V8Tkl+jPk1ZSycVsbCaeUsmFbG+VNK09uC27sBnvvX4Iy9hX8Jb78NCsvT934yahQQmer1PwXXUbz2OBRVwtKboHQqeBLwoNXhPuhxMsXj5MBxJz1m0LFDed2C0uAK8Zr6YU9QeLCrmxe2DwTGmh1tHO1NYgZzp5SGgVHFG2dNZHJp5o7FjJRk0tl38AjbWwY++Le1dPB62DJoO3zsFO6TSwuYUVXMOZUlzKgqDm8lxCcWsbe9iw272tm4q531O9vYtLudjqO9AOTFjDmTS8PQKGPh9HLm15QxoeAsWnHuwRopz90FW5+EvGKY+RbY8mjQAn7312HBNZFNYikjQwGR6XasDKbwePX3I/iiFvziWk54PyfF45xgKsTjj+lqg96jMHkh1H8A6t4PE85svY2u7l5W7zjAyoZWVmxr5YXt++kMP9RmVZewdNDAd3xi0Zg8U6q7N0nj/sNsH/TBH9yCx0d6kv3HxnKM6RVFAx/+lSWcE94/p7J4WN1yyaSzraWDDbvaw1sbG3e109IRzGlpBjOrSlgwbaC1sXBaGdUTTnM2XXcXrLsXnvsuNG2G0prgj5c33AjFlbDrJbj/k7B7Dcx5F1x1R3Bat4xJCoixoqM5mEU25Qf76T7sB3/on+WH7OH9wbxTq38anKqbkwtz3hlc0zHnnWd1XUd3b5INu9pZ2dDK8w2trNzW2v9XdE3/qbWVLJ1ZyXmTJ2RMYHQc6Qm7gYLuoL7WwPbWDnbuP0xy0K9RYV7OwAd/5UArYEZVMdMqitI62667s7f9CBt2tfWHxoZd7TTuP9x/zNSywv6WxoIwNOITi7DOFlj5A1j5fehoCmYwvuRjQZfS8f/mvT2w4nvwxD8DDpd/CS66JaNmEZChUUDImdu3OQiKtb+EQ3uhuCpoUdR/AKYuOuuXTyadV/cdYkVDC8+HA9/7wlNrzSDHLGjkGNjg+xg5x28zC/eFzzMAC18neE7fa8JA7g68x8DzB79ua0f3CeuEVxTnhR/+Jf1//ffdn1xakDHB1qets5sNu4MWRl9wbNl3iKTDubaTWwoe4c94hny62TNlGd1LP0JN4h3knm6dkQM74KHPwSsPB/8f3vMdmP6G0fmmZEQoIOTs9fYEYyWrfwqbH4JkN0ytC1oVi66FkqoReRt3Z3tLJysaWnm9tRPHg+ER+oZOPLzvJPuGUvqO6d8XbOvbD04yyTGvlQzvHPNaHPv67sFx5UV5/R/+fS2D8qIxPuDuzpFXnqTr2Tspb3ySbsvn8YK38Z1Db2dTTw0QnJk2r38wPOiimje1lMK82Amvxab74eHPw8E9QXfUFf8NCssi+MZkuBQQMrI6W2HdfUFY7F4NOXkwdznU/w2c93Z1M2SynqOw/r5gfGHv+mBN9qU3wZIPQ0k1Pb1JXmvqOKGL6mBXT/9L5MdyyI0ZsRwjL5YTfM0xSnMOc3PPz7im+yFarZJ/L7mZVcWXkptj5OYEz8nNMXJjOcd+zbFwX/haMXG6MzkAAAxtSURBVCOWkxN+Dd4jN+fY9yvKi3FOVTEzq0qonpCfcS22sUQBIemzZz2s/lnQBdXZHJzdknh/0LKYPD/q6qRPZyusuhtWfB8O7YFJ8+Hijwatv9Nc2e/uNO4/zIZdbby85xCHu3vp6U3Sk3R6kkl6k053r4dfk8Q7N/KBfd/mnKOv8ULRxdxd9hH2WXVwfK+HXweef8K2vtdKJhnKx9OEglxmVZcws7qEWdUlzKouZlb1BGZVlejU6iFQQEj69XYHZ2Gt/lkwaWGyB6ZdGIxVLPorKJoYdYXZqeU1+NO/wks/hZ7DcO4VcPHHgq/p/Ku7tyd436e+CljQ5bT0pmG3LpNhUAwOoZ7eJB1He9ne0kFDcwfbmjvY2tzBtpYTTxiYWJzXHx6zw68zq4IgKTmbU4DHEQWEjK5DTcEyrat/GnRjxApg3pVBF9S5l2fECnzjmjts/2Nw/cLLDwfTzte9D970UZiyYHRr2b8dHvps8MdDTSIYxJ62OG1vd6QnuPq8obmThuZDNDQHFx82NHeccOHh5NKCsMVRckwL5JzK4hPHWcYxBYREwx32rA3+el13b3D6bGkNJK4LuqCq50Rd4fjS2w0b/ncQDLtXBxdfvvHvg1vplOjqcg9WYXz4C8HpsxfdDJf/11GfOaDzaA/bmoMLFRuaB1ofDc0d/deOQNCwmlZexOxJA62NvgCJTxy505STSedIT5Ku7l4Od/fS1d1LV3eSw929HOnupasnfHx04H5X/3F9zwm21VYW84Xl886oDgWERK/nSND1tPpnwXTo3gvxpbD4r4OrtjVtw5k7fABe/CE8/+/QvjNYBvfijwZBnEkTQh4+AI9/JRgLKZsOV34zaFlmgPau7v6wGBweW5s7jhmgz80xaiuLg8CoKmFyWQFHwg/1ru5ejvT0Bh/o3Um6+u73JDlyXAgExyZPUdHJmUFhbozCvByK8mIU5sW4YHo5d15/Zi0zBYRkloN7YO29QRdU02bILYL57wnGK2YtgxzNCjskrQ3w/P+CF38M3R3BNBiXfBzOe0dm/wx3rAiuxN63Mfh3f/c3oGxa1FWl5O60dhxlW0sHW5uCcY4dTW3k73mRme2rqEq28IrHecVm0ZA7i568MgrzBj68C8IP8MLcHIryY/0f7IX994/9oC/Mywm/ptiXG6MwP4f8WM6InrWlgJDM5A67Xgy6oNbfF0zxURaH+uuDsKicHXWFmen154NupM0PBFfOX/BXcPFHgj7+saK3O/genvp6cKX+274cdIVl4vhUMhl0lTY8DVufDqbt7+7EMSiaiB1uHTi2/JzggsGpF4RfF0HFjIyer0oBIZmvuyuYKXT1z+C1J4KJA2sSwYSBNXUwNQFTFkJ+cdSVRqO3BzbfH1y/0Lgy6JJb8uHgzKAM/et7SFob4MHPBP/m0y4MBrFr6qKtyR1atgTruDQ8E0zPf3h/sK96LsxeFrR0Z14anJ13cC/sXResSb9nXXDqd8ur4eSXQEEZTLng2OCYND9jFg5TQMjY0r4L1vw8+AXdvRa6gmVQsZygf72mLriKu+9rcWWk5Y64jpag661pMzS9HHzduyG4zmTirHB84foxOT18Su6w/lfwyBeD6zUu/ghcduvorpPStjNoITQ8E7QSDu4KtpfXBmEwexnMemsw2/JQHO2EfZuODY69G+BosH4KFoPq8wdaGVMvCP4vl1Sn5/s7BQWEjF3u0LYjCIo9awe+tu8cOKa8NvwlGxQa5fGMbtbjDof2HRsCfV87mweOy58Ak+YGf7nOuxLmXpmZ3TAj4fB+ePS2YMC9/By46ltw/jvT816drUHLYOvTQTC0bAm2F1cFQTArDITK2SP3/yiZhP0NYVisHwiOwf+XS2sGtTbCW+XstP6bKyBk/OlogT1rBgJjzzpofpVgRiWCUzynLhronqqpg6rzRv/D1T34ADghCF4eaBkBFJTD5HlBGEwa9LVsemYHXTpsfw4e+FTws1rw58G6E0P9y/1kjnYEr9vwVBAKe9YBHgTwjEuDMJi9LJjifrQH+DtbB7UywuBo2hxcbArBOhxTFg4KjrrgepYRamEpICQ7HO0ImvG71wy0NvZtDNa2gOBsqSkLj+2imrxwZPqCk0loe/3E1kDTK3D04MBxRZXBFCTHB8GEKdkXBKfScxT++B14+puQWxCsYPeGDw/9w7vnKOxcNdBCaFwVTDAZyw9Or+4bR5h+YXAhYabpORL8HzomONYGJ3IAYFB1bhAYUy4IZtA99/IzeisFhGSv3u7wF23tsa2NI+3BfosFH9KDu6emLoKiipO8Xg/s3wbNKYKgZ2DNBSZMOTEEJs2LpI95TGt5DR74dPAhH39jMIg9ZeGJxw0+06jhmaC10N0BGEyrHxhHqH3T2D3Roa+7dU/Yyugb39i/LQi9v3/0jF5WASEymHvwSzU4NHavDSax61NxThgaieD4vjBoeXWgRQLBabnHBMHcYPBxvA2cR8k9uG7md7cGf0Ff/DFY9oXgZIa+LqPTnWk0nnW1B+NWZ3hauAJCZCgO7QsDY9DYRuvWYF/FjBNbA9VztObBaOpshUe/DC/9JJjfqzdcxGnwmUYz3wJlNdHWOcYoIETO1JGDwem1o3nKpZzatj8E65HU1AXBMJJnGmWhUwWE5rsVOZWC0qgrkOPNfHNwk7TL4AlbREQkSgoIERFJSQEhIiIpKSBERCQlBYSIiKSkgBARkZQUECIikpICQkREUho3V1KbWROw/SxeohpoPu1R2UE/i2Pp53Es/TwGjIefxQx3n5Rqx7gJiLNlZqtOdrl5ttHP4lj6eRxLP48B4/1noS4mERFJSQEhIiIpKSAGfC/qAjKIfhbH0s/jWPp5DBjXPwuNQYiISEpqQYiISEoKCBERSSnrA8LMlpvZy2a2xcy+GHU9UTKzWjN70sw2mtkGM/tk1DVFzcxiZvaSmT0QdS1RM7MKM7vPzDab2SYzuzjqmqJkZp8Of0/Wm9nPzaww6ppGWlYHhJnFgO8C7wYWANeb2YJoq4pUD/Bf3H0B8Cbgo1n+8wD4JLAp6iIyxHeAR9x9HpAgi38uZjYd+ASwxN0vAGLAddFWNfKyOiCApcAWd9/q7keBXwDXRFxTZNx9t7u/GN4/SPABMD3aqqJjZnHgKuA/oq4lamZWDrwV+AGAux919wPRVhW5XKDIzHKBYmBXxPWMuGwPiOnAjkGPG8niD8TBzGwmsBh4PtpKIvUvwOeBZNSFZIBZQBPwn2GX23+YWUnURUXF3XcCdwCvA7uBNnf/fbRVjbxsDwhJwcwmAL8CPuXu7VHXEwUzuxrY5+4vRF1LhsgFLgT+zd0XAx1A1o7ZmdlEgt6GWcA0oMTM/ibaqkZetgfETqB20ON4uC1rmVkeQTj81N1/HXU9EboU+DMz20bQ9XiFmf0k2pIi1Qg0untfi/I+gsDIVm8HGty9yd27gV8Dl0Rc04jL9oBYCcwxs1lmlk8wyPTbiGuKjJkZQR/zJnf/dtT1RMndb3X3uLvPJPh/8YS7j7u/EIfK3fcAO8xsbrjpbcDGCEuK2uvAm8ysOPy9eRvjcNA+N+oCouTuPWb2MeB3BGch3O3uGyIuK0qXAh8E1pnZ6nDbl9z9oQhrkszxceCn4R9TW4G/jbieyLj782Z2H/Aiwdl/LzEOp93QVBsiIpJStncxiYjISSggREQkJQWEiIikpIAQEZGUFBAiIpKSAkJkGMys18xWD7qN2NXEZjbTzNaP1OuJnK2svg5C5Awcdvf6qIsQGQ1qQYiMADPbZmbfMLN1ZrbCzM4Lt880syfMbK2ZPW5m54Tbp5jZb8xsTXjrm6YhZmbfD9cZ+L2ZFUX2TUnWU0CIDE/RcV1M7x+0r83dFwF3EcwEC/A/gR+6ex3wU+DOcPudwNPuniCY06jvCv45wHfdfSFwAHhvmr8fkZPSldQiw2Bmh9x9Qort24Ar3H1rOOHhHnevMrNmoMbdu8Ptu9292syagLi7Hxn0GjOBR919Tvj4C0Ceu/9z+r8zkROpBSEycvwk94fjyKD7vWicUCKkgBAZOe8f9PW58P4fGViK8q+BZ8P7jwO3QP+61+WjVaTIUOmvE5HhKRo00y0EazT3neo60czWErQCrg+3fZxgFbbPEazI1jcD6ieB75nZ3xG0FG4hWJlMJGNoDEJkBIRjEEvcvTnqWkRGirqYREQkJbUgREQkJbUgREQkJQWEiIikpIAQEZGUFBAiIpKSAkJERFL6vzd6Sg8k4gWEAAAAAElFTkSuQmCC
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can extract the weights of the embeddings and examine the shape and length.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">emb</span> <span class="o">=</span> <span class="n">keras_model</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">'embedding_1'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">emb_weights</span> <span class="o">=</span> <span class="n">emb</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'The shape of embedded weights: '</span><span class="p">,</span> <span class="n">emb_weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'The length of embedded weights: '</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">emb_weights</span><span class="p">))</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">The shape of embedded weights:  (103731, 50)</span>
<span class="code-line">The length of embedded weights:  103731</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a id="cos-similarity"></a></p>
<h3 id="Cosine-Similarity"><code>Cosine Similarity</code><a class="anchor-link" href="#Cosine-Similarity">¶</a></h3><p>   <font size="4">This distance-evaluation metric, also known as item-to-item similarity, calculates the similarity scores between two items in a vector residing in a multidimensional inner product space. This is made possible by vectorization, which converts words into vectors (numbers), allowing their meaning to be encoded and processed mathematically. Then the cosine of the angle between the two vector items as projected in the multidimensional space can be determined.</font></p>
<p>   <font size="4">Each item is now represented as a 50-dimensional vector. The embeddings need to normalized so the dot product between two embeddings is the <code>Cosine Similarity</code>, which calculates a numeric value representing the similarity between two items. The embedding layers from the model are needed to compute the <code>Cosine Similarity</code> via a dot product.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">emb_weights</span> <span class="o">=</span> <span class="n">emb_weights</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">emb_weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">rest_id_emb</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'itemID'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Number of unique embedded weights:'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest_id_emb</span><span class="p">))</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Number of unique embedded weights: 103731</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Next, let's create a <code>pandas.Dataframe</code> containing all the unique items in the 50 dimensions with their embedded weights.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">rest_pd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">emb_weights</span><span class="p">)</span></span>
<span class="code-line"><span class="n">rest_pd</span><span class="p">[</span><span class="s1">'itemID'</span><span class="p">]</span> <span class="o">=</span> <span class="n">rest_id_emb</span></span>
<span class="code-line"><span class="n">rest_pd</span> <span class="o">=</span> <span class="n">rest_pd</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'itemID'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">rest_pd</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div id="df-989a7667-8036-4ba1-b808-8e215be0bd05">
<div class="colab-df-container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe table-striped table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>...</th>
<th>40</th>
<th>41</th>
<th>42</th>
<th>43</th>
<th>44</th>
<th>45</th>
<th>46</th>
<th>47</th>
<th>48</th>
<th>49</th>
</tr>
<tr>
<th>itemID</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>000503860X</th>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>...</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
</tr>
<tr>
<th>0005092663</th>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>...</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
</tr>
<tr>
<th>0005019281</th>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>...</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
</tr>
<tr>
<th>0005119367</th>
<td>-0.141163</td>
<td>1.477967e-01</td>
<td>2.316365e-29</td>
<td>0.147855</td>
<td>-0.147876</td>
<td>1.178349e-01</td>
<td>0.082837</td>
<td>1.471831e-01</td>
<td>-1.494529e-01</td>
<td>1.230121e-01</td>
<td>...</td>
<td>-1.486145e-01</td>
<td>1.413215e-01</td>
<td>1.493893e-01</td>
<td>-0.149376</td>
<td>2.305986e-29</td>
<td>-0.147192</td>
<td>1.488855e-01</td>
<td>-0.149351</td>
<td>-1.472584e-01</td>
<td>0.150208</td>
</tr>
<tr>
<th>0005123968</th>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>...</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>B01HHZKOG0</th>
<td>-0.008267</td>
<td>-2.236083e-01</td>
<td>-2.599621e-02</td>
<td>-0.223686</td>
<td>-0.144924</td>
<td>2.091652e-01</td>
<td>-0.120053</td>
<td>-1.055703e-01</td>
<td>2.093079e-01</td>
<td>-1.650761e-01</td>
<td>...</td>
<td>5.156517e-02</td>
<td>-2.127886e-01</td>
<td>8.212486e-03</td>
<td>-0.005607</td>
<td>-2.685340e-02</td>
<td>-0.015225</td>
<td>-1.140203e-02</td>
<td>0.216453</td>
<td>5.390420e-02</td>
<td>-0.241080</td>
</tr>
<tr>
<th>B01HI8KC5E</th>
<td>0.000015</td>
<td>-1.177827e-28</td>
<td>1.772185e-08</td>
<td>-0.006270</td>
<td>0.011387</td>
<td>-1.183634e-28</td>
<td>-0.001693</td>
<td>1.198261e-28</td>
<td>1.190786e-28</td>
<td>-1.198461e-28</td>
<td>...</td>
<td>1.178250e-28</td>
<td>-5.411250e-14</td>
<td>6.627290e-07</td>
<td>0.000355</td>
<td>1.078850e-03</td>
<td>-0.000003</td>
<td>-5.405612e-09</td>
<td>0.000071</td>
<td>1.029599e-18</td>
<td>-0.001684</td>
</tr>
<tr>
<th>B01HI87P4K</th>
<td>-0.192161</td>
<td>9.981440e-04</td>
<td>-1.826643e-01</td>
<td>-0.178949</td>
<td>0.162945</td>
<td>1.688821e-01</td>
<td>-0.000266</td>
<td>-1.660917e-01</td>
<td>1.671402e-01</td>
<td>1.536722e-01</td>
<td>...</td>
<td>1.100356e-01</td>
<td>-1.763748e-01</td>
<td>3.756321e-02</td>
<td>-0.114001</td>
<td>-1.473959e-02</td>
<td>-0.120297</td>
<td>1.098178e-01</td>
<td>0.197131</td>
<td>1.383827e-01</td>
<td>-0.150529</td>
</tr>
<tr>
<th>B01HJ6R77G</th>
<td>0.011110</td>
<td>-1.364973e-01</td>
<td>1.508010e-02</td>
<td>-0.047702</td>
<td>0.006104</td>
<td>1.077538e-01</td>
<td>-0.136790</td>
<td>4.593020e-04</td>
<td>2.395007e-01</td>
<td>-9.541614e-02</td>
<td>...</td>
<td>1.375569e-01</td>
<td>5.134614e-06</td>
<td>-2.457947e-01</td>
<td>0.157121</td>
<td>-1.206576e-02</td>
<td>-0.000002</td>
<td>-1.642001e-01</td>
<td>0.144495</td>
<td>7.963887e-02</td>
<td>-0.340266</td>
</tr>
<tr>
<th>B01HJF79XO</th>
<td>0.149675</td>
<td>-1.460049e-01</td>
<td>1.408108e-01</td>
<td>0.130977</td>
<td>-0.136690</td>
<td>-1.266955e-01</td>
<td>-0.148206</td>
<td>1.487567e-01</td>
<td>1.501051e-01</td>
<td>-1.427349e-01</td>
<td>...</td>
<td>-1.487200e-01</td>
<td>1.455216e-01</td>
<td>-2.347758e-29</td>
<td>0.138634</td>
<td>-1.514007e-01</td>
<td>0.145058</td>
<td>1.487101e-01</td>
<td>-0.147483</td>
<td>1.478791e-01</td>
<td>0.153532</td>
</tr>
</tbody>
</table>
<p>103731 rows × 50 columns</p>
</div>
<button class="colab-df-convert" onclick="convertToInteractive('df-989a7667-8036-4ba1-b808-8e215be0bd05')" style="display:none;" title="Convert this dataframe to an interactive table.">
<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
</svg>
</button>
<style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>
<script>
        const buttonEl =
          document.querySelector('#df-989a7667-8036-4ba1-b808-8e215be0bd05 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-989a7667-8036-4ba1-b808-8e215be0bd05');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can create a <code>temp</code> dataframe that contains the unique IDs of the items and use an inner <code>pandas.Merge</code> to get the items, then create a copy of the <code>itemID</code> column as <code>Item</code> and remove <code>inf</code> and <code>-inf</code> from the data.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'itemID'</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df_recommend</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">rest_pd</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">'itemID'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df_recommend</span><span class="p">[</span><span class="s1">'Item'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_recommend</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">'itemID'</span><span class="p">]</span></span>
<span class="code-line"><span class="n">df_recommend</span> <span class="o">=</span> <span class="n">df_recommend</span><span class="p">[</span><span class="o">~</span><span class="n">df_recommend</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span></span>
<span class="code-line">                                                <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span></span>
<span class="code-line"><span class="n">df_recommend</span><span class="o">.</span><span class="n">shape</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">(63771, 52)</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a id="recommendation"></a></p>
<h3 id="Recommendation"><code>Recommendation</code><a class="anchor-link" href="#Recommendation">¶</a></h3><p>   <font size="4">Let's now use the trained model to recommend items that should be suggested to be purchased with the items that are the most rated in the set. We can define a function <code>find_similarity_total</code> that calculates the <code>cosine similarity</code> between the target and the rest of the other items storing the result in a table.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">find_similarity_total</span><span class="p">(</span><span class="n">item_name</span><span class="p">):</span></span>
<span class="code-line"><span class="w">    </span><span class="sd">""" Recommends item based on the cosine similarity between items """</span></span>
<span class="code-line">    <span class="n">cosine_list_total</span> <span class="o">=</span> <span class="p">[]</span></span>
<span class="code-line">    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span></span>
<span class="code-line">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_recommend</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span></span>
<span class="code-line">        <span class="n">sample_name</span> <span class="o">=</span> <span class="n">df_recommend</span><span class="p">[</span><span class="n">df_recommend</span><span class="p">[</span><span class="s1">'Item'</span><span class="p">]</span> <span class="o">==</span> <span class="n">item_name</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span></span>
<span class="code-line">        <span class="n">row</span> <span class="o">=</span> <span class="n">df_recommend</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">51</span><span class="p">]</span></span>
<span class="code-line">        <span class="n">cosine_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sample_name</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span></span>
<span class="code-line">        <span class="n">recommended_name</span> <span class="o">=</span> <span class="n">df_recommend</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">51</span><span class="p">]</span></span>
<span class="code-line">        <span class="n">cosine_list_total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cosine_total</span><span class="p">)</span></span>
<span class="code-line">        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recommended_name</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">cosine_df_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'similar_item'</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span></span>
<span class="code-line">                                    <span class="s1">'cosine'</span><span class="p">:</span> <span class="n">cosine_list_total</span><span class="p">})</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">return</span> <span class="n">cosine_df_total</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's now call the function with the most frequent item, <code>B009934S5M</code>, as the input. We can then apply a <code>lambda</code> function with the <code>convert</code> function to create a new column called <code>cos</code> in the result dataframe, drop the original <code>cosine</code> column (which had values with np.array), and sort with the highest values first. These items with the highest <code>cos</code> are the most similar to the input item.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span></span>
<span class="code-line"><span class="w">  </span><span class="sd">""" Replace '[]' to empty strings &amp; convert string to float """</span></span>
<span class="code-line">    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'['</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">']'</span><span class="p">,</span><span class="s1">''</span><span class="p">))</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">find_similarity_total</span><span class="p">(</span><span class="s1">'B009934S5M'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="p">[</span><span class="s1">'cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">convert</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">'cosine'</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'cosine'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'cos'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div id="df-5e4e14cd-5c13-45b8-a0c4-f374b7d93852">
<div class="colab-df-container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe table-striped table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>similar_item</th>
<th>cos</th>
</tr>
</thead>
<tbody>
<tr>
<th>60553</th>
<td>B00KHW4XHM</td>
<td>1.148089</td>
</tr>
<tr>
<th>37066</th>
<td>B0000JLLAO</td>
<td>1.115949</td>
</tr>
<tr>
<th>30263</th>
<td>B01F6EHOIK</td>
<td>1.112725</td>
</tr>
<tr>
<th>16538</th>
<td>B00199PP6U</td>
<td>1.043721</td>
</tr>
<tr>
<th>6666</th>
<td>B00005LZOF</td>
<td>1.038528</td>
</tr>
<tr>
<th>8372</th>
<td>B00009IAXL</td>
<td>1.018756</td>
</tr>
<tr>
<th>38499</th>
<td>B0006FFRKM</td>
<td>1.013303</td>
</tr>
<tr>
<th>32816</th>
<td>6304492952</td>
<td>1.005688</td>
</tr>
<tr>
<th>23900</th>
<td>B009934S5M</td>
<td>1.000000</td>
</tr>
<tr>
<th>42424</th>
<td>B000HT3QBY</td>
<td>0.999978</td>
</tr>
</tbody>
</table>
</div>
<button class="colab-df-convert" onclick="convertToInteractive('df-5e4e14cd-5c13-45b8-a0c4-f374b7d93852')" style="display:none;" title="Convert this dataframe to an interactive table.">
<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
</svg>
</button>
<style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>
<script>
        const buttonEl =
          document.querySelector('#df-5e4e14cd-5c13-45b8-a0c4-f374b7d93852 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-5e4e14cd-5c13-45b8-a0c4-f374b7d93852');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">The model recommends items that should be suggested to be purchased with the most rated item, which was <code>Star Trek Into Darkness (Blu-ray)</code> (<code>B009934S5M</code>).</font></p>
<ul>
<li><code>B00KHW4XHM</code> - Criterion Collection: Golden Age of Television</li>
<li><code>B0000JLLAO</code> - Not found</li>
<li><code>B01F6EHOIK</code> - Red Sonja: Queen Of Plagues</li>
<li><code>B00199PP6U</code> - Adventures of the Galaxy Rangers Collection Vol. 2</li>
<li><code>B00005LZOF</code> - Not found</li>
<li><code>B00009IAXL</code> - Malibooty: Beach with 5:1 ratio females:male</li>
<li><code>B0006FFRKM</code> - Stellvia: Foundation III - Anime sold of Amazon Italy</li>
<li><code>6304492952</code> - Disney Sing Along Songs - The Early Years, Collection of All-Time Favorites VHS</li>
<li><code>B009934S5M</code> - Star Trek Into Darkness (Blu-ray)</li>
<li><code>B000HT3QBY</code> - The Most Beautiful Wife - Italy, mafia, girl punished</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's call the function again using another frequent item as input.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">find_similarity_total</span><span class="p">(</span><span class="s1">'B00PY4Q9OS'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="p">[</span><span class="s1">'cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">convert</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">'cosine'</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'cosine'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'cos'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div id="df-55942d58-a43d-4ddc-ae70-4371366ffb7f">
<div class="colab-df-container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe table-striped table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>similar_item</th>
<th>cos</th>
</tr>
</thead>
<tbody>
<tr>
<th>28219</th>
<td>B00PY4Q9OS</td>
<td>1.000000</td>
</tr>
<tr>
<th>9836</th>
<td>B00062IZ2C</td>
<td>0.999615</td>
</tr>
<tr>
<th>29467</th>
<td>B0157757NK</td>
<td>0.999062</td>
</tr>
<tr>
<th>20906</th>
<td>B004L1DB9G</td>
<td>0.998818</td>
</tr>
<tr>
<th>7998</th>
<td>B00008973P</td>
<td>0.998594</td>
</tr>
<tr>
<th>34385</th>
<td>B00004I9YP</td>
<td>0.998380</td>
</tr>
<tr>
<th>12898</th>
<td>B000H4JH4O</td>
<td>0.997436</td>
</tr>
<tr>
<th>57305</th>
<td>B00ABCJQZW</td>
<td>0.997081</td>
</tr>
<tr>
<th>41731</th>
<td>B000FJMZ0O</td>
<td>0.997028</td>
</tr>
<tr>
<th>6437</th>
<td>B00005JM7T</td>
<td>0.996673</td>
</tr>
</tbody>
</table>
</div>
<button class="colab-df-convert" onclick="convertToInteractive('df-55942d58-a43d-4ddc-ae70-4371366ffb7f')" style="display:none;" title="Convert this dataframe to an interactive table.">
<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
</svg>
</button>
<style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>
<script>
        const buttonEl =
          document.querySelector('#df-55942d58-a43d-4ddc-ae70-4371366ffb7f button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-55942d58-a43d-4ddc-ae70-4371366ffb7f');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">The model recommends items that should be suggested to be purchased with the most second most rated item, which was <code>Guardians of the Galaxy 3D - Limited Edition Steelbook</code> (<code>B00PY4Q9OS</code>).</font></p>
<ul>
<li><code>B00062IZ2C</code> - Star Hunter 01</li>
<li><code>B0157757NK</code> - Fire City: End of Days - Battle over earth w demons</li>
<li><code>B004L1DB9G</code> - Born to Fight [Blu-ray] - Train for the biggest boxing match with a bully</li>
<li><code>B00008973P</code> - 101 Reykjavík [DVD] - Contemporary Icelandic version of American movies of the 1970s like Five Easy Pieces, in which antiheroic characters struggle</li>
<li><code>B00004I9YP</code> - Not found</li>
<li><code>B000H4JH4O</code> - Keeping Up With the Steins [DVD] - Heartwarming coming-of-age comedy when three generations collide in a crazy family reunion</li>
<li><code>B00ABCJQZW</code> - Celebrate With Clifford (Clifford The Big Red Dog)  [DVD]</li>
<li><code>B000FJMZ0O</code> - Not found</li>
<li><code>B00005JM7T</code> - Dr. Seuss' The Cat In The Hat (Widescreen Edition) [DVD]</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's call the function again using another frequent item as input.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">find_similarity_total</span><span class="p">(</span><span class="s1">'B00R8GUXPG'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="p">[</span><span class="s1">'cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">convert</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">'cosine'</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'cosine'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'cos'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div id="df-01248c59-65aa-479f-b1c3-db3059c75bd3">
<div class="colab-df-container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe table-striped table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>similar_item</th>
<th>cos</th>
</tr>
</thead>
<tbody>
<tr>
<th>42262</th>
<td>B000H6SUYK</td>
<td>1.193777</td>
</tr>
<tr>
<th>9370</th>
<td>B00023GFUY</td>
<td>1.161545</td>
</tr>
<tr>
<th>2121</th>
<td>6303023355</td>
<td>1.151336</td>
</tr>
<tr>
<th>20807</th>
<td>B004I1CVV8</td>
<td>1.151042</td>
</tr>
<tr>
<th>49743</th>
<td>B001O17SW2</td>
<td>1.141012</td>
</tr>
<tr>
<th>47718</th>
<td>B0019BLYUO</td>
<td>1.076888</td>
</tr>
<tr>
<th>15472</th>
<td>B000ZBEOGK</td>
<td>1.072506</td>
</tr>
<tr>
<th>39396</th>
<td>B0009OUBUG</td>
<td>1.057287</td>
</tr>
<tr>
<th>52853</th>
<td>B00443FMK2</td>
<td>1.040808</td>
</tr>
<tr>
<th>36531</th>
<td>B00008PW2B</td>
<td>1.035146</td>
</tr>
</tbody>
</table>
</div>
<button class="colab-df-convert" onclick="convertToInteractive('df-01248c59-65aa-479f-b1c3-db3059c75bd3')" style="display:none;" title="Convert this dataframe to an interactive table.">
<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
</svg>
</button>
<style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>
<script>
        const buttonEl =
          document.querySelector('#df-01248c59-65aa-479f-b1c3-db3059c75bd3 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-01248c59-65aa-479f-b1c3-db3059c75bd3');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Item ID (ASIN) was not able to be found.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Batch-Size-=-8"><code>Batch Size = 8</code><a class="anchor-link" href="#Batch-Size-=-8">¶</a></h2><p>   <font size="4">Let's now set the path where model is saved and set up the logs/callbacks containing the <code>EarlyStopping</code> class that monitors the <code>val_loss</code> and will stop training if it does not improve after 3 <code>epochs</code>, the <code>ModelCheckpoint</code> class that monitors the <code>val_loss</code> saving only the best one with a <code>min</code> loss as well as the <code>TensorBoard</code> class that enables visualizations using the <code>TensorBoard</code>.</font></p>
<p>   <font size="4">Now the model can be trained by calling <code>fit</code> utilizing the train dataset for 10 <code>epochs</code>, which is the iterations over the entire <code>X_train</code> and <code>y_train</code>, using a <code>batch_size=8</code>, which is the number of samples per gradient update, and the specified callbacks from the <code>callbacks_list</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="o">!</span>rm<span class="w"> </span>-rf<span class="w"> </span>/logs/</span>
<span class="code-line"></span>
<span class="code-line"><span class="o">%</span><span class="k">load_ext</span> tensorboard</span>
<span class="code-line"></span>
<span class="code-line"><span class="n">log_folder</span> <span class="o">=</span> <span class="s1">'logs/fit/'</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y%m</span><span class="si">%d</span><span class="s1">-%H%M%S'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">filepath</span> <span class="o">=</span> <span class="s1">'CF_Baseline_b8_dropout0.2_weights_only.h5'</span></span>
<span class="code-line"><span class="n">checkpoint_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">tensorboard_callback</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">TensorBoard</span><span class="p">(</span><span class="n">log_folder</span><span class="p">,</span></span>
<span class="code-line">                                                      <span class="n">histogram_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">callbacks_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">'val_loss'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">'val_loss'</span><span class="p">,</span></span>
<span class="code-line">                                  <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'min'</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">tensorboard_callback</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">history</span> <span class="o">=</span> <span class="n">keras_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train_array</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span></span>
<span class="code-line">                          <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test_array</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span></span>
<span class="code-line">                          <span class="n">batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks_list</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Epoch 1/10</span>
<span class="code-line">111488/111488 [==============================] - 574s 5ms/step - loss: 1.0626 - val_loss: 1.0098</span>
<span class="code-line">Epoch 2/10</span>
<span class="code-line">111488/111488 [==============================] - 571s 5ms/step - loss: 1.0186 - val_loss: 1.0042</span>
<span class="code-line">Epoch 3/10</span>
<span class="code-line">111488/111488 [==============================] - 568s 5ms/step - loss: 1.0181 - val_loss: 1.0056</span>
<span class="code-line">Epoch 4/10</span>
<span class="code-line">111488/111488 [==============================] - 566s 5ms/step - loss: 1.0196 - val_loss: 1.0078</span>
<span class="code-line">Epoch 5/10</span>
<span class="code-line">111488/111488 [==============================] - 565s 5ms/step - loss: 1.0211 - val_loss: 1.0091</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">The model stopped at the 5th <code>epoch</code> because  <code>patience=3</code> was set. Let's now save the model and predict using the test set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">keras_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'./baselineCF_Model2_batch8_dropout0.2_tf.h5'</span><span class="p">,</span></span>
<span class="code-line">                 <span class="n">save_format</span><span class="o">=</span><span class="s1">'tf'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">predictions</span> <span class="o">=</span> <span class="n">keras_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_array</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">6968/6968 [==============================] - 9s 1ms/step</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Then, we create a <code>pandas.Dataframe</code> containing the test set's <code>review_i</code>, <code>item_i</code>, <code>ratin</code> and<code>predictio</code> results.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df_test</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">'user'</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df_test</span><span class="p">[</span><span class="s1">'items'</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span></span>
<span class="code-line"><span class="n">df_test</span><span class="p">[</span><span class="s1">'stars'</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_test</span></span>
<span class="code-line"><span class="n">df_test</span><span class="p">[</span><span class="s1">'predictions'</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span></span>
<span class="code-line"><span class="n">df_test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div id="df-99fb4eaf-f546-4b2f-b098-3c2a9eaa1437">
<div class="colab-df-container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe table-striped table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>user</th>
<th>items</th>
<th>stars</th>
<th>predictions</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>14701</td>
<td>17937</td>
<td>3.0</td>
<td>2.267012</td>
</tr>
<tr>
<th>1</th>
<td>17387</td>
<td>97250</td>
<td>5.0</td>
<td>3.749072</td>
</tr>
<tr>
<th>2</th>
<td>17411</td>
<td>66343</td>
<td>4.0</td>
<td>4.731325</td>
</tr>
<tr>
<th>3</th>
<td>6792</td>
<td>10159</td>
<td>5.0</td>
<td>3.781336</td>
</tr>
<tr>
<th>4</th>
<td>2965</td>
<td>77733</td>
<td>5.0</td>
<td>4.521596</td>
</tr>
</tbody>
</table>
</div>
<button class="colab-df-convert" onclick="convertToInteractive('df-99fb4eaf-f546-4b2f-b098-3c2a9eaa1437')" style="display:none;" title="Convert this dataframe to an interactive table.">
<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
</svg>
</button>
<style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>
<script>
        const buttonEl =
          document.querySelector('#df-99fb4eaf-f546-4b2f-b098-3c2a9eaa1437 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-99fb4eaf-f546-4b2f-b098-3c2a9eaa1437');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can utilize the actual <code>ratings</code> from the original test set and the predicted ones to plot the distribution of the actual ratings using <code>matplotlib.pyplot.bar</code> and the predicted ratings using <code>matplotlib.pyplot.hist</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">values</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df_test</span><span class="p">[</span><span class="s1">'stars'</span><span class="p">],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">tick_label</span><span class="o">=</span><span class="p">[</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'2'</span><span class="p">,</span><span class="s1">'3'</span><span class="p">,</span><span class="s1">'4'</span><span class="p">,</span><span class="s1">'5'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'true value'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'predicted value'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Ratings'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Ratings Histogram'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,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tXqMO+64g3/5l38BoFu3bmy00UbL9Lntttu47bbb2HHHHRk2bBiPP/44M2fO5D//8z855JBDWG+99dhwww2Xe6pi7NixXHvttQBMmDBhSe2PPPIIu+++O9tttx1XX301jz76aMPfzW233caVV17JDjvswC677MKCBQuYOXNmw9tLklrXlPscRMT/AhYBVzfj+C0y81LgUoDhw4evnQkAa9nSgx7179dff32gdj3/Pvvsw89+9rNK3+nTp6+1OjKT008/nS984QuV9h/96EcNbT9mzBi+/vWv8+KLLzJ16lT22msvAI455hhuvPFGhg4dyhVXXMFdd921zLbdu3dfckqi/rLEzOTCCy9k9OjRq/mpJEmtafdwEBHHUJuouHdmtvwgzwX61XXrW9pYTvsCYOOI6F5GB+r7t+xrTkR0BzYq/Tulv/zlL9x7772MHDmSa665ht12222ZPrvuuisnnXQSs2bN4mMf+xivv/46c+fOZdCgQcyePZsnn3ySrbbaapnw0GLvvffmkksu4ctf/jLvvvsuCxcuZIMNNuC1115b0mf06NF885vf5Mgjj6RXr17MnTuXHj16sMcee3DMMcdw+umns2jRIm6++eZlAgRAr1692HnnnTnllFM48MADl0ygfO2119hiiy145513uPrqq+nTp88y2/bv35+pU6cyYsQIrr/++iXto0eP5pJLLmGvvfaiR48e/OlPf6JPnz5LQpOkzq3/ab9qdgkdyuxzDmi3Y7XraYVy5cG/AWMys37m2UTg8Ij4YLkKYSDwADAZGBgRAyJiHWqTFieWUHEncGjZ/mjgprp9HV2WDwXuqAshnc7WW2/NRRddxDbbbMNLL720ZPi/3mabbcYVV1zBEUccwfbbb8/IkSN5/PHH6dmzJ5deeikHHHAAw4YN48Mf/nCrxzj//PO588472W677dhpp52YMWMGvXv3ZtSoUQwZMoRTTz2Vfffdl3/8x39k5MiRbLfddhx66KG89tprDBs2jLFjxzJ06FD2339/dt555+V+lrFjx3LVVVctOaUAcNZZZ7HLLrswatQoBg0a1Op2//qv/8oll1zCjjvuyAsvvLCk/fOf/zyDBw9m2LBhDBkyhC984QssWrSo1X1IkhoXbfW7GRE/A/YENgWeB86gdnXCB3nvL/n7MvOfS///RW0ewiLgy5n569L+SeBH1C5l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
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now, let's examine metrics from the model and plot the model <code>loss</code> and <code>val_loss</code> over the training epochs.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'loss'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'val_loss'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Model Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epoch'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">'Train'</span><span class="p">,</span> <span class="s1">'Eval'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,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
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can extract the weights of the embeddings and examine the shape and length.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">emb</span> <span class="o">=</span> <span class="n">keras_model</span><span class="o">.</span><span class="n">get_layer</span><span class="p">(</span><span class="s1">'embedding_11'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">emb_weights</span> <span class="o">=</span> <span class="n">emb</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'The shape of embedded weights: '</span><span class="p">,</span> <span class="n">emb_weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'The length of embedded weights: '</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">emb_weights</span><span class="p">))</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">The shape of embedded weights:  (103731, 50)</span>
<span class="code-line">The length of embedded weights:  103731</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a id="cos-similarity"></a></p>
<h3 id="Cosine-Similarity"><code>Cosine Similarity</code><a class="anchor-link" href="#Cosine-Similarity">¶</a></h3><p>   <font size="4">Each item is now represented as a 50-dimensional vector. The embeddings need to normalized so the dot product between two embeddings is the <code>Cosine Similarity</code>, which calculates a numeric value representing the similarity between two items. The embedding layers from the model are needed to compute the <code>Cosine Similarity</code> via a dot product.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">emb_weights</span> <span class="o">=</span> <span class="n">emb_weights</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">emb_weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">rest_id_emb</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'itemID'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Number of unique embedded weights:'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest_id_emb</span><span class="p">))</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Number of unique embedded weights: 103731</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Next, let's create a <code>pandas.Dataframe</code> containing all the unique items in the 50 dimensions with their embedded weights.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">rest_pd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">emb_weights</span><span class="p">)</span></span>
<span class="code-line"><span class="n">rest_pd</span><span class="p">[</span><span class="s1">'itemID'</span><span class="p">]</span> <span class="o">=</span> <span class="n">rest_id_emb</span></span>
<span class="code-line"><span class="n">rest_pd</span> <span class="o">=</span> <span class="n">rest_pd</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'itemID'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">rest_pd</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div id="df-35df8a94-e255-46f6-9457-2403d7342e92">
<div class="colab-df-container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe table-striped table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>...</th>
<th>40</th>
<th>41</th>
<th>42</th>
<th>43</th>
<th>44</th>
<th>45</th>
<th>46</th>
<th>47</th>
<th>48</th>
<th>49</th>
</tr>
<tr>
<th>itemID</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>000503860X</th>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>...</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
</tr>
<tr>
<th>0005092663</th>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>...</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
</tr>
<tr>
<th>0005019281</th>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>...</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
</tr>
<tr>
<th>0005119367</th>
<td>-1.090690e-28</td>
<td>1.731628e-10</td>
<td>-1.086338e-28</td>
<td>1.232361e-10</td>
<td>-0.116705</td>
<td>-0.153975</td>
<td>-2.389029e-04</td>
<td>-5.150603e-02</td>
<td>0.013055</td>
<td>3.204659e-04</td>
<td>...</td>
<td>0.000140</td>
<td>-1.095652e-28</td>
<td>-7.075178e-03</td>
<td>5.015315e-03</td>
<td>2.480933e-04</td>
<td>-4.935525e-12</td>
<td>0.013148</td>
<td>0.010717</td>
<td>-0.000146</td>
<td>0.107412</td>
</tr>
<tr>
<th>0005123968</th>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>...</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>B01HHZKOG0</th>
<td>-3.712402e-08</td>
<td>-4.029023e-03</td>
<td>4.909287e-09</td>
<td>-1.923616e-07</td>
<td>-0.003230</td>
<td>-0.002738</td>
<td>2.696407e-07</td>
<td>3.736180e-07</td>
<td>-0.000176</td>
<td>-2.457352e-09</td>
<td>...</td>
<td>0.000092</td>
<td>4.232260e-04</td>
<td>-2.973162e-07</td>
<td>3.344762e-19</td>
<td>-6.953103e-08</td>
<td>3.354215e-11</td>
<td>-0.000318</td>
<td>0.000018</td>
<td>0.002259</td>
<td>0.000222</td>
</tr>
<tr>
<th>B01HI8KC5E</th>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>...</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
</tr>
<tr>
<th>B01HI87P4K</th>
<td>1.339735e-01</td>
<td>-1.418108e-01</td>
<td>8.517871e-03</td>
<td>-1.393756e-01</td>
<td>-0.141205</td>
<td>-0.142142</td>
<td>1.445967e-01</td>
<td>-1.346857e-01</td>
<td>-0.141986</td>
<td>-1.300971e-01</td>
<td>...</td>
<td>0.141561</td>
<td>-1.383641e-01</td>
<td>-1.366770e-01</td>
<td>1.268713e-01</td>
<td>-1.408127e-01</td>
<td>1.414165e-01</td>
<td>-0.137534</td>
<td>0.140210</td>
<td>0.141345</td>
<td>0.103656</td>
</tr>
<tr>
<th>B01HJ6R77G</th>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>...</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
</tr>
<tr>
<th>B01HJF79XO</th>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>inf</td>
<td>...</td>
<td>inf</td>
<td>inf</td>
<td>inf</td>
<td>-inf</td>
<td>inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
<td>-inf</td>
</tr>
</tbody>
</table>
<p>103731 rows × 50 columns</p>
</div>
<button class="colab-df-convert" onclick="convertToInteractive('df-35df8a94-e255-46f6-9457-2403d7342e92')" style="display:none;" title="Convert this dataframe to an interactive table.">
<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
</svg>
</button>
<style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>
<script>
        const buttonEl =
          document.querySelector('#df-35df8a94-e255-46f6-9457-2403d7342e92 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-35df8a94-e255-46f6-9457-2403d7342e92');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can create a <code>temp</code> dataframe that contains the unique IDs of the items and use an inner <code>pandas.Merge</code> to get the items, then create a copy of the <code>itemID</code> column as <code>Item</code> and remove <code>inf</code> and <code>-inf</code> from the data.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'itemID'</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span></span>
<span class="code-line"><span class="n">df_recommend</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">rest_pd</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">'itemID'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df_recommend</span><span class="p">[</span><span class="s1">'Item'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_recommend</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">'itemID'</span><span class="p">]</span></span>
<span class="code-line"><span class="n">df_recommend</span> <span class="o">=</span> <span class="n">df_recommend</span><span class="p">[</span><span class="o">~</span><span class="n">df_recommend</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span></span>
<span class="code-line">                                                <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span></span>
<span class="code-line"><span class="n">df_recommend</span><span class="o">.</span><span class="n">shape</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">(47155, 52)</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">There is a reduced number compared to <code>batch_size=16</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a id="recommendation"></a></p>
<h3 id="Recommendation"><code>Recommendation</code><a class="anchor-link" href="#Recommendation">¶</a></h3><p>   <font size="4">Let's now call the function with the most frequent item, <code>B009934S5M</code>, as the input. We can then apply a <code>lambda</code> function with the <code>convert</code> function to create a new column called <code>cos</code> in the result dataframe, drop the original <code>cosine</code> column (which had values with np.array), and sort with the highest values first. These items with the highest <code>cos</code> are the most similar to the input item.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">find_similarity_total</span><span class="p">(</span><span class="s1">'B009934S5M'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="p">[</span><span class="s1">'cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">convert</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">'cosine'</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">'cosine'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'cos'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div id="df-38bc70ab-662a-42ad-a4a4-b6ccd123ee20">
<div class="colab-df-container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe table-striped table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>similar_item</th>
<th>cos</th>
</tr>
</thead>
<tbody>
<tr>
<th>18010</th>
<td>B009934S5M</td>
<td>1.000000</td>
</tr>
<tr>
<th>5555</th>
<td>B00005U8QD</td>
<td>0.872185</td>
</tr>
<tr>
<th>11124</th>
<td>B000P5FH5I</td>
<td>0.828417</td>
</tr>
<tr>
<th>13565</th>
<td>B001JAHSIM</td>
<td>0.816748</td>
</tr>
<tr>
<th>33908</th>
<td>B000WYVUZS</td>
<td>0.805130</td>
</tr>
<tr>
<th>37096</th>
<td>B001TXVSPS</td>
<td>0.789085</td>
</tr>
<tr>
<th>17658</th>
<td>B007OCD1CG</td>
<td>0.788496</td>
</tr>
<tr>
<th>32716</th>
<td>B000OZ2CTS</td>
<td>0.782737</td>
</tr>
<tr>
<th>44674</th>
<td>B00JWS9IS6</td>
<td>0.780625</td>
</tr>
<tr>
<th>11750</th>
<td>B000W8KY0G</td>
<td>0.767757</td>
</tr>
</tbody>
</table>
</div>
<button class="colab-df-convert" onclick="convertToInteractive('df-38bc70ab-662a-42ad-a4a4-b6ccd123ee20')" style="display:none;" title="Convert this dataframe to an interactive table.">
<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0V0z" fill="none"></path>
<path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"></path><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"></path>
</svg>
</button>
<style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>
<script>
        const buttonEl =
          document.querySelector('#df-38bc70ab-662a-42ad-a4a4-b6ccd123ee20 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-38bc70ab-662a-42ad-a4a4-b6ccd123ee20');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">The model recommends items that should be suggested to be purchased with the most rated item, which was <code>Star Trek Into Darkness (Blu-ray)</code> (<code>B009934S5M</code>).</font></p>
<ul>
<li><code>B009934S5M</code> - Star Trek Into Darkness (Blu-ray)</li>
<li><code>B00005U8QD</code> - Witchouse 3: Demon Fire (Widescreen Special Edition)</li>
<li><code>B000P5FH5I</code> - Dora The Explorer - Summer Explorer</li>
<li><code>B001JAHSIM</code> - Not found</li>
<li><code>B000WYVUZS</code> - Not found</li>
<li><code>B001TXVSPS</code> - Not found</li>
<li><code>B007OCD1CG</code> - Simply Red: Live at Montreux 2003 [Blu-ray]  music</li>
<li><code>B000OZ2CTS</code> - Vandread and Vandread the Second Stage: Complete Collection  anime</li>
<li><code>B00JWS9IS6</code> - President Wolfman [Edizione: Stati Uniti] [Edizione: USA]</li>
<li><code>B000W8KY0G</code> - Not found</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Collaborative-Filtering-Model-using-Tensorflow"><code>Collaborative Filtering Model using Tensorflow</code><a class="anchor-link" href="#Collaborative-Filtering-Model-using-Tensorflow">¶</a></h1><p>   <font size="4">We can utilize the previous approach to set up the environment including setting the seed with a <code>init_seeds</code> function for reproducibility.</font></p>
<p>   <font size="4">Let's now prepare the data by using a <code>lambda</code> function, and examine the number of reviewers, items and ratings.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">'item_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">'reviewer_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Number of reviewers: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">reviewer_id</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Number of items: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Number of ratings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Number of reviewers: 19639</span>
<span class="code-line">Number of items: 103687</span>
<span class="code-line">Number of ratings: 1113396</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">To prepare the data for modeling, let's create the training and evaluation sets with 80% allocated to the training set and 20% for evaluation that are saved as <code>.csv</code> files as well.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">random_selection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mf">0.80</span></span>
<span class="code-line"><span class="n">train_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">random_selection</span><span class="p">]</span></span>
<span class="code-line"><span class="n">eval_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">random_selection</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">train_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">'train_filtered.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">'|'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">eval_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">'eval_filtered.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">'|'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Train data split: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Eval data split: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">eval_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Train and eval data files are saved.'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Train data split: 890562</span>
<span class="code-line">Eval data split: 222834</span>
<span class="code-line">Train and eval data files are saved.</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Then, we can define the dataset metadata including where the data is stored, the columns as <code>csv_header</code>, the name of the target variable and the vocabularies for the unique reviewers and items.</font></p>
<p>   <font size="4">The model hyperparameters can be specified, so let's utilize <code>learning_rate = 0.0001</code>, <code>batch_size = 1024</code>, <code>num_epochs = 30</code> and a <code>base_embedding_dim = 64</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">DATADIR</span> <span class="o">=</span> <span class="s1">'/content/drive/MyDrive/AmazonReviews/Data/'</span></span>
<span class="code-line"><span class="n">csv_header</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span></span>
<span class="code-line"><span class="n">target_feature_name</span> <span class="o">=</span> <span class="s1">'rating'</span></span>
<span class="code-line"><span class="n">reviewer_vocabulary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">reviewer_id</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span></span>
<span class="code-line"><span class="n">item_vocabulary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.0001</span></span>
<span class="code-line"><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1024</span></span>
<span class="code-line"><span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">30</span></span>
<span class="code-line"><span class="n">base_embedding_dim</span> <span class="o">=</span> <span class="mi">64</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's use a function <code>get_dataset_from_csv</code> that load the data into a <code>tf.data.experimental.make_csv_dataset</code> with each element of the dataset as a tuple that is a batch of rows. The features dictionary maps the feature column names to <code>Tensors</code> containing the corresponding feature data, and labels is a <code>Tensor</code> containing the batch's label data.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">from</span> <span class="nn">tensorflow.python.lib.io</span> <span class="kn">import</span> <span class="n">file_io</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">get_dataset_from_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">csv_file_path</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">gfile</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">make_csv_dataset</span><span class="p">(</span></span>
<span class="code-line">        <span class="n">csv_file_path</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">column_names</span><span class="o">=</span><span class="n">csv_header</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">label_name</span><span class="o">=</span><span class="n">target_feature_name</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">field_delim</span><span class="o">=</span><span class="s1">'|'</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's use another function <code>run_experiment</code> now that call the <code>get_dataset_from_csv</code> function to read the training &amp; test data from the <code>DATADIR</code> and then to <code>compile</code> and fit the model with the specified <code>callbacks</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">model</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">get_dataset_from_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATADIR</span><span class="p">,</span></span>
<span class="code-line">                                                      <span class="s1">'train_filtered.csv'</span><span class="p">),</span></span>
<span class="code-line">                                         <span class="n">batch_size</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">get_dataset_from_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATADIR</span><span class="p">,</span></span>
<span class="code-line">                                                     <span class="s1">'eval_filtered.csv'</span><span class="p">),</span></span>
<span class="code-line">                                        <span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span></span>
<span class="code-line">                  <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'mae'</span><span class="p">)])</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">num_epochs</span><span class="p">,</span></span>
<span class="code-line">                        <span class="n">validation_data</span><span class="o">=</span><span class="n">eval_dataset</span><span class="p">,</span></span>
<span class="code-line">                        <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks_list</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">history</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Baseline-Collaborative-Filtering-Model"><code>Baseline Collaborative Filtering Model</code><a class="anchor-link" href="#Baseline-Collaborative-Filtering-Model">¶</a></h2><h3 id="Implement-Embedding-Encoder"><code>Implement Embedding Encoder</code><a class="anchor-link" href="#Implement-Embedding-Encoder">¶</a></h3><p>   <font size="4">The <code>embedding_encoder</code> function with input containing the vocabulary, the dimensions of the embeddings, and the indice number can be used to return the embeddings for the reviewers and items.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Del---explanations">Del - explanations<a class="anchor-link" href="#Del---explanations">¶</a></h2><p>two techniques for building memory-efficient recommendation models by reducing the size of the embedding tables, without sacrificing model effectiveness:</p>
<pre><span class="code-line"><code>Quotient-remainder trick, by Hao-Jun Michael Shi et al., which reduces the number of embedding vectors to store, yet produces unique embedding vector for each item without explicit definition.</code></span><code>
<span class="code-line">Mixed Dimension embeddings, by Antonio Ginart et al., which stores embedding vectors with mixed dimensions, where less popular items have reduced dimension embeddings.</span></code></pre>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">layers</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">embedding_encoder</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">num_oov_indices</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span></span>
<span class="code-line">        <span class="p">[</span><span class="n">layers</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span><span class="n">vocabulary</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span></span>
<span class="code-line">                             <span class="n">num_oov_indices</span><span class="o">=</span><span class="n">num_oov_indices</span><span class="p">),</span></span>
<span class="code-line">         <span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_oov_indices</span><span class="p">,</span></span>
<span class="code-line">                          <span class="n">output_dim</span><span class="o">=</span><span class="n">embedding_dim</span><span class="p">),],</span></span>
<span class="code-line">                          <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_embedding'</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Implement-the-Baseline-Model"><code>Implement the Baseline Model</code><a class="anchor-link" href="#Implement-the-Baseline-Model">¶</a></h3><p>   <font size="4">We can define another function <code>create_baseline_model</code> that uses the reviewers as an input to the <code>embedding_encoder</code> function for the reviewer embeddings, the item as an input to the <code>embedding_encoder</code> for the item embeddings. Then the dot product similarity between reviewer and item embeddings can be generated and converted to a rating scale. Lastly, the model can be created.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">create_baseline_model</span><span class="p">():</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">reviewer_input</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">reviewer_embedding</span> <span class="o">=</span> <span class="n">embedding_encoder</span><span class="p">(</span><span class="n">vocabulary</span><span class="o">=</span><span class="n">reviewer_vocabulary</span><span class="p">,</span></span>
<span class="code-line">                                           <span class="n">embedding_dim</span><span class="o">=</span><span class="n">base_embedding_dim</span><span class="p">,</span></span>
<span class="code-line">                                           <span class="n">name</span><span class="o">=</span><span class="s1">'reviewer'</span><span class="p">)(</span><span class="n">reviewer_input</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">item_input</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'item_id'</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">item_embedding</span> <span class="o">=</span> <span class="n">embedding_encoder</span><span class="p">(</span><span class="n">vocabulary</span><span class="o">=</span><span class="n">item_vocabulary</span><span class="p">,</span></span>
<span class="code-line">                                       <span class="n">embedding_dim</span><span class="o">=</span><span class="n">base_embedding_dim</span><span class="p">,</span></span>
<span class="code-line">                                       <span class="n">name</span><span class="o">=</span><span class="s1">'item'</span><span class="p">)(</span><span class="n">item_input</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">logits</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'dot_similarity'</span><span class="p">)([</span><span class="n">reviewer_embedding</span><span class="p">,</span></span>
<span class="code-line">                                                        <span class="n">item_embedding</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">prediction</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">activations</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">logits</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">reviewer_input</span><span class="p">,</span> <span class="n">item_input</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="n">prediction</span><span class="p">,</span></span>
<span class="code-line">                        <span class="n">name</span><span class="o">=</span><span class="s1">'baseline_model'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">return</span> <span class="n">model</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's create the baseline model and examine the model summary.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">baseline_model</span> <span class="o">=</span> <span class="n">create_baseline_model</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">baseline_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Model: "baseline_model"</span>
<span class="code-line">__________________________________________________________________________________________________</span>
<span class="code-line"> Layer (type)                   Output Shape         Param #     Connected to                     </span>
<span class="code-line">==================================================================================================</span>
<span class="code-line"> reviewer_id (InputLayer)       [(None,)]            0           []                               </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> item_id (InputLayer)           [(None,)]            0           []                               </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> reviewer_embedding (Sequential  (None, 64)          1256896     ['reviewer_id[0][0]']            </span>
<span class="code-line"> )                                                                                                </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> item_embedding (Sequential)    (None, 64)           6635968     ['item_id[0][0]']                </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> dot_similarity (Dot)           (None, 1)            0           ['reviewer_embedding[0][0]',     </span>
<span class="code-line">                                                                  'item_embedding[0][0]']         </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> tf.math.sigmoid_2 (TFOpLambda)  (None, 1)           0           ['dot_similarity[0][0]']         </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> tf.math.multiply_2 (TFOpLambda  (None, 1)           0           ['tf.math.sigmoid_2[0][0]']      </span>
<span class="code-line"> )                                                                                                </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line">==================================================================================================</span>
<span class="code-line">Total params: 7,892,864</span>
<span class="code-line">Trainable params: 7,892,864</span>
<span class="code-line">Non-trainable params: 0</span>
<span class="code-line">__________________________________________________________________________________________________</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Notice that the number of trainable parameters is<code>7,892,864</code>. Let's now set the path where model is saved and set up the logs/callbacks containing the <code>EarlyStopping</code> class that monitors the <code>val_loss</code> and will stop training if it does not improve after 3 <code>epochs</code>, the <code>ModelCheckpoint</code> class that monitors the <code>val_loss</code> saving only the best one with a <code>min</code> loss as well as the <code>TensorBoard</code> class that enables visualizations using the <code>TensorBoard</code>.</font></p>
<p>   <font size="4">Now the <code>baseline_model</code> can be trained by calling <code>fit</code> utilizing the train dataset for 30 <code>epochs</code>, which is the iterations over the entire<code>X_train</code> and<code>y_train</code>, using a <code>batch_size=1024</code>, which is the number of samples per gradient update, and the specified callbacks from the <code>callbacks_list</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">datetime</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span><span class="p">,</span> <span class="n">ModelCheckpoint</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="o">!</span>rm<span class="w"> </span>-rf<span class="w"> </span>/logs/</span>
<span class="code-line"></span>
<span class="code-line"><span class="o">%</span><span class="k">load_ext</span> tensorboard</span>
<span class="code-line"></span>
<span class="code-line"><span class="n">log_folder</span> <span class="o">=</span> <span class="s1">'logs/fit/'</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y%m</span><span class="si">%d</span><span class="s1">-%H%M%S'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">filepath</span> <span class="o">=</span> <span class="s1">'baselineEmbed64_MoviesTV_weights_only_b1024.h5'</span></span>
<span class="code-line"><span class="n">checkpoint_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">tensorboard_callback</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">TensorBoard</span><span class="p">(</span><span class="n">log_folder</span><span class="p">,</span></span>
<span class="code-line">                                                      <span class="n">histogram_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">callbacks_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">'val_loss'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">'val_loss'</span><span class="p">,</span></span>
<span class="code-line">                                  <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'min'</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">tensorboard_callback</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">history</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">baseline_model</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Epoch 1/30</span>
<span class="code-line">870/870 [==============================] - 141s 157ms/step - loss: 4.0122 - mae: 1.8476 - val_loss: 4.0184 - val_mae: 1.8491</span>
<span class="code-line">Epoch 2/30</span>
<span class="code-line">870/870 [==============================] - 131s 151ms/step - loss: 4.0040 - mae: 1.8456 - val_loss: 4.0182 - val_mae: 1.8491</span>
<span class="code-line">Epoch 3/30</span>
<span class="code-line">870/870 [==============================] - 132s 152ms/step - loss: 3.9942 - mae: 1.8432 - val_loss: 4.0175 - val_mae: 1.8489</span>
<span class="code-line">Epoch 4/30</span>
<span class="code-line">870/870 [==============================] - 136s 156ms/step - loss: 3.9822 - mae: 1.8403 - val_loss: 4.0155 - val_mae: 1.8484</span>
<span class="code-line">Epoch 5/30</span>
<span class="code-line">870/870 [==============================] - 136s 156ms/step - loss: 3.9661 - mae: 1.8363 - val_loss: 4.0103 - val_mae: 1.8471</span>
<span class="code-line">Epoch 6/30</span>
<span class="code-line">870/870 [==============================] - 140s 161ms/step - loss: 3.9430 - mae: 1.8306 - val_loss: 3.9983 - val_mae: 1.8441</span>
<span class="code-line">Epoch 7/30</span>
<span class="code-line">870/870 [==============================] - 138s 158ms/step - loss: 3.9082 - mae: 1.8219 - val_loss: 3.9740 - val_mae: 1.8380</span>
<span class="code-line">Epoch 8/30</span>
<span class="code-line">870/870 [==============================] - 139s 159ms/step - loss: 3.8559 - mae: 1.8086 - val_loss: 3.9313 - val_mae: 1.8272</span>
<span class="code-line">Epoch 9/30</span>
<span class="code-line">870/870 [==============================] - 132s 152ms/step - loss: 3.7799 - mae: 1.7890 - val_loss: 3.8641 - val_mae: 1.8098</span>
<span class="code-line">Epoch 10/30</span>
<span class="code-line">870/870 [==============================] - 129s 149ms/step - loss: 3.6758 - mae: 1.7616 - val_loss: 3.7689 - val_mae: 1.7846</span>
<span class="code-line">Epoch 11/30</span>
<span class="code-line">870/870 [==============================] - 132s 152ms/step - loss: 3.5419 - mae: 1.7253 - val_loss: 3.6454 - val_mae: 1.7510</span>
<span class="code-line">Epoch 12/30</span>
<span class="code-line">870/870 [==============================] - 133s 153ms/step - loss: 3.3799 - mae: 1.6802 - val_loss: 3.4966 - val_mae: 1.7097</span>
<span class="code-line">Epoch 13/30</span>
<span class="code-line">870/870 [==============================] - 130s 150ms/step - loss: 3.1947 - mae: 1.6274 - val_loss: 3.3280 - val_mae: 1.6619</span>
<span class="code-line">Epoch 14/30</span>
<span class="code-line">870/870 [==============================] - 131s 150ms/step - loss: 2.9932 - mae: 1.5685 - val_loss: 3.1466 - val_mae: 1.6090</span>
<span class="code-line">Epoch 15/30</span>
<span class="code-line">870/870 [==============================] - 131s 151ms/step - loss: 2.7831 - mae: 1.5052 - val_loss: 2.9596 - val_mae: 1.5530</span>
<span class="code-line">Epoch 16/30</span>
<span class="code-line">870/870 [==============================] - 135s 155ms/step - loss: 2.5716 - mae: 1.4395 - val_loss: 2.7733 - val_mae: 1.4955</span>
<span class="code-line">Epoch 17/30</span>
<span class="code-line">870/870 [==============================] - 134s 154ms/step - loss: 2.3649 - mae: 1.3728 - val_loss: 2.5929 - val_mae: 1.4379</span>
<span class="code-line">Epoch 18/30</span>
<span class="code-line">870/870 [==============================] - 129s 148ms/step - loss: 2.1678 - mae: 1.3067 - val_loss: 2.4224 - val_mae: 1.3814</span>
<span class="code-line">Epoch 19/30</span>
<span class="code-line">870/870 [==============================] - 128s 148ms/step - loss: 1.9836 - mae: 1.2423 - val_loss: 2.2644 - val_mae: 1.3268</span>
<span class="code-line">Epoch 20/30</span>
<span class="code-line">870/870 [==============================] - 130s 150ms/step - loss: 1.8145 - mae: 1.1803 - val_loss: 2.1205 - val_mae: 1.2749</span>
<span class="code-line">Epoch 21/30</span>
<span class="code-line">870/870 [==============================] - 130s 149ms/step - loss: 1.6615 - mae: 1.1216 - val_loss: 1.9912 - val_mae: 1.2262</span>
<span class="code-line">Epoch 22/30</span>
<span class="code-line">870/870 [==============================] - 123s 141ms/step - loss: 1.5244 - mae: 1.0665 - val_loss: 1.8765 - val_mae: 1.1811</span>
<span class="code-line">Epoch 23/30</span>
<span class="code-line">870/870 [==============================] - 129s 148ms/step - loss: 1.4030 - mae: 1.0155 - val_loss: 1.7755 - val_mae: 1.1396</span>
<span class="code-line">Epoch 24/30</span>
<span class="code-line">870/870 [==============================] - 130s 149ms/step - loss: 1.2959 - mae: 0.9686 - val_loss: 1.6874 - val_mae: 1.1020</span>
<span class="code-line">Epoch 25/30</span>
<span class="code-line">870/870 [==============================] - 128s 147ms/step - loss: 1.2019 - mae: 0.9255 - val_loss: 1.6109 - val_mae: 1.0680</span>
<span class="code-line">Epoch 26/30</span>
<span class="code-line">870/870 [==============================] - 129s 149ms/step - loss: 1.1196 - mae: 0.8863 - val_loss: 1.5447 - val_mae: 1.0374</span>
<span class="code-line">Epoch 27/30</span>
<span class="code-line">870/870 [==============================] - 128s 147ms/step - loss: 1.0475 - mae: 0.8506 - val_loss: 1.4875 - val_mae: 1.0101</span>
<span class="code-line">Epoch 28/30</span>
<span class="code-line">870/870 [==============================] - 125s 144ms/step - loss: 0.9843 - mae: 0.8181 - val_loss: 1.4383 - val_mae: 0.9857</span>
<span class="code-line">Epoch 29/30</span>
<span class="code-line">870/870 [==============================] - 129s 149ms/step - loss: 0.9287 - mae: 0.7886 - val_loss: 1.3958 - val_mae: 0.9639</span>
<span class="code-line">Epoch 30/30</span>
<span class="code-line">870/870 [==============================] - 129s 148ms/step - loss: 0.8797 - mae: 0.7617 - val_loss: 1.3592 - val_mae: 0.9446</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can save the model and plot the model <code>loss</code> and <code>val_loss</code> over the <code>epochs</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">baseline_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'./baselineEmbed64_MoviesTV_batchb1024_tf.h5'</span><span class="p">,</span></span>
<span class="code-line">                    <span class="n">save_format</span><span class="o">=</span><span class="s1">'tf'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'loss'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'val_loss'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Model Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epoch'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">'Train'</span><span class="p">,</span> <span class="s1">'Eval'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYMAAAEWCAYAAACEz/viAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjIsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+WH4yJAAAgAElEQVR4nO3dd3xUVfrH8c+TSSWkQgKBAKEjhNACoqAiKoIgIB2pNhQVZd217v7Wsuqqq+7aQYpSBKQqomCjg5TQq0gJEKSEACEhPZzfH3fQEBJSyGQyyfN+veaVmXvv3Hmug/nm3nPPOWKMQSmlVMXm5uwClFJKOZ+GgVJKKQ0DpZRSGgZKKaXQMFBKKYWGgVJKKTQMlCqQiESIiBER90JsO1JEVpdGXUqVJA0DVa6ISKyIZIhI1VzLt9h/oUc4p7KihYpSpU3DQJVHh4DBl16ISHOgkvPKUars0zBQ5dE0YHiO1yOAqTk3EJEAEZkqIvEiclhE/iEibvZ1NhF5W0ROi8hBoHse750kIsdF5JiIvCoitmspWERqiMhCETkjIvtF5KEc69qJSIyInBeRkyLyrn25t4hMF5EEETknIhtFpNq11KEqLg0DVR6tA/xF5Dr7L+lBwPRc23wABAD1gFuwwuM++7qHgB5AKyAa6JfrvZ8DWUAD+zZdgAevseZZQBxQw/55r4tIZ/u694D3jDH+QH1gtn35CPsx1AKqAI8AqddYh6qgNAxUeXXp7OAOYA9w7NKKHAHxvDEmyRgTC7wDDLNvMgD4nzHmqDHmDPDvHO+tBtwFjDXGXDDGnAL+a99fsYhILaAD8KwxJs0YsxWYyJ9nN5lAAxGpaoxJNsasy7G8CtDAGJNtjNlkjDlf3DpUxaZhoMqracC9wEhyXSICqgIewOEcyw4DNe3PawBHc627pI79vcftl2bOAeOB0GuotQZwxhiTlE89DwCNgL32S0E97MunAd8Ds0TkdxF5S0Q8rqEOVYFpGKhyyRhzGKsh+S5gfq7Vp7H+qq6TY1lt/jx7OI516SXnukuOAulAVWNMoP3hb4xpdg3l/g4Ei4hfXvUYY34zxgzGCpw3gbki4muMyTTGvGyMaQrciHVpazhKFYOGgSrPHgA6G2Mu5FxojMnGuu7+moj4iUgd4Cn+bFeYDTwhIuEiEgQ8l+O9x4EfgHdExF9E3ESkvojcUoS6vOyNv94i4o31S38t8G/7sih77dMBRGSoiIQYYy4C5+z7uCgit4pIc/tlr/NYAXexCHUo9QcNA1VuGWMOGGNi8lk9BrgAHARWAzOAyfZ1E7Auv2wDNnPlmcVwwBPYDZwF5gJhRSgtGauh99KjM9atsBFYZwkLgBeNMT/Zt+8K7BKRZKzG5EHGmFSguv2zz2O1i6zAunSkVJGJTm6jlFJKzwyUUkppGCillNIwUEophYaBUkopwOVGT6xataqJiIhwdhlKKeVSNm3adNoYE5LfepcLg4iICGJi8rtbUCmlVF5E5PDV1utlIqWUUhoGSimlNAyUUkrhgm0GSilVVJmZmcTFxZGWlubsUhzO29ub8PBwPDyKNoCthoFSqtyLi4vDz8+PiIgIRMTZ5TiMMYaEhATi4uKoW7dukd6rl4mUUuVeWloaVapUKddBACAiVKlSpVhnQA4PA/t8sltEZFEe67xE5Ev7nK/rRSTC0fUopSqm8h4ElxT3OEvjMtGTWMPr+uex7gHgrDGmgYgMwpq4Y6AjikiJ20HW9nl42tzwcHfDJgJX/EfL8VrEev3HT3K9vvTTzXq42UBs4OYGbu7257YcP93A5gnu3uDu9edPD5/LX7t7W9tVkH+4SqmywaFhICLhQHfgNazJQ3LrBbxkfz4X+FBExDhgXO29O2Jouf5/OYorw0N3ixt4B4JPEFQKtn76BOd6bX8EhENQhBUkSqkyKSEhgdtuuw2AEydOYLPZCAmxOgNv2LABT0/PfN8bExPD1KlTef/99x1ao6PPDP4HPAP45bO+Jva5Zo0xWSKSiDXB9+mcG4nIKGAUQO3atXPvo1BCrh/InKq3cSE9mwvpWSRnZJFy6Xl6FikZ2fafWVxIyyI5PYML6VkYYxAM1nmA9Zwczz3dINDHRpCPjWAfG4HeNoJ83Aj0ciPQx4a/lxsB3jYCvIRAbyHYy+DvnoVkZUBWKmSlQ1aa/WF/npkKqWch5Yz1M/kkxO+FlLOQkXTlwYmbFQrB9aFKffvPBtbzwNpg02lxlXKmKlWqsHXrVgBeeuklKleuzN/+9rc/1mdlZeHunvev4+joaKKjox1eo8PCwD5p9yljzCYR6XQt+zLGfAp8ChAdHV2sP+lrBVdiYHDRgsQYw4WMbJLSMklKyyIpLZPzaVl/PE9Ky+J8aibnUjNJTMnkbEoGe5MzOXcqg3OpmaRk5N2I42ETqlb2ItQviBA/b0L9vQip7EWovxehVbyp5u9F7eBKBFbK46+F7EwrIFLPQkoCJMZBwn5IOABnDsD2OZCe+Of2YoOgOlC1EdS5EereDNWjrEtXSimnGTlyJN7e3mzZsoUOHTowaNAgnnzySdLS0vDx8eGzzz6jcePGLF++nLfffptFixbx0ksvceTIEQ4ePMiRI0cYO3YsTzzxRInU48gzgw5ATxG5C/AG/EVkujFmaI5tjmFNPB4nIu5AAJDgwJqKRESo7OVOZS93wgKK/v60zGzOp2Zy1h4UCckZnEpK41RSOvFJ6ZxKSifubApbjpwl4ULGFe8P8PGgTpVK1KniS53gSn88j6jiT0jVkLwbioyBC6etYLgUEAkH4OQu2LfE2sY7AOp0tIKh7s0Qep22UagK4+VvdrH79/Mlus+mNfx58e5mRX5fXFwca9euxWazcf78eVatWoW7uzs//fQTL7zwAvPmzbviPXv37mXZsmUkJSXRuHFjRo8eXeQ+BXlxWBgYY54Hngewnxn8LVcQACwERgC/AP2ApY5oL3AWbw8b3h42Qv29C9w2M/viH2FxIjGNI2dSOJyQQmzCBbbHneO7HcfJvvjnfxofDxt1qlSiUTU/osIDaFkrkGY1AvDxtEHlEOtRu/3lH3L+OMSuhkMr4NBK+PVba7lvCERcCodbILiehoNSpaB///7YbNZZemJiIiNGjOC3335DRMjMzMzzPd27d8fLywsvLy9CQ0M5efIk4eHh11xLqXc6E5FXgBhjzEJgEjBNRPYDZ4BBpV1PWeFhc6N6gDfVA7yJyuN7zcy+yO/nUolNSOFIwgViE1I4nHCBmNgzLNz2OwA2N6FhaGVa1gokKjyQFrUCaFTNDw+b/Q5i/zCI6m89AM4ehthVVjAcWgm7FljLQ5pAm/ugxUCrkVqpcqQ4f8E7iq+v7x/P/+///o9bb72VBQsWEBsbS6dOnfJ8j5fXnzeL2Gw2srKySqSWUgkDY8xyYLn9+T9zLE8D+pdGDa7Ow+ZmXS6q4gtcPiT5qaQ0th9NZFvcObbFJbJ45wlmbTwKgJe7G5E1A2hVK5DO14XSLiIY90vhEFTHerQaal1eSjgAB5fBtpmw5Fn46SWI7GMFQ3i0ni0o5UCJiYnUrFkTgM8//7zUP1+HoygHQv28ub2pN7c3rQZYDd9HzqSw9eg5tsclsj3uHFPXHWbi6kMEVvKgc5NQ7mxWnZsbhliXlcD6RV+1gfVo9xAc3wYxn8GOObD1C6gWCW1GQtQAq81BKVWinnnmGUaMGMGrr75K9+7dS/3zxdUu0UdHRxud3KboUjKyWLnvND/sOsHPe0+RmJqJt4cbNzUM4c5m1bmtSShBvnncvZSeBDvmwqbPrIDwqASRfSH6fqjZuvQPRKli2LNnD9ddd52zyyg1eR2viGwyxuR7j6qeGVQQlTzd6RpZna6R1cnMvsjGQ2f4ftcJfth9kh93n8TmJrSNCKJL0+r0aBFGqJ+90dvLD6Lvsx7HNkPMZNg5D7ZMgxqt4LYXof6tzj04pdQ10zODCs4Yw85j5+3BcIJ9J5PxtLnRu1UNRt1cjwahefQXTEuE7bNh7Qdw7jA06gZdXrUuMSlVBumZQcFnBhoG6jL7TyUzZW0sczYdJS3zIrc1CeWhm+txfd3gK/s1ZKbB+nGw8m2rN3W7h+GWZ8An0DnFK5UPDYOCw0CHsFaXaRBamX/1jmTtc7cx9vaGbDl6jkGfrqP3R2tYtP13srIv/rmxhzd0HAtPbIaW98K6j+H9VrBxImSXzO1uSqnSoWGg8hTs68nY2xux5tnOvNo7ksTUTB6fsYVb31nOlLWxpGTk+GVfORR6fgAPr4TQpvDtX2FcRziw1HkHoJQqEg0DdVU+njaGtq/Dz3/txLihrala2YsXF+7ixjeW8u6P+7iQniMUwqJg5CIYON26bDTtHpgxCE7vd94BKKUKRcNAFYrNTegaGcaCRzsw95EbaBsRzPs//8Yd767gp90n/9xQBK67Gx7bALe/bA1/8fH1sPRVvXSkKjSbzUbLli3/eLzxxhvF2k+nTp1wRLup3lqqiiw6IpjoiGBiYs/wwoIdPDg1hq7NqvNSz2ZUD7DfkuruZbUntLwXfvwnrPyPFQx9J1rDbStVwfj4+PwxjHVZpGcGqtiiI4JZNOYmnr6zMct+PcXt767g8zWHLhtQj8qhcM846DMRTuyw2hJ+Xey8opUqQ5YsWUL//n+OyLN8+XJ69OgBwOjRo4mOjqZZs2a8+OKLDq9FzwzUNfF0d+OxWxvQIyqMf3y1k5e+2c38Lcd4/Z7mRNbMMWxFVH+rx/KckTBzELR/DG5/Cdzzn+FJKYdY/Jz1h0lJqt4cul39sk9qaiotW7b84/Xzzz9P3759GTVqFBcuXMDX15cvv/ySQYOs8Tpfe+01goODyc7O5rbbbmP79u1ERUWVbN056JmBKhF1qvgy9f52vD+4Fb+fS6Pnh6t5ddHuyxuYq9SHB3+y+iOs+wgmd4Ezh5xXtFKl6NJlokuPgQMH4u7uTteuXfnmm2/Iysri22+/pVevXgDMnj2b1q1b06pVK3bt2sXu3bsdWp+eGagSIyL0bFGDWxqG8Ob3e5m4+hDf7TjOK70i/xhED3cvuOsta/6EhY/D+Juh5/vQ7B7nFq8qjgL+gi9tgwYN4sMPPyQ4OJjo6Gj8/Pw4dOgQb7/9Nhs3biQoKIiRI0eSlpb3zIklRc8MVIkLqOTB6/c0Z97oG/Dz9uDBqTE89eVW0jKz/9yoaU94eJU1HeeckbDoL9bcz0pVMLfccgubN29mwoQJf1wiOn/+PL6+vgQEBHDy5EkWL3Z8O5uGgXKYNnWCWfRER8be3pAFW4/Rb9xajp3L8Qs/qA7cvwQ6PGkNgDfxdojf57yClXKgS20Glx7PPfccYN1y2qNHDxYvXvxH43GLFi1o1aoVTZo04d5776VDhw4Or0/HJlKlYunekzw5ayseNjc+urc1N9SvcvkGv/0ICx62xjsaMAUa3uGcQlW5pGMT6dhEqozo3KQaXz/WgWBfT4ZOWs/naw5x2R8iDe+AR1ZbjcwzBsKWL5xXrFIVkIaBKjX1Qiqz4NEb6dwklJe+2c3f5my/vB3Bvwbc9x3UvRm+ftTqqOZiZ65KuSoNA1Wq/Lw9GD+0DWNvb8i8zXEMHP8LxxNztCN4+cG9syFqoDWExbd/hYvZ+e9QqUJytUvixVXc49QwUKXOzU0Ye3sjPh3WhgPxF7j7g9VsjD3z5wbunnDPeOgwFmImwezheqeRuibe3t4kJCSU+0AwxpCQkIC3t3eR36sNyMqp9p9K4qGpmzh6JoUXezZj6PW1L59EZ/14WPws1GoHg2dBpWDnFatcVmZmJnFxcQ6/V78s8Pb2Jjw8HA8Pj8uW60xnqsxLTM1k7KwtLPs1nkFta/Gv3pF42HKctO76CuY/BEERMHQeBNZ2Wq1KuSqn3U0kIt4iskFEtonILhF5OY9tRopIvIhstT8edFQ9quwK8PFg4oi2PHZrfWZtPMrjMzaTkZVjRrVmvWHYAkg6CZO6wImdzitWqXLKkW0G6UBnY0wLoCXQVUTa57Hdl8aYlvbHRAfWo8owm5vw9J1NePHupny/6ySPTN90+Z1GER2tDmoIfNYNDq10Wq1KlUcOCwNjSba/9LA/XOualCp193Woy2v3RLJ07ykemhpDakaOQKjWFB78EfxrwvS+1uUjpVSJcOjdRCJiE5GtwCngR2PM+jw26ysi20VkrojUymc/o0QkRkRi4uPjHVmyKgOGXF+Ht/pFsXr/ae7/fOPlI58GhMP9i6FGa5h7vwaCUiXEoWFgjMk2xrQEwoF2IhKZa5NvgAhjTBTwIzAln/18aoyJNsZEh4SEOLJkVUYMiK7Ffwe0ZP2hBEZM3kBSWuafK32CYOhcCG8L8x6APd84r1ClyolS6WdgjDkHLAO65lqeYIxJt7+cCLQpjXqUa+jdqiYfDG7N1qPnGDZpA4mpOQLBy88KhBr2CXP2fuu0OpUqDxx5N1GIiATan/sAdwB7c20TluNlT2CPo+pRrql7VBgfD2nNrt8TGTJxHWcvZPy50svPutU0rCXMHqHTaSp1DRx5ZhAGLBOR7cBGrDaDRSLyioj0tG/zhP22023AE8BIB9ajXFSXZtX5dHg0+04mM3jCOk4np/+50tsfhs23ph38chjs+955hSrlwrTTmXIZq387zYNTN1IrqBJfPHg9of45utynnoOpveDUbhg0Q4fAVioXHcJalRsdG1bl8/vacexcKgM/XXf5AHc+gVbHtJAmMGsI7P/JeYUq5YI0DJRLaV+vCtMeaMfppHSGTlx/eRtCpWAY/rU1leasIXBgmfMKVcrFaBgol9OmTjATR0Rz9Gwq90/ZeHnHtEuBEFwfZg6CgyucV6hSLkTDQLmk6+tV4f1BLdl29ByPz9hMVnaOsYx8q8CIhRBcz5o17dAq5xWqlIvQMFAuq2tkGK/0iuTnvad4YcGOy8eq960KwxdCUB2YMQCObnBeoUq5AA0D5dKGtq/DE50bMDsmjnd/3Hf5ysohViD4VYcv+sMp7caiVH40DJTL+8sdjRjUthYfLN3PtF9iL1/pV826y8jdG6b1gXNHnFGiUmWehoFyeSLCq70juf26UP65cBeLdxy/fIOgCKtjWuYFmHYPJOtgh0rlpmGgygV3mxsfDG5Nq1qBPDlrK+sOJly+QbVmcO9sSDwGX/SFtPPOKVSpMkrDQJUbPp42Jo9sS+0qlXhoagx7T+T6hV+7PQyYCid3wax7IbP8z4erVGFpGKhyJbCSJ1Pub0clTxsjJm8g7mzK5Rs06gK9P4HYVTD/QbiYnfeOlKpgNAxUuVMz0Icp97cjJSOb4ZM3XN5LGSBqAHR9w5oHYdFYcLHxuZRyBA0DVS41qe7PxOHRxNl7KV82nzJA+9Fw099g81T4+RXnFKlUGaJhoMqtS72Utx49xzNzt3PFCL2d/wFt7oPV78LaD51TpFJlhIaBKte6Robxty6NWbjtdz5efuDylSLQ/R1o2gt++DtsnemcIpUqA9ydXYBSjvZop/rsO5nEf77/lYahlenSrPqfK91s0GcCpCXC149ZQ2E37ua8YpVyEj0zUOWeiPBm3yhahAcw9sut7Dme65ZTdy8YOB3ComDOfXB0o3MKVcqJNAxUheDtYePT4dH4ebvz4JSYy6fOBGs+5XvnWOMYzRgAp/c7p1ClnETDQFUY1fy9mTA8mtPJ6YyevomMrIuXb1A5BIbOA3GD6X0g6aRzClXKCTQMVIUSFR7If/q3YGPsWf7x1Y4r7zCqUh+GzIYL8TCjP6QnOadQpUqZhoGqcHq2qMEY+7DXk9fEXrlBzTbQfwqc2Amzh0N2ZqnXqFRp0zBQFdJfbm/Enc2q8dq3u1mxL49RTBt1gbvfgwNLYeEY7aWsyj2HhYGIeIvIBhHZJiK7ROTlPLbxEpEvRWS/iKwXkQhH1aNUTm5uwrsDWtKomh+Pz9jM/lPJV27Uehjc+nfYNhOW/qv0i1SqFDnyzCAd6GyMaQG0BLqKSPtc2zwAnDXGNAD+C7zpwHqUuoyvlzsTR0TjaXPjwSkbOZeSceVGNz9t9VJe9Q5smFD6RSpVShwWBsZy6c8tD/sj97l2L2CK/flc4DYREUfVpFRu4UGVGD+sDcfOpfLYjM1kZue6w0gE7nobGt8F3z1tDW6nVDnk0DYDEbGJyFbgFPCjMWZ9rk1qAkcBjDFZQCJQJY/9jBKRGBGJiY/XWapUyYqOCOa13s1Zsz+B177NY55kmzv0nQTh0TDvQTiyrvSLVMrBHBoGxphsY0xLIBxoJyKRxdzPp8aYaGNMdEhISMkWqRQwoG0t7u9Ql8/XxjJ/c9yVG3hWgsFfQkA4zBgI8b+WfpFKOVCp3E1kjDkHLAO65lp1DKgFICLuQACQa75CpUrH83c14fq6wTw/fwc7jyVeuYFvFatTms0TpveF88ev3EYpF+XIu4lCRCTQ/twHuAPYm2uzhcAI+/N+wFJzRS8gpUqHh82Nj4a0JtjXk4enbeJM7klxAIIiYOhcSD0LX/SzBrhTqhxw5JlBGLBMRLYDG7HaDBaJyCsi0tO+zSSgiojsB54CnnNgPUoVqGplLz4Z2ob4pHSemLmFrNwNygBhLWDgNIjfC7OGQFb6ldso5WLE1f4Qj46ONjExMc4uQ5VzX248wrPzdvDwLfV4vtt1eW+0fTbMfwia9bEamN20D6cqu0RkkzEmOr/1Op+BUnkY2LY22+ISGb/iIFE1A+keFXblRlEDIOk4/PhP8AuDrq+XfqFKlRANA6Xy8eLdTdl7/DxPz91Gg9DKNK7ud+VGNz5hNSSv+wj8w+DGMaVfqFIlQM9rlcqHl7uNT4a2wdfLnYenxZCYmseAdSJw5+vQ7B744R+wfU7pF6pUCdAwUOoqqvl78/GQ1sSdTeWpL7dy8WIebWxubtB7HNTpCF+NhoPLS71Opa6VhoFSBWgbEcw/727Kz3tP8d7Pv+W9kYc3DPoCqjaCWUPh+PbSLVKpa6RhoFQhDGtfh76tw3nv59/4aXc+M6D5BFp9ELwDrD4IZ2NLtUalroWGgVKFICK8dk8kkTX9+cuXWzkYn8eQ1wD+NaxeylnpMK0PXNAO9co1aBgoVUjeHjbGDW2Dh7sbD0/bRHJ6Vt4bhjaBwbPg/DGYMQAyLpRuoUoVg4aBUkUQHlSJDwe34kB8Ms/M3XblHMqX1LkB+k6E3zfDnJE6daYq8zQMlCqiGxtU5bluTfhuxwkmrDqY/4bX3Q3d34HffoCvHoWLeQxtoVQZoZ3OlCqGh26qx7ajibyxeC+RNQK4sUHVvDeMvh9SzljTZvoEQbc3rb4JSpUxemagVDGICG/2i6J+SGUen7mFY+dS89/4pr/CDY/DhvGw4q3SK1KpItAwUKqYKnu5M25YGzKzLjJ6+ibSMrPz3lAE7vgXtLgXlr8O6z8t3UKVKgQNA6WuQf2QyrwzoAXb4xJ5aeGu/Dd0c4OeH1hzKS9+WoetUGWOhoFS16hLs+o8fmsDZm08yswNR/Lf0OYO/T6zD1vxCOz7ofSKVKoAGgZKlYC/3NGImxuF8OLXu9hy5Gz+G3p4w+CZUK0ZzB4OR9aVXpFKXYWGgVIlwOYmvD+oJdUCvBg9fTPxSVeZ/czbH4bMg4CaVqe0EztLr1Cl8qFhoFQJCazkySdD2nA2JYMxMzfnPWXmJZVDYNgC8PCF6X3gzFX6KyhVCjQMlCpBkTUD+Hef5qw7eIY3l+y9+saBta1AyM6AafdA0onSKVKpPGgYKFXC+rQOZ8QNdZiw6hDfbPv96huHNrEuGSXHWwPbpZwpnSKVykXDQCkH+Hv3prSpE8Qzc7fz64mkq28c3saaCyFhP0zrDannSqdIpXIoVBiIiK+IuNmfNxKRniLi4djSlHJdnu5ufDykNZW93Rk1LYbElAIGqqt/KwycDid3W20IaedLp1Cl7Ap7ZrAS8BaRmsAPwDDgc0cVpVR5UM3fm3FDW/P7uVQen7mZ7LymzMypURcYMAWOb7Mmx0nPZ84EpRygsGEgxpgUoA/wsTGmP9Dsqm8QqSUiy0Rkt4jsEpEn89imk4gkishW++OfRT8EpcquNnWCeaVXJKt+O81b3xfQoAzQpDv0mwxxMToXgipVhQ4DEbkBGAJ8a19mK+A9WcBfjTFNgfbAYyLSNI/tVhljWtofrxSyHqVcxuB2tRnavjbjVxxkYUENygBNe0GfT+HILzBzMGReZRA8pUpIYcNgLPA8sMAYs0tE6gHLrvYGY8xxY8xm+/MkYA9Q81qKVcpV/bNHM9pGBPHM3G3sPJZY8Bua94Pen8ChlTBrCGSmOb5IVaEVKgyMMSuMMT2NMW/aG5JPG2OeKOyHiEgE0ApYn8fqG0Rkm4gsFpE8Lz2JyCgRiRGRmPj4+MJ+rFJlhtWg3IagSp48PG0TCclX6aF8SYtB1uB2B36GOSMgK8PxhaoKq7B3E80QEX8R8QV2ArtF5OlCvrcyMA8Ya4zJfYvEZqCOMaYF8AHwVV77MMZ8aoyJNsZEh4SEFOZjlSpzQvy8GD+sDfHJ6Tw2YzOZV+uhfEnrYdDjv7BvCcy9T6fPVA5T2MtETe2/yHsDi4G6WHcUXZX99tN5wBfGmPm51xtjzhtjku3PvwM8RCSfKaOUcn1R4YG8Ye+h/Nq3ewr3puj7odt/YO8imPcgZGc5tkhVIRV22ksP+y/23sCHxphMEbnqfXIiIsAkYI8x5t18tqkOnDTGGBFphxVOCYUvXynX06d1OLt+P8+k1YdoVsOf/tG1Cn7T9aPgYiZ8/wLYPOCe8eBW0D0cShVeYcNgPBALbANWikgdoKBeMR2wzh52iMhW+7IXgNoAxphxQD9gtIhkAanAIGNMATdjK+X6nu/WhL0nzvP3r3bSsJofLWsFFvymGx6zxjH66SVArAZmm05jrkqGFPd3r4i4G2NK/Xw1OjraxMTElPbHKlXizl7I4O4PV5OZfZFvxnQk1M+7cG9c9S78/DI06WH1SXD3cmyhqlwQkU3GmOj81he2ATlARN69dEePiLwD+JZYlUpVQEG+nkwYHs351CxGT99MRlYhGpQBbnoKur1ltSHMGKgd01SJKGwD8mQgCRhgf5wHPnNUUUpVFNeF+fN2/xZsOnyWFxfuog/iJBUAABklSURBVNBn6tc/DL0+hkMrYHpfSCtE3wWlrqKwYVDfGPOiMeag/fEyUM+RhSlVUXSPCuPRTvWZueEIU9bGFv6NrYZYcyrHxcCUnnBB771QxVfYMEgVkY6XXohIB6wGX6VUCfhbl8Z0aVqNVxbtZtmvpwr/xma9YdAMiN8Ln9+lE+SoYitsGDwCfCQisSISC3wIPOywqpSqYNzchP8Nasl1Yf6MmbGl4DkQcmrUBYbMhcQ4mNwVzh52XKGq3CrscBTb7L2Eo4AoY0wroLNDK1Oqgqnk6c7EEdH4etm4//ONxCcVYsiKS+reBMO/htSz8Fk3OP2b4wpV5VKRZjqz9xi+1L/gKQfUo1SFFhbgw8ThbUm4kM6oaTGkZWYX/s3h0TDyW6svwmfd4MQOxxWqyp1rmfZSSqwKpdQfmocH8L+BLdly5BxPz91e+DuMAKpHwn1LwOYFn3eHoxsdV6gqV64lDLSnsFIO0jUyjGe7NuGbbb/z3s9FvORTtQHcvxh8gmFqL9j3g2OKVOXKVcNARJJE5HwejySgRinVqFSF9Mgt9ejXJpz//fQbX289VrQ3B9aG+5dYwTBzIGyY4JgiVblx1TAwxvgZY/zzePgZY3RQFKUcSER4/Z7mtKsbzNNzt7Pp8Nmi7cCvOoz8DhreCd/9Db7/O1wsZC9nVeFcy2UipZSDebq7MX5oG8ICvBk1NYajZ1KKtgOvyjDoC2j3MPzyIcwZDhlF3IeqEDQMlCrjgnw9mTSiLZnZF3lgykaS0oo4wY2bDe56C7q+AXsWwZQekFyEjm2qQtAwUMoFNAitzCdD23Aw/gJjZm4hqzCzpOXWfrR1lnByN0y8DeJ/LflClcvSMFDKRXRoUJV/9Y5k+a/xvPRNEQa1y6lJd7jvO8hMg0l3wKGVJV+ockkaBkq5kMHtavPwLfWYvu4IHy7dX7yd1GwND/0MfjVg2j2wdUbJFqlckoaBUi7m2Tub0Kd1Td75cR8zNxwp3k4u3Xoa0RG+Gg3LXgedZLBC0zBQysW4uQlv9o2iU+MQ/r5gB9/vKuZIpT6B1gB3rYbCijdh7n2QnlyyxSqXoWGglAvysLnx8ZDWRIUH8sTMLWw4dKZ4O7J5QM8P4faXYffXMKEzxO8r2WKVS9AwUMpFVfJ0Z/LIttQM8uHBKRvZe+J8wW/Kiwh0HAvDvoKUBJhwK+xaULLFqjJPw0ApFxbs68nU+9vh42ljxOQNxJ29hg5l9W6BR1ZBaFOYMxKWvADZRezToFyWhoFSLi48qBJT77+e1Ixshk/ewJkLGcXfmX8Naxjsdg/Duo9gyt06e1oF4bAwEJFaIrJMRHaLyC4ReTKPbURE3heR/SKyXURaO6oepcqzxtX9mDiiLXFnU7n/842kZGQVf2funlaP5b6T4Pg2GHcTxK4puWJVmeTIM4Ms4K/GmKZAe+AxEWmaa5tuQEP7YxTwiQPrUapca1c3mA8Gt2J73Dke/WIzmcXppZxT837w0FLw9rfOENa8r7eflmMOCwNjzHFjzGb78yRgD1Az12a9gKnGsg4IFJEwR9WkVHl3Z7PqvHZPc5b/Gs+z84o4MU5eQq+Dh5ZZPZd//D+YPRzSitlQrcq0UmkzEJEIoBWwPteqmsDRHK/juDIwEJFRIhIjIjHx8fGOKlOpcmFwu9o8dUcj5m8+xhuL9177Dr39YcBU6PIq7P3Wutvo2KZr368qUxweBiJSGZgHjM0xf3KRGGM+NcZEG2OiQ0JCSrZApcqhMZ0bMKx9HcavPMh7PxVxprS8iMCNY2DEN5CZChPvgGX/1ruNyhGHhoGIeGAFwRfGmPl5bHIMqJXjdbh9mVLqGogIL/dsRr824fz3p318tKyY4xjlFtEBRq+F5v1hxRvWYHfaSa1ccOTdRAJMAvYYY97NZ7OFwHD7XUXtgURjzHFH1aRURXJp2Io+rWryn+9/5ZPlB0pmxz6B0Ge8deno7GEYfxOs+0RnUXNxjpy6sgMwDNghIlvty14AagMYY8YB3wF3AfuBFOA+B9ajVIVjcxP+078F2cbw5pK9uLsJD91cr2R23rQX1GoP3zwBS56DX7+DXh9DYK2C36vKHIeFgTFmNSAFbGOAxxxVg1LKCoR3+rcg66Lhte/24OYmPNCxbsns3K8aDJ4FW6bBkufhkxuh21vQYpDVzqBchvZAVqoCcLe58b+BLekWWZ1/LdrN52sOldzORaD1cBi9BqpFwlePwOxhcOF0yX2GcjgNA6UqCA+bG+8PbkWXptV46ZvdTPsltmQ/ICgCRi6CO/4F+76Hj9vDrq+0o5qL0DBQqgLxsLnx4b2tuf26UP7v613MWF/MyXHy42aDDk/AqBXgFwZzRsD0vpBQQo3XymE0DJSqYDzd3fhoSGtubRzCCwt28OXGEg4EgGpNrZ7LXd+EuI3WWcLS16w+CqpM0jBQqgLycrfxydA23NwohOfm72BOzNGC31RUNndo/wg8HgNNe8PKt+Cj6+HXJSX/WeqaaRgoVUF5e9j4dFgbOjaoyjPztjsmEMC646jvBBixCDx8YOZAmDnY6qOgygwNA6UqMCsQoulQvypPz93OhJUHHfdhdW+CR1bDHa/AwRXWWcLK/0BWuuM+UxWahoFSFZyPp41JI6O5q3l1XvtuD28u2Xvto53mx+YBHZ6ExzdAoy6w9FWrb8L+nx3zearQNAyUUni52/hgcGvuvb42nyw/wPPzd5B1rfMhXE1AuDWcxdB51q2n0/vA1N5wbLPjPlNdlYaBUgqweiq/1juSMZ0bMGvjUR6bsZm0zGzHfmiD2+HRX+DO1+HEdmt47NnDdfA7J9AwUEr9QUT4a5fG/LNHU77fdZL7PttIUpqDh6l294IbHoMntsItz1mXjD6+Hr5+HBLjHPvZ6g8aBkqpK9zfsS7/HdiCjbFnGDxhHaeTS6GR19sfbn0entwG1z8C27+E91vD93+HCwmO//wKTsNAKZWne1qFM2F4NPtPJdN/3C8cPZNSOh/sWxW6/hvGbIao/rDuY3ivBSx/A9KTSqeGCkjDQCmVr1ubhDL9getJSE6n37i17DtZir+MA2tBr4/g0XVQ/1ZY/m8rFFb/D9ISS6+OCkLDQCl1VdERwcx+5AaMgf7jfmHT4bOlW0BIYxg4DR5aCmEt4KcX4d1m8MM/IFEnRiwpGgZKqQI1qe7PvNE3ElTJgyET1/HtdidMSFizDQxbAA+vhEZ3wi8fw3tRsGA0nNxd+vWUMxoGSqlCqRVciTmP3EjTMH8em7GZd3/cx8WLThieOqwF9JsET2yBtg/C7q/gkxtgej84tEqHzC4mcVhPQweJjo42MTExzi5DqQorPSubvy/YydxNcXRtVp13BrTA18uRM+gWIOUMbJwE68dBymmo0doaRvu6ntaQ2goAEdlkjInOd72GgVKqqIwxTFp9iNe/20Ojan5MHBFNeFAl5xaVmQrbZsLaD+HMAQisA21GQssh1mB5FZyGgVLKYVbsi+fxGZvxtLkxblgb2kYEO7skuJgNe7+F9ePh8Gpwc4fG3axgqNcZ3Crm1XENA6WUQx2IT+ahKTEcPZvCv3pFMqhdbWeX9KfTv8HmKbB1BqQkQGBta77mlkPBP8zZ1ZUqDQOllMMlpmYyZuYWVu6LZ+SNEfyj+3W428rQX+BZ6dbZwqbP4dAKEBs06gptRljjI1WAtgUNA6VUqcjKvsgbi/cycfUhOjaoyof3tiKwkqezy7pSwgHYPBW2fgEX4sE/HFoMhMi+ENoURJxdoUM4LQxEZDLQAzhljInMY30n4GvgkH3RfGPMKwXtV8NAqbJtdsxR/rFgJzUCvZkwPJqG1fycXVLesjJg32LYNAUOLgeTDSFNrFBo1geqNnB2hSXKmWFwM5AMTL1KGPzNGNOjKPvVMFCq7Nt0+AwPT9tMcnomL93djIFtayFl+S/u5HjY8zXsnA+H1wIGqkdZwRDZx2prcHFOvUwkIhHAIg0DpSqeU0lpPPXlNlbvP033qDBev6c5AT4ezi6rYInHrI5sO+fBsU3WsvB2VjA07eWyDc9lPQzmAXHA71jBsCuf/YwCRgHUrl27zeHDOpG2Uq7g4kXD+JUHeeeHX6nm7837g1vRpk6Qs8sqvDOHYNcC64zh5A5rWY1WVuNzozuheguXuVW1LIeBP3DRGJMsIncB7xljGha0Tz0zUMr1bDlylidmbeH3c2k8dUcjHrmlPja3MnzZKC/xv8KehbDvB4jbCBioXA0adrHCoV4n8Krs5CLzV2bDII9tY4FoY8zpq22nYaCUazqflsnfF+zkm22/c2P9Kvx3YEuq+Xs7u6ziuXAa9v8E+5ZYM7OlnwebJ0R0tIKhYRcIruvsKi9TZsNARKoDJ40xRkTaAXOBOqaAgjQMlHJdxhjmxMTx4sJd+HjaeLt/FJ2buPhQEdmZcGSdFQz7voeE36zlQXWh7s3WI+Impw+J4cy7iWYCnYCqwEngRcADwBgzTkQeB0YDWUAq8JQxZm1B+9UwUMr17T+VzJiZW9hz/Dz3dYjguW5N8HIvJx2/Eg7Abz9andti10C6fSKeqo3+DIaIm8C3SqmWpZ3OlFJlUlpmNm8s3svna2NpGubPf/pH0axGgLPLKlkXs+H4NohdZQ2vfeQXyEi21oU2g7o3WZeWal0PlUMdWoqGgVKqTPtp90mem7+dsymZjLq5Hk/e1hBvj3JylpBbdib8vtV+1rAKjqyHrFRrXWBtCG9r3cYa3haqNwf3kuvBrWGglCrzzqVk8Pp3e5gdE0fdqr78u09z2tcr3csoTpGVboVD3MY/H+ftU3navKyJfGq1g/BoKyACwov9URoGSimXsWb/aZ6fv4MjZ1IY3K42z3Vr4hod1UpS4jE4FgNHN0BcDBzfCllp1robHoc7XyvWbjUMlFIuJTUjm//+tI+Jqw5StbIXr/SKpGtkdWeX5TxZGXByp3XWUK2Z1cZQDBoGSimXtCMukWfmbWfP8fN0i6zOyz2bEeqq/RLKgILCwDX6USulKpzm4QEsfLwDT9/ZmJ/3nuL2d1fw5cYjuNofsK5Cw0ApVWZ52Nx47NYGLHnyJpqE+fPsvB30G/cLW4+ec3Zp5Y6GgVKqzKsXUplZD7Xnzb7NOZyQQu+P1jB21haOnUt1dmnlhoaBUsoluLkJA9vWZvnTnXjs1vp8t/MEnd9ezjs//MqF9Cxnl+fyNAyUUi6lspc7T9/ZhKV/vYU7m1Xng6X76fT2cr7ceITsi9qeUFwaBkoplxQeVIn3B7di/qM3UivIh2fn7aDHB6tZu/+qAx+rfGgYKKVcWuvaQcwbfSMfDG7F+dRM7p24ngenxHAgPtnZpbkU7WeglCo30jKzmbzmEB8vO0BqZja9W9bk8c4NqFvV19mlOZ12OlNKVTjxSel8svwAX6w/TGb2RXrZQ6F+SNmdiczRNAyUUhXWqaQ0Jqw8yPR1R0jLyubuqBqM6dyAhtX8nF1aqdMwUEpVeKeT05mw6iDTfjlMamY2dzUPY0znBjSp7u/s0kqNhoFSStmduZDBpNUHmbL2MMnpWXSLrM6Yzg1pWqP8h4KGgVJK5XIuJYPJqw/x2ZpYktKz6NQ4hPs61OXmhlUREWeX5xAaBkoplY/E1EymrI1l6i+HOZ2cTv0QX0Z2qEvf1jWp5Onu7PJKlIaBUkoVID0rm+92HOezNbFsj0vE39udgW1rMfyGCGoFV3J2eSVCw0AppQrJGMPmI2eZvCaWJTtPYIzhjqbVGHljXdrXC3bpS0gFhUH5Og9SSqlrICK0qRNMmzrBHE9MZdovh5m54Qjf7zrJdWH+jLyxDj2iauDrVf5+dTrszEBEJgM9gFPGmMg81gvwHnAXkAKMNMZsLmi/emaglCpNaZnZfL31GJ+tiWXviSQqedq4q3kY/duE066u65wtOO0ykYjcDCQDU/MJg7uAMVhhcD3wnjHm+oL2q2GglHKGS5eQ5sTEsWj7cZLTs6hTpRL9WofTt004NQJ9nF3iVTm1zUBEIoBF+YTBeGC5MWam/fWvQCdjzPGr7VPDQCnlbCkZWSzecYI5m46y7uAZRKBjg6r0axPOnc2q4+1hc3aJVyjLbQY1gaM5XsfZl10RBiIyChgFULt27VIpTiml8lPJ052+bawzgiMJKczdHMe8TXE8OWsr/t7u3N2iBve0qknr2kG4ubnGZSSXaAUxxnwKfArWmYGTy1FKqT/UrlKJp+5oxNjbGvLLwQTmxBxl7qY4vlh/hOr+3nRrXp0eUWG0qlW2g8GZYXAMqJXjdbh9mVJKuRw3N6FDg6p0aFCVf6Vl8vOeU3y74zhfrD/CZ2tiy3wwODMMFgKPi8gsrAbkxILaC5RSyhX4eXvQu1VNereqSVI+wXBX8zC6R1UvM8HgyLuJZgKdgKrASeBFwAPAGDPOfmvph0BXrFtL7zPGFNgyrA3ISilXlTMYVuyLJyPrItX8vejcpBqdm4TSoUEVhw2DoT2QlVKqDLoUDN/vOsGq306TnJ6Fp7sbN9SrQucmoXRuElqiQ2FoGCilVBmXkXWRjbFnWLr3FMv2nuLg6QsANAytTOcmodzaJJQ2dYLwsBV/2noNA6WUcjGHTl/4IxjWH0ogM9vg7+3OE7c15MGb6hVrn2W5n4FSSqk81K3qywMd6/JAx7okpWWyZv9plu49RTV/b4d9poaBUkqVYX7eHnSNDKNrZJhDP6f4F6CUUkqVGxoGSimlNAyUUkppGCillELDQCmlFBoGSiml0DBQSimFhoFSSilccDgKEYkHDhfz7VWB0yVYTllQ3o6pvB0PlL9jKm/HA+XvmPI6njrGmJD83uByYXAtRCTmamNzuKLydkzl7Xig/B1TeTseKH/HVJzj0ctESimlNAyUUkpVvDD41NkFOEB5O6bydjxQ/o6pvB0PlL9jKvLxVKg2A6WUUnmraGcGSiml8qBhoJRSquKEgYh0FZFfRWS/iDzn7HpKgojEisgOEdkqIi43F6iITBaRUyKyM8eyYBH5UUR+s/8McmaNRZXPMb0kIsfs39NWEbnLmTUWhYjUEpFlIrJbRHaJyJP25S75PV3leFz5O/IWkQ0iss1+TC/bl9cVkfX233lfiojnVfdTEdoMRMQG7APuAOKAjcBgY8xupxZ2jUQkFog2xrhkZxkRuRlIBqYaYyLty94Czhhj3rCHdpAx5lln1lkU+RzTS0CyMeZtZ9ZWHCISBoQZYzaLiB+wCegNjMQFv6erHM8AXPc7EsDXGJMsIh7AauBJ4ClgvjFmloiMA7YZYz7Jbz8V5cygHbDfGHPQGJMBzAJ6ObmmCs8YsxI4k2txL2CK/fkUrP9RXUY+x+SyjDHHjTGb7c+TgD1ATVz0e7rK8bgsY0m2v/SwPwzQGZhrX17gd1RRwqAmcDTH6zhc/B+AnQF+EJFNIjLK2cWUkGrGmOP25yeAas4spgQ9LiLb7ZeRXOKSSm4iEgG0AtZTDr6nXMcDLvwdiYhNRLYCp4AfgQPAOWNMln2TAn/nVZQwKK86GmNaA92Ax+yXKMoNY13DLA/XMT8B6gMtgePAO84tp+hEpDIwDxhrjDmfc50rfk95HI9Lf0fGmGxjTEsgHOtKSJOi7qOihMExoFaO1+H2ZS7NGHPM/vMUsADrH4GrO2m/rnvp+u4pJ9dzzYwxJ+3/s14EJuBi35P9OvQ84AtjzHz7Ypf9nvI6Hlf/ji4xxpwDlgE3AIEi4m5fVeDvvIoSBhuBhvbWdU9gELDQyTVdExHxtTeAISK+QBdg59Xf5RIWAiPsz0cAXzuxlhJx6Zem3T240Pdkb5ycBOwxxrybY5VLfk/5HY+Lf0chIhJof+6DdaPMHqxQ6GffrMDvqELcTQRgv1Xsf4ANmGyMec3JJV0TEamHdTYA4A7McLVjEpGZQCes4XZPAi8CXwGzgdpYQ5UPMMa4TINsPsfUCevygwFigYdzXG8v00SkI7AK2AFctC9+Aes6u8t9T1c5nsG47ncUhdVAbMP6A3+2MeYV+++IWUAwsAUYaoxJz3c/FSUMlFJK5a+iXCZSSil1FRoGSimlNAyUUkppGCillELDQCmlFBoGSl1BRLJzjF65tSRHuRWRiJwjmipVVrgXvIlSFU6qvWu/UhWGnhkoVUj2+SPess8hsUFEGtiXR4jIUvsgZz+LSG378moissA+zvw2EbnRviubiEywjz3/g73XqFJOpWGg1JV8cl0mGphjXaIxpjnwIVaPdoAPgCnGmCjgC+B9+/L3gRXGmBZAa2CXfXlD4CNjTDPgHNDXwcejVIG0B7JSuYhIsjGmch7LY4HOxpiD9sHOThhjqojIaawJUzLty48bY6qKSDwQnnMIAPuwyT8aYxraXz8LeBhjXnX8kSmVPz0zUKpoTD7PiyLn+DDZaNudKgM0DJQqmoE5fv5if74WayRcgCFYA6EB/AyMhj8mHwkorSKVKir9i0SpK/nYZ426ZIkx5tLtpUEish3rr/vB9mVjgM9E5GkgHrjPvvxJ4FMReQDrDGA01sQpSpU52magVCHZ2wyijTGnnV2LUiVNLxMppZTSMwOllFJ6ZqCUUgoNA6WUUmgYKKWUQsNAKaUUGgZKKaWA/wfnh92kdwa6HQAAAABJRU5ErkJggg==
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's now load the test set and the model so we can <code>evaluate</code> the trained model for  <code>mae</code> using the test set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">get_dataset_from_csv</span><span class="p">(</span><span class="s1">'eval_filtered.csv'</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span></span>
<span class="code-line">                                    <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s1">'./baselineEmbed64_MoviesTV_batchb1024_tf.h5'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">eval_dataset</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">Evaluation on the test set:'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line"></span>
<span class="code-line">Evaluation on the test set:</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_text output_subarea">
<pre><span class="code-line">{'loss': 1.359154462814331, 'mae': 0.9445576071739197}</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Memory-Efficient-Mode"><code>Memory-Efficient Mode</code><a class="anchor-link" href="#Memory-Efficient-Mode">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Implement-Quotient-Remainder-Embedding-as-a-Layer"><code>Implement Quotient-Remainder Embedding as a Layer</code><a class="anchor-link" href="#Implement-Quotient-Remainder-Embedding-as-a-Layer">¶</a></h3><p>   <font size="4">The Quotient-Remainder technique works by creating two<code>num_buckets X embedding_dim</code> embedding tables for a set of vocabulary and embedding size <code>embedding_dim</code> where<code>num_buckets</code> is much smaller than<code>vocabulary_size</code>, rather than creating a<code>vocabulary_size X embedding_dim</code> embedding table.</font></p>
<p>   <font size="4">An embedding for a given item <code>index</code> is generated by:</font></p>
<ol>
<li><font size="4">Computing the<code>quotient_index</code> as <code>index // num_buckets</code>.</font></li>
<li><font size="4">Computing the <code>remainder_index</code> as <code>index % num_buckets</code>.</font></li>
<li><font size="4">Lookup<code>quotient_embedding</code> from the first embedding table using<code>quotient_index</code>.</font></li>
<li><font size="4">Lookup <code>remainder_embedding</code> from the second embedding table using <code>remainder_index</code>.</font></li>
<li><font size="4">Returning<code>quotient_embedding</code> * <code>remainder_embedding</code>.</font></li>
</ol>
<p>   <font size="4">This technique reduces the number of embedding vectors needed to be stored and trained, as well as generating a unique embedding vector for each item of size <code>embedding_dim</code>. The embeddings,<code>q_embedding</code> and <code>r_embedding</code>, can be combined using other operations like <code>Add</code> and <code>Concatenate</code>.</font></p>
<p>   <font size="4">Let's now set up the config and get the item, quotient and remainder indeces. Then lookup the quotient_embedding using the quotient_index and lookup the remainder_embedding using the remainder_index. Use multiplication as a combiner operation.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">class</span> <span class="nc">QREmbedding</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span></span>
<span class="code-line">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocabulary</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">num_buckets</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="nb">super</span><span class="p">(</span><span class="n">QREmbedding</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">num_buckets</span> <span class="o">=</span> <span class="n">num_buckets</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">index_lookup</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span></span>
<span class="code-line">            <span class="n">vocabulary</span><span class="o">=</span><span class="n">vocabulary</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_oov_indices</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">q_embeddings</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">num_buckets</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,)</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">r_embeddings</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="n">num_buckets</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line">        <span class="n">config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span></span>
<span class="code-line">        <span class="k">return</span> <span class="n">config</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span></span>
<span class="code-line">        <span class="n">embedding_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_lookup</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span></span>
<span class="code-line">        <span class="n">quotient_index</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="n">embedding_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_buckets</span><span class="p">)</span></span>
<span class="code-line">        <span class="n">remainder_index</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">floormod</span><span class="p">(</span><span class="n">embedding_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_buckets</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="n">quotient_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_embeddings</span><span class="p">(</span><span class="n">quotient_index</span><span class="p">)</span></span>
<span class="code-line">        <span class="n">remainder_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_embeddings</span><span class="p">(</span><span class="n">remainder_index</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="k">return</span> <span class="n">quotient_embedding</span> <span class="o">*</span> <span class="n">remainder_embedding</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Implement-Mixed-Dimension-Embedding-as-a-Layer"><code>Implement Mixed Dimension Embedding as a Layer</code><a class="anchor-link" href="#Implement-Mixed-Dimension-Embedding-as-a-Layer">¶</a></h3><p>   <font size="4">Embedding vectors are trained with full dimensions for the frequently queried items, while embedding vectors with reduced dimensions are trained for less frequent items. A projection weights matrix allows low dimension embeddings to become the full dimensions.</font></p>
<p>   <font size="4">More precisely, we define blocks of items of similar frequencies. For each block, a <code>block_vocab_size X block_embedding_dim</code> embedding table and <code>block_embedding_dim X full_embedding_dim</code> projection weights matrix are created. Note that, if <code>block_embedding_dim</code> equals <code>full_embedding_dim</code>, the projection weights matrix becomes an identity matrix. Embeddings for a given batch of item <code>indices</code> are generated via the following steps:</font></p>
<ol>
<li><font size="4"> For each block, lookup the <code>block_embedding_dim</code> embedding vectors using <code>indices</code>, and project them to the <code>full_embedding_dim</code>.</font></li>
<li><font size="4">If an item index does not belong to a given block, an out-of-vocabulary embedding is returned. Each block will return a <code>batch_size X full_embedding_dim</code> tensor.</font></li>
<li><font size="4">A mask is applied to the embeddings returned from each block in order to convert the out-of-vocabulary embeddings to vector of zeros. That is, for each item in the batch, a single non-zero embedding vector is returned from the all block embeddings.</font></li>
<li><font size="4">Embeddings retrieved from the blocks are combined using sum to produce the final <code>batch_size X full_embedding_dim</code> tensor.</font></li>
</ol>
<p>   <font size="4">For the<code>MDEmbedding</code> class, let's create a vocabulary to block lookup and create block embedding encoders and projectors. Then configure the layers where the block index for each input item is determined, followed by initializing the output embeddings to zeros and the embeddings are generated from the blocks. Then lookup and project embeddings from the current block to <code>base_embedding_dim</code> and create a mask to filter out the embeddings of items not in the current block. Then set the embeddings for the items not in the current block to zero. and add the block embeddings to the final embeddings.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">class</span> <span class="nc">MDEmbedding</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span></span>
<span class="code-line">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blocks_vocabulary</span><span class="p">,</span> <span class="n">blocks_embedding_dims</span><span class="p">,</span></span>
<span class="code-line">                 <span class="n">base_embedding_dim</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="nb">super</span><span class="p">(</span><span class="n">MDEmbedding</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blocks_vocabulary</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span></span>
<span class="code-line">        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span></span>
<span class="code-line">        <span class="k">for</span> <span class="n">block_idx</span><span class="p">,</span> <span class="n">block_vocab</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">blocks_vocabulary</span><span class="p">):</span></span>
<span class="code-line">            <span class="n">keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">block_vocab</span><span class="p">)</span></span>
<span class="code-line">            <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">block_idx</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_vocab</span><span class="p">))</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">vocab_to_block</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">lookup</span><span class="o">.</span><span class="n">StaticHashTable</span><span class="p">(</span></span>
<span class="code-line">            <span class="n">tf</span><span class="o">.</span><span class="n">lookup</span><span class="o">.</span><span class="n">KeyValueTensorInitializer</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">),</span> <span class="n">default_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">block_embedding_encoders</span> <span class="o">=</span> <span class="p">[]</span></span>
<span class="code-line">        <span class="bp">self</span><span class="o">.</span><span class="n">block_embedding_projectors</span> <span class="o">=</span> <span class="p">[]</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_blocks</span><span class="p">):</span></span>
<span class="code-line">            <span class="n">vocabulary</span> <span class="o">=</span> <span class="n">blocks_vocabulary</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></span>
<span class="code-line">            <span class="n">embedding_dim</span> <span class="o">=</span> <span class="n">blocks_embedding_dims</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></span>
<span class="code-line">            <span class="n">block_embedding_encoder</span> <span class="o">=</span> <span class="n">embedding_encoder</span><span class="p">(</span></span>
<span class="code-line">                <span class="n">vocabulary</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">,</span> <span class="n">num_oov_indices</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line">            <span class="bp">self</span><span class="o">.</span><span class="n">block_embedding_encoders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block_embedding_encoder</span><span class="p">)</span></span>
<span class="code-line">            <span class="k">if</span> <span class="n">embedding_dim</span> <span class="o">==</span> <span class="n">base_embedding_dim</span><span class="p">:</span></span>
<span class="code-line">                <span class="bp">self</span><span class="o">.</span><span class="n">block_embedding_projectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">))</span></span>
<span class="code-line">            <span class="k">else</span><span class="p">:</span></span>
<span class="code-line">                <span class="bp">self</span><span class="o">.</span><span class="n">block_embedding_projectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span></span>
<span class="code-line">                    <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">base_embedding_dim</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line">        <span class="n">config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span></span>
<span class="code-line">        <span class="k">return</span> <span class="n">config</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span></span>
<span class="code-line">        <span class="n">block_indicies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab_to_block</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span></span>
<span class="code-line">        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">inputs</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">base_embedding_dim</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_blocks</span><span class="p">):</span></span>
<span class="code-line">            <span class="n">block_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_embedding_encoders</span><span class="p">[</span><span class="n">idx</span><span class="p">](</span><span class="n">inputs</span><span class="p">)</span></span>
<span class="code-line">            <span class="n">block_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_embedding_projectors</span><span class="p">[</span><span class="n">idx</span><span class="p">](</span><span class="n">block_embeddings</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">            <span class="n">mask</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">block_indicies</span> <span class="o">==</span> <span class="n">idx</span><span class="p">,</span></span>
<span class="code-line">                                          <span class="n">tf</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span></span>
<span class="code-line">            <span class="n">block_embeddings</span> <span class="o">=</span> <span class="n">block_embeddings</span> <span class="o">*</span> <span class="n">mask</span></span>
<span class="code-line">            <span class="n">embeddings</span> <span class="o">+=</span> <span class="n">block_embeddings</span></span>
<span class="code-line"></span>
<span class="code-line">        <span class="k">return</span> <span class="n">embeddings</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Implement-the-Memory-Efficient-Mode"><code>Implement the Memory-Efficient Mode</code><a class="anchor-link" href="#Implement-the-Memory-Efficient-Mode">¶</a></h3><p>   <font size="4">The<code>Quotient-Remainder</code> method reduces the size of the user embeddings, and the<code>Mixed Dimensio</code> method reduces the size of the item embeddings. The number of blocks and the dimensions of embeddings of each block are determined based on the histogram visualization of frequency of the items, potentially popularity. So let's use<code>pandas.Dataframe.value_counts(</code> to generate <code>item_frequencies</code> and plot with <code>bins=10</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">item_frequencies</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span class="code-line"><span class="n">item_frequencies</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f635fdf0f40&gt;</span></pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,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
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><font size="4">We can also examine the 5 number summary statistics using<code>pandas.Dataframe.describe</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">item_frequencies</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">count    103687.000000</span>
<span class="code-line">mean         10.738048</span>
<span class="code-line">std          32.901640</span>
<span class="code-line">min           1.000000</span>
<span class="code-line">25%           1.000000</span>
<span class="code-line">50%           3.000000</span>
<span class="code-line">75%           8.000000</span>
<span class="code-line">max        1136.000000</span>
<span class="code-line">Name: item_id, dtype: float64</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><font size="4">Let's examine the items with a count less than the mean and graph.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">dat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'item_id'</span><span class="p">)[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">'count'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="n">dat</span><span class="o">.</span><span class="n">shape</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">(234484, 3)</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">item_frequencies1</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span class="code-line"><span class="n">item_frequencies1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f678072bc10&gt;</span></pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,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
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><font size="4">Then, we can examine the the items with a count more than the mean and graph.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">dat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'item_id'</span><span class="p">)[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">'count'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="n">dat</span><span class="o">.</span><span class="n">shape</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">(895032, 3)</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">item_frequencies1</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span class="code-line"><span class="n">item_frequencies1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f6780a87610&gt;</span></pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,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
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">dat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'item_id'</span><span class="p">)[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">'count'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">]</span></span>
<span class="code-line"><span class="n">dat</span><span class="o">.</span><span class="n">shape</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">(752937, 3)</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">item_frequencies1</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span class="code-line"><span class="n">item_frequencies1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f678057b040&gt;</span></pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYMAAAD4CAYAAAAO9oqkAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjIsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+WH4yJAAAWn0lEQVR4nO3df4xd9Znf8fcnNiQsNLEJ6YjaVk2FtSsnKEBG4FVW1YQ0YEhVs1IaQVEwWRpvG1CTCrVxtmpJQpCItJt0kbJovcGLWaVxKEmKBc5arsMoyh/8TFjAkJQJOMUWgd3YQCZpyTp9+sf9jvfWnbHv2PPDnvN+SVdzznO+59zvo4P84Zx75k6qCklSt71pvicgSZp/hoEkyTCQJBkGkiQMA0kSsHi+J3CszjrrrFq5cuXA43/xi19w+umnz96ETkBd7Bm62XcXe4Zu9n28PT/++ON/U1XvOLx+0obBypUreeyxxwYePzo6ysjIyOxN6ATUxZ6hm313sWfoZt/H23OSn0xW9zaRJMkwkCQZBpIkDANJEoaBJAnDQJKEYSBJwjCQJGEYSJI4iX8D+Xis3PjAoeU9t31wHmciSScGrwwkSYaBJGmAMEjyliSPJPmrJLuTfLbV70ryQpIn2uv8Vk+S25OMJXkyyYV9x1qf5Ln2Wt9Xf0+Sp9o+tyfJbDQrSZrcIJ8ZvAFcUlXjSU4Bvpfk223bv6uqew8bfzmwqr0uBu4ALk5yJnAzMAwU8HiSbVV1oI35GPAwsB1YC3wbSdKcOOqVQfWMt9VT2quOsMs64O6230PAkiRnA5cBO6tqfwuAncDatu2tVfVQVRVwN3DlcfQkSZqmgZ4mSrIIeBw4F/hyVT2c5F8Dtyb5T8AuYGNVvQEsA17s231vqx2pvneS+mTz2ABsABgaGmJ0dHSQ6QMwPj5+aPxN5x08VJ/OMU42/T13SRf77mLP0M2+Z6vngcKgqn4NnJ9kCfCtJO8CPg38FDgV2AR8CvjcjM/w/53HpvZeDA8P13T+wEP/H4S4rv/R0msGP8bJpot/+AO62XcXe4Zu9j1bPU/raaKqehV4EFhbVS+1W0FvAH8OXNSG7QNW9O22vNWOVF8+SV2SNEcGeZroHe2KgCSnAR8Aftju9dOe/LkSeLrtsg24tj1VtAZ4rapeAnYAlyZZmmQpcCmwo217Pcmadqxrgftmtk1J0pEMcpvobGBL+9zgTcA9VXV/ku8keQcQ4AngX7Xx24ErgDHgl8BHAapqf5JbgEfbuM9V1f62/HHgLuA0ek8R+SSRJM2ho4ZBVT0JXDBJ/ZIpxhdwwxTbNgObJ6k/BrzraHORJM0OfwNZkmQYSJIMA0kShoEkCcNAkoRhIEnCMJAkYRhIkjAMJEkYBpIkDANJEoaBJAnDQJKEYSBJwjCQJGEYSJIwDCRJGAaSJAwDSRIDhEGStyR5JMlfJdmd5LOtfk6Sh5OMJfl6klNb/c1tfaxtX9l3rE+3+o+SXNZXX9tqY0k2znybkqQjGeTK4A3gkqp6N3A+sDbJGuALwJeq6lzgAHB9G389cKDVv9TGkWQ1cBXwTmAt8CdJFiVZBHwZuBxYDVzdxkqS5shRw6B6xtvqKe1VwCXAva2+BbiyLa9r67Tt70+SVt9aVW9U1QvAGHBRe41V1fNV9StgaxsrSZojiwcZ1P7v/XHgXHr/F/9j4NWqOtiG7AWWteVlwIsAVXUwyWvA21v9ob7D9u/z4mH1i6eYxwZgA8DQ0BCjo6ODTB+A8fHxQ+NvOu/gofp0jnGy6e+5S7rYdxd7hm72PVs9DxQGVfVr4PwkS4BvAb814zMZbB6bgE0Aw8PDNTIyMvC+o6OjTIy/buMDh+p7rhn8GCeb/p67pIt9d7Fn6Gbfs9XztJ4mqqpXgQeB3waWJJkIk+XAvra8D1gB0La/DfhZf/2wfaaqS5LmyCBPE72jXRGQ5DTgA8Cz9ELhQ23YeuC+trytrdO2f6eqqtWvak8bnQOsAh4BHgVWtaeTTqX3IfO2mWhOkjSYQW4TnQ1saZ8bvAm4p6ruT/IMsDXJ54EfAHe28XcCf5FkDNhP7x93qmp3knuAZ4CDwA3t9hNJbgR2AIuAzVW1e8Y6lCQd1VHDoKqeBC6YpP48vSeBDq//b+CfT3GsW4FbJ6lvB7YPMF9J0izwN5AlSYaBJMkwkCRhGEiSMAwkSRgGkiQMA0kShoEkCcNAkoRhIEnCMJAkYRhIkjAMJEkYBpIkDANJEoaBJAnDQJKEYSBJwjCQJGEYSJIYIAySrEjyYJJnkuxO8olW/0ySfUmeaK8r+vb5dJKxJD9KcllffW2rjSXZ2Fc/J8nDrf71JKfOdKOSpKkNcmVwELipqlYDa4Abkqxu275UVee313aAtu0q4J3AWuBPkixKsgj4MnA5sBq4uu84X2jHOhc4AFw/Q/1JkgZw1DCoqpeq6vtt+efAs8CyI+yyDthaVW9U1QvAGHBRe41V1fNV9StgK7AuSYBLgHvb/luAK4+1IUnS9C2ezuAkK4ELgIeB9wI3JrkWeIze1cMBekHxUN9ue/m78HjxsPrFwNuBV6vq4CTjD3//DcAGgKGhIUZHRwee+/j4+KHxN5138FB9Osc42fT33CVd7LuLPUM3+56tngcOgyRnAN8APllVrye5A7gFqPbzj4Dfm/EZ9qmqTcAmgOHh4RoZGRl439HRUSbGX7fxgUP1PdcMfoyTTX/PXdLFvrvYM3Sz79nqeaAwSHIKvSD4alV9E6CqXu7b/mfA/W11H7Cib/flrcYU9Z8BS5IsblcH/eMlSXNgkKeJAtwJPFtVX+yrn9037HeBp9vyNuCqJG9Ocg6wCngEeBRY1Z4cOpXeh8zbqqqAB4EPtf3XA/cdX1uSpOkY5MrgvcBHgKeSPNFqf0DvaaDz6d0m2gP8PkBV7U5yD/AMvSeRbqiqXwMkuRHYASwCNlfV7na8TwFbk3we+AG98JEkzZGjhkFVfQ/IJJu2H2GfW4FbJ6lvn2y/qnqe3tNGkqR54G8gS5IMA0mSYSBJwjCQJGEYSJIwDCRJGAaSJAwDSRKGgSQJw0CShGEgScIwkCRhGEiSMAwkSRgGkiQMA0kShoEkCcNAkoRhIEnCMJAkMUAYJFmR5MEkzyTZneQTrX5mkp1Jnms/l7Z6ktyeZCzJk0ku7DvW+jb+uSTr++rvSfJU2+f2JJmNZiVJkxvkyuAgcFNVrQbWADckWQ1sBHZV1SpgV1sHuBxY1V4bgDugFx7AzcDFwEXAzRMB0sZ8rG+/tcffmiRpUEcNg6p6qaq+35Z/DjwLLAPWAVvasC3AlW15HXB39TwELElyNnAZsLOq9lfVAWAnsLZte2tVPVRVBdzddyxJ0hxYPJ3BSVYCFwAPA0NV9VLb9FNgqC0vA17s221vqx2pvneS+mTvv4He1QZDQ0OMjo4OPPfx8fFD42867+Ch+nSOcbLp77lLuth3F3uGbvY9Wz0PHAZJzgC+AXyyql7vv61fVZWkZnx2h6mqTcAmgOHh4RoZGRl439HRUSbGX7fxgUP1PdcMfoyTTX/PXdLFvrvYM3Sz79nqeaCniZKcQi8IvlpV32zll9stHtrPV1p9H7Cib/flrXak+vJJ6pKkOTLI00QB7gSeraov9m3aBkw8EbQeuK+vfm17qmgN8Fq7nbQDuDTJ0vbB8aXAjrbt9SRr2ntd23csSdIcGOQ20XuBjwBPJXmi1f4AuA24J8n1wE+AD7dt24ErgDHgl8BHAapqf5JbgEfbuM9V1f62/HHgLuA04NvtJUmaI0cNg6r6HjDVc//vn2R8ATdMcazNwOZJ6o8B7zraXCRJs8PfQJYkGQaSJMNAkoRhIEnCMJAkYRhIkjAMJEkYBpIkDANJEoaBJAnDQJKEYSBJwjCQJGEYSJIwDCRJGAaSJAwDSRKGgSQJw0CSxABhkGRzkleSPN1X+0ySfUmeaK8r+rZ9OslYkh8luayvvrbVxpJs7Kufk+ThVv96klNnskFJ0tENcmVwF7B2kvqXqur89toOkGQ1cBXwzrbPnyRZlGQR8GXgcmA1cHUbC/CFdqxzgQPA9cfTkCRp+hYfbUBVfTfJygGPtw7YWlVvAC8kGQMuatvGqup5gCRbgXVJngUuAf5FG7MF+Axwx6ANHK+VGx84tLzntg/O1dtK0gnleD4zuDHJk+020tJWWwa82Ddmb6tNVX878GpVHTysLkmaQ0e9MpjCHcAtQLWffwT83kxNaipJNgAbAIaGhhgdHR143/Hx8UPjbzrv4KRjpnO8k0F/z13Sxb672DN0s+/Z6vmYwqCqXp5YTvJnwP1tdR+wom/o8lZjivrPgCVJFrerg/7xk73vJmATwPDwcI2MjAw859HRUSbGX9d3a6jfnmsGP97JoL/nLuli313sGbrZ92z1fEy3iZKc3bf6u8DEk0bbgKuSvDnJOcAq4BHgUWBVe3LoVHofMm+rqgIeBD7U9l8P3Hcsc5IkHbujXhkk+RowApyVZC9wMzCS5Hx6t4n2AL8PUFW7k9wDPAMcBG6oql+349wI7AAWAZurand7i08BW5N8HvgBcOeMdSdJGsggTxNdPUl5yn+wq+pW4NZJ6tuB7ZPUn+fvnjiSJM0DfwNZkmQYSJIMA0kShoEkCcNAkoRhIEnCMJAkYRhIkjAMJEkYBpIkDANJEoaBJAnDQJKEYSBJwjCQJGEYSJIwDCRJGAaSJAwDSRKGgSSJAcIgyeYkryR5uq92ZpKdSZ5rP5e2epLcnmQsyZNJLuzbZ30b/1yS9X319yR5qu1ze5LMdJOSpCMb5MrgLmDtYbWNwK6qWgXsausAlwOr2msDcAf0wgO4GbgYuAi4eSJA2piP9e13+HtJkmbZUcOgqr4L7D+svA7Y0pa3AFf21e+unoeAJUnOBi4DdlbV/qo6AOwE1rZtb62qh6qqgLv7jiVJmiOLj3G/oap6qS3/FBhqy8uAF/vG7W21I9X3TlKfVJIN9K44GBoaYnR0dOAJj4+PHxp/03kHJx0zneOdDPp77pIu9t3FnqGbfc9Wz8caBodUVSWpmZjMAO+1CdgEMDw8XCMjIwPvOzo6ysT46zY+MOmYPdcMfryTQX/PXdLFvrvYM3Sz79nq+VifJnq53eKh/Xyl1fcBK/rGLW+1I9WXT1KXJM2hYw2DbcDEE0Hrgfv66te2p4rWAK+120k7gEuTLG0fHF8K7GjbXk+ypj1FdG3fsSRJc+Sot4mSfA0YAc5KspfeU0G3AfckuR74CfDhNnw7cAUwBvwS+ChAVe1PcgvwaBv3uaqa+FD64/SeWDoN+HZ7SZLm0FHDoKqunmLT+ycZW8ANUxxnM7B5kvpjwLuONg9J0uw57g+QF5KVfR8s77ntg/M4E0maW34dhSTJMJAkGQaSJAwDSRKGgSQJw0CShGEgScIwkCRhGEiSMAwkSRgGkiQMA0kShoEkCcNAkoRhIEnCMJAk4R+3mZJ/6EZSl3hlIEkyDCRJxxkGSfYkeSrJE0kea7Uzk+xM8lz7ubTVk+T2JGNJnkxyYd9x1rfxzyVZf3wtSZKmayauDN5XVedX1XBb3wjsqqpVwK62DnA5sKq9NgB3QC88gJuBi4GLgJsnAkSSNDdm4zbROmBLW94CXNlXv7t6HgKWJDkbuAzYWVX7q+oAsBNYOwvzkiRNIVV17DsnLwAHgAL+tKo2JXm1qpa07QEOVNWSJPcDt1XV99q2XcCngBHgLVX1+Vb/j8D/qqo/nOT9NtC7qmBoaOg9W7duHXiu4+PjnHHGGQA8te+1afV53rK3TWv8iaK/5y7pYt9d7Bm62ffx9vy+973v8b47OYcc76Olv1NV+5L8fWBnkh/2b6yqSnLsaXOYqtoEbAIYHh6ukZGRgfcdHR1lYvx1fY+NDmLPNYO/z4mkv+cu6WLfXewZutn3bPV8XLeJqmpf+/kK8C169/xfbrd/aD9facP3ASv6dl/ealPVJUlz5JjDIMnpSf7exDJwKfA0sA2YeCJoPXBfW94GXNueKloDvFZVLwE7gEuTLG0fHF/aaieMlRsfOPSSpIXoeG4TDQHf6n0swGLgv1TVXyZ5FLgnyfXAT4APt/HbgSuAMeCXwEcBqmp/kluAR9u4z1XV/uOYlyRpmo45DKrqeeDdk9R/Brx/knoBN0xxrM3A5mOdiyTp+PgbyJIkw0CSZBhIkvArrKfNr7aWtBB5ZSBJMgwkSd4mOi7eMpK0UHhlIEkyDCRJ3iaaMd4yknQy88pAkmQYSJK8TTQrvGUk6WTjlYEkySuD2eZVgqSTgWEwh6b6S2mGhKT5ZhicALx6kDTfDIMTzOFXD4aDpLlgGJzgvLUkaS4YBiepqUKi303nHeS6Ns7wkHQkJ0wYJFkL/DGwCPhKVd02z1NaUAYJj36Gh9QtJ0QYJFkEfBn4ALAXeDTJtqp6Zn5n1l3TDY/pMmykE8sJEQbARcBYVT0PkGQrsA4wDBao2Qyb/ttjXTETPR9PQPvZ1skvVTXfcyDJh4C1VfUv2/pHgIur6sbDxm0ANrTV3wR+NI23OQv4mxmY7smkiz1DN/vuYs/Qzb6Pt+d/WFXvOLx4olwZDKSqNgGbjmXfJI9V1fAMT+mE1sWeoZt9d7Fn6Gbfs9XzifLdRPuAFX3ry1tNkjQHTpQweBRYleScJKcCVwHb5nlOktQZJ8Rtoqo6mORGYAe9R0s3V9XuGX6bY7q9dJLrYs/Qzb672DN0s+9Z6fmE+ABZkjS/TpTbRJKkeWQYSJIWfhgkWZvkR0nGkmyc7/nMliQrkjyY5Jkku5N8otXPTLIzyXPt59L5nutMS7IoyQ+S3N/Wz0nycDvnX28PJSwoSZYkuTfJD5M8m+S3F/q5TvJv23/bTyf5WpK3LMRznWRzkleSPN1Xm/Tcpuf21v+TSS481vdd0GHQ9zUXlwOrgauTrJ7fWc2ag8BNVbUaWAPc0HrdCOyqqlXArra+0HwCeLZv/QvAl6rqXOAAcP28zGp2/THwl1X1W8C76fW/YM91kmXAvwGGq+pd9B40uYqFea7vAtYeVpvq3F4OrGqvDcAdx/qmCzoM6Puai6r6FTDxNRcLTlW9VFXfb8s/p/ePwzJ6/W5pw7YAV87PDGdHkuXAB4GvtPUAlwD3tiELsee3Af8YuBOgqn5VVa+ywM81vacfT0uyGPgN4CUW4Lmuqu8C+w8rT3Vu1wF3V89DwJIkZx/L+y70MFgGvNi3vrfVFrQkK4ELgIeBoap6qW36KTA0T9OaLf8Z+PfA/2nrbwderaqDbX0hnvNzgL8G/rzdHvtKktNZwOe6qvYBfwj8T3oh8BrwOAv/XE+Y6tzO2L9xCz0MOifJGcA3gE9W1ev926r3HPGCeZY4yT8FXqmqx+d7LnNsMXAhcEdVXQD8gsNuCS3Ac72U3v8FnwP8A+B0/v9bKZ0wW+d2oYdBp77mIskp9ILgq1X1zVZ+eeKysf18Zb7mNwveC/yzJHvo3QK8hN699CXtVgIszHO+F9hbVQ+39XvphcNCPtf/BHihqv66qv4W+Ca987/Qz/WEqc7tjP0bt9DDoDNfc9Huld8JPFtVX+zbtA1Y35bXA/fN9dxmS1V9uqqWV9VKeuf2O1V1DfAg8KE2bEH1DFBVPwVeTPKbrfR+el/3vmDPNb3bQ2uS/Eb7b32i5wV9rvtMdW63Ade2p4rWAK/13U6anqpa0C/gCuB/AD8G/sN8z2cW+/wdepeOTwJPtNcV9O6h7wKeA/47cOZ8z3WW+h8B7m/L/wh4BBgD/ivw5vme3yz0ez7wWDvf/w1YutDPNfBZ4IfA08BfAG9eiOca+Bq9z0X+lt5V4PVTnVsg9J6Y/DHwFL2nrY7pff06CknSgr9NJEkagGEgSTIMJEmGgSQJw0CShGEgScIwkCQB/xfWjA7VpjRXHQAAAABJRU5ErkJggg==
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">dat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'item_id'</span><span class="p">)[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">'count'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">]</span></span>
<span class="code-line"><span class="n">dat</span><span class="o">.</span><span class="n">shape</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">(363159, 3)</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">item_frequencies1</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span></span>
<span class="code-line"><span class="n">item_frequencies1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f6780959a60&gt;</span></pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,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
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now, we can create item block vocabularies with different dimensions. The items can be grouped into three blocks (high, normal and low popularity), and assigned as the embedding dimensions<code>[64, 32, and 16]</code> with the block size split like the frequency of the items. Then, we can define number of embedding buckets for reviewers by dividing the length of the <code>reviewer_vocabular</code> by 100.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">sorted_item_vocabulary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">item_frequencies</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">item_blocks_vocabulary</span> <span class="o">=</span> <span class="p">[</span></span>
<span class="code-line">    <span class="n">sorted_item_vocabulary</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span></span>
<span class="code-line">    <span class="n">sorted_item_vocabulary</span><span class="p">[</span><span class="mi">100</span><span class="p">:],</span></span>
<span class="code-line">    <span class="n">sorted_item_vocabulary</span><span class="p">[:</span><span class="mi">10</span><span class="p">]]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">item_blocks_embedding_dims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">reviewer_embedding_num_buckets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reviewer_vocabulary</span><span class="p">)</span> <span class="o">//</span> <span class="mi">100</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Number of reviewer embedding buckets:'</span><span class="p">,</span> <span class="n">reviewer_embedding_num_buckets</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Number of reviewer embedding buckets: 196</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can define another function <code>create_memory_efficient_mode</code> that uses the reviewers as an input to the <code>MDEmbedding</code> class for the reviewer embeddings, the item as an input to the <code>MDEmbedding</code> for the item embeddings. Then the dot product similarity between reviewer and item embeddings can be generated and converted to a rating scale. Lastly, the model can be created.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">create_memory_efficient_model</span><span class="p">():</span></span>
<span class="code-line">    <span class="n">reviewer_input</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">reviewer_embedding</span> <span class="o">=</span> <span class="n">QREmbedding</span><span class="p">(</span></span>
<span class="code-line">        <span class="n">vocabulary</span><span class="o">=</span><span class="n">reviewer_vocabulary</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">embedding_dim</span><span class="o">=</span><span class="n">base_embedding_dim</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">num_buckets</span><span class="o">=</span><span class="n">reviewer_embedding_num_buckets</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">name</span><span class="o">=</span><span class="s1">'reviewer_embedding'</span><span class="p">)(</span><span class="n">reviewer_input</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">item_input</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">'item_id'</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">string</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">item_embedding</span> <span class="o">=</span> <span class="n">MDEmbedding</span><span class="p">(</span></span>
<span class="code-line">        <span class="n">blocks_vocabulary</span><span class="o">=</span><span class="n">item_blocks_vocabulary</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">blocks_embedding_dims</span><span class="o">=</span><span class="n">item_blocks_embedding_dims</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">base_embedding_dim</span><span class="o">=</span><span class="n">base_embedding_dim</span><span class="p">,</span></span>
<span class="code-line">        <span class="n">name</span><span class="o">=</span><span class="s1">'item_embedding'</span><span class="p">)(</span><span class="n">item_input</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">logits</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'dot_similarity'</span><span class="p">)(</span></span>
<span class="code-line">        <span class="p">[</span><span class="n">reviewer_embedding</span><span class="p">,</span> <span class="n">item_embedding</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">prediction</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">activations</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">logits</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">reviewer_input</span><span class="p">,</span> <span class="n">item_input</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="n">prediction</span><span class="p">,</span></span>
<span class="code-line">                        <span class="n">name</span><span class="o">=</span><span class="s1">'memory_model'</span><span class="p">)</span></span>
<span class="code-line">    <span class="k">return</span> <span class="n">model</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's now create the memory efficient model and examine the model summary.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">memory_efficient_model</span> <span class="o">=</span> <span class="n">create_memory_efficient_model</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">memory_efficient_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Model: "memory_model"</span>
<span class="code-line">__________________________________________________________________________________________________</span>
<span class="code-line"> Layer (type)                   Output Shape         Param #     Connected to                     </span>
<span class="code-line">==================================================================================================</span>
<span class="code-line"> reviewer_id (InputLayer)       [(None,)]            0           []                               </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> item_id (InputLayer)           [(None,)]            0           []                               </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> reviewer_embedding (QREmbeddin  (None, 64)          25088       ['reviewer_id[0][0]']            </span>
<span class="code-line"> g)                                                                                               </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> item_embedding (MDEmbedding)   (None, 64)           3324016     ['item_id[0][0]']                </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> dot_similarity (Dot)           (None, 1)            0           ['reviewer_embedding[0][0]',     </span>
<span class="code-line">                                                                  'item_embedding[0][0]']         </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> tf.math.sigmoid_3 (TFOpLambda)  (None, 1)           0           ['dot_similarity[0][0]']         </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line"> tf.math.multiply_3 (TFOpLambda  (None, 1)           0           ['tf.math.sigmoid_3[0][0]']      </span>
<span class="code-line"> )                                                                                                </span>
<span class="code-line">                                                                                                  </span>
<span class="code-line">==================================================================================================</span>
<span class="code-line">Total params: 3,349,104</span>
<span class="code-line">Trainable params: 3,349,104</span>
<span class="code-line">Non-trainable params: 0</span>
<span class="code-line">__________________________________________________________________________________________________</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">The number of trainable parameters is now <code>3,349,104</code> down from  <code>7,892,864</code>, which is more than 2x less than the number of parameters in the baseline model.</font></p>
<p><font size="4">Let's now set the path where model is saved and set up the logs/callbacks containing the <code>EarlyStopping</code> class that monitors the <code>val_loss</code> and will stop training if it does not improve after 3 <code>epochs</code>, the <code>ModelCheckpoint</code> class that monitors the <code>val_loss</code> saving only the best one with a <code>min</code> loss as well as the <code>TensorBoard</code> class that enables visualizations using the <code>TensorBoard</code>.</font></p>
<p>   <font size="4">Now, the <code>memory_efficient_model</code> can be trained by calling <code>fit</code> utilizing the train dataset for 30 <code>epochs</code>using a <code>batch_size=102</code> and the specified callbacks from the <code>callbacks_list</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">filepath</span> <span class="o">=</span> <span class="s1">'baselineFiltered_weights_only_b1024_memOpt.h5'</span></span>
<span class="code-line"><span class="n">checkpoint_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">tensorboard_callback</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">TensorBoard</span><span class="p">(</span><span class="n">log_folder</span><span class="p">,</span></span>
<span class="code-line">                                                      <span class="n">histogram_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">callbacks_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">'val_loss'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">'val_loss'</span><span class="p">,</span></span>
<span class="code-line">                                  <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'min'</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">tensorboard_callback</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">history</span> <span class="o">=</span> <span class="n">run_experiment</span><span class="p">(</span><span class="n">memory_efficient_model</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Epoch 1/30</span>
<span class="code-line">870/870 [==============================] - 139s 155ms/step - loss: 3.9922 - mae: 1.8427 - val_loss: 3.8602 - val_mae: 1.8107</span>
<span class="code-line">Epoch 2/30</span>
<span class="code-line">870/870 [==============================] - 129s 148ms/step - loss: 2.9061 - mae: 1.5446 - val_loss: 1.7800 - val_mae: 1.1903</span>
<span class="code-line">Epoch 3/30</span>
<span class="code-line">870/870 [==============================] - 127s 147ms/step - loss: 1.4770 - mae: 1.0167 - val_loss: 1.3738 - val_mae: 0.9444</span>
<span class="code-line">Epoch 4/30</span>
<span class="code-line">870/870 [==============================] - 125s 143ms/step - loss: 1.2883 - mae: 0.9073 - val_loss: 1.3152 - val_mae: 0.9091</span>
<span class="code-line">Epoch 5/30</span>
<span class="code-line">870/870 [==============================] - 133s 153ms/step - loss: 1.2071 - mae: 0.8670 - val_loss: 1.2915 - val_mae: 0.8895</span>
<span class="code-line">Epoch 6/30</span>
<span class="code-line">870/870 [==============================] - 132s 152ms/step - loss: 1.1569 - mae: 0.8380 - val_loss: 1.2851 - val_mae: 0.8772</span>
<span class="code-line">Epoch 7/30</span>
<span class="code-line">870/870 [==============================] - 133s 152ms/step - loss: 1.1255 - mae: 0.8177 - val_loss: 1.2823 - val_mae: 0.8693</span>
<span class="code-line">Epoch 8/30</span>
<span class="code-line">870/870 [==============================] - 133s 152ms/step - loss: 1.1033 - mae: 0.8035 - val_loss: 1.2786 - val_mae: 0.8639</span>
<span class="code-line">Epoch 9/30</span>
<span class="code-line">870/870 [==============================] - 127s 145ms/step - loss: 1.0853 - mae: 0.7932 - val_loss: 1.2739 - val_mae: 0.8594</span>
<span class="code-line">Epoch 10/30</span>
<span class="code-line">870/870 [==============================] - 132s 152ms/step - loss: 1.0701 - mae: 0.7851 - val_loss: 1.2676 - val_mae: 0.8560</span>
<span class="code-line">Epoch 11/30</span>
<span class="code-line">870/870 [==============================] - 134s 154ms/step - loss: 1.0565 - mae: 0.7787 - val_loss: 1.2610 - val_mae: 0.8531</span>
<span class="code-line">Epoch 12/30</span>
<span class="code-line">870/870 [==============================] - 133s 153ms/step - loss: 1.0443 - mae: 0.7733 - val_loss: 1.2533 - val_mae: 0.8503</span>
<span class="code-line">Epoch 13/30</span>
<span class="code-line">870/870 [==============================] - 130s 150ms/step - loss: 1.0330 - mae: 0.7683 - val_loss: 1.2458 - val_mae: 0.8477</span>
<span class="code-line">Epoch 14/30</span>
<span class="code-line">870/870 [==============================] - 130s 149ms/step - loss: 1.0226 - mae: 0.7638 - val_loss: 1.2382 - val_mae: 0.8450</span>
<span class="code-line">Epoch 15/30</span>
<span class="code-line">870/870 [==============================] - 130s 150ms/step - loss: 1.0129 - mae: 0.7596 - val_loss: 1.2308 - val_mae: 0.8424</span>
<span class="code-line">Epoch 16/30</span>
<span class="code-line">870/870 [==============================] - 132s 152ms/step - loss: 1.0041 - mae: 0.7556 - val_loss: 1.2241 - val_mae: 0.8398</span>
<span class="code-line">Epoch 17/30</span>
<span class="code-line">870/870 [==============================] - 139s 160ms/step - loss: 0.9960 - mae: 0.7518 - val_loss: 1.2172 - val_mae: 0.8369</span>
<span class="code-line">Epoch 18/30</span>
<span class="code-line">870/870 [==============================] - 134s 154ms/step - loss: 0.9886 - mae: 0.7482 - val_loss: 1.2112 - val_mae: 0.8343</span>
<span class="code-line">Epoch 19/30</span>
<span class="code-line">870/870 [==============================] - 128s 147ms/step - loss: 0.9818 - mae: 0.7446 - val_loss: 1.2054 - val_mae: 0.8318</span>
<span class="code-line">Epoch 20/30</span>
<span class="code-line">870/870 [==============================] - 132s 152ms/step - loss: 0.9757 - mae: 0.7414 - val_loss: 1.2001 - val_mae: 0.8291</span>
<span class="code-line">Epoch 21/30</span>
<span class="code-line">870/870 [==============================] - 132s 152ms/step - loss: 0.9700 - mae: 0.7384 - val_loss: 1.1952 - val_mae: 0.8268</span>
<span class="code-line">Epoch 22/30</span>
<span class="code-line">870/870 [==============================] - 123s 141ms/step - loss: 0.9648 - mae: 0.7356 - val_loss: 1.1906 - val_mae: 0.8248</span>
<span class="code-line">Epoch 23/30</span>
<span class="code-line">870/870 [==============================] - 123s 142ms/step - loss: 0.9601 - mae: 0.7331 - val_loss: 1.1866 - val_mae: 0.8230</span>
<span class="code-line">Epoch 24/30</span>
<span class="code-line">870/870 [==============================] - 123s 141ms/step - loss: 0.9557 - mae: 0.7307 - val_loss: 1.1826 - val_mae: 0.8213</span>
<span class="code-line">Epoch 25/30</span>
<span class="code-line">870/870 [==============================] - 122s 140ms/step - loss: 0.9516 - mae: 0.7286 - val_loss: 1.1793 - val_mae: 0.8197</span>
<span class="code-line">Epoch 26/30</span>
<span class="code-line">870/870 [==============================] - 121s 139ms/step - loss: 0.9478 - mae: 0.7265 - val_loss: 1.1759 - val_mae: 0.8180</span>
<span class="code-line">Epoch 27/30</span>
<span class="code-line">870/870 [==============================] - 121s 139ms/step - loss: 0.9443 - mae: 0.7247 - val_loss: 1.1729 - val_mae: 0.8165</span>
<span class="code-line">Epoch 28/30</span>
<span class="code-line">870/870 [==============================] - 120s 138ms/step - loss: 0.9409 - mae: 0.7228 - val_loss: 1.1702 - val_mae: 0.8154</span>
<span class="code-line">Epoch 29/30</span>
<span class="code-line">870/870 [==============================] - 119s 137ms/step - loss: 0.9376 - mae: 0.7210 - val_loss: 1.1675 - val_mae: 0.8141</span>
<span class="code-line">Epoch 30/30</span>
<span class="code-line">870/870 [==============================] - 121s 139ms/step - loss: 0.9345 - mae: 0.7193 - val_loss: 1.1650 - val_mae: 0.8126</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can save the model and plot the <code>loss</code>, <code>val_loss</code>,  <code>mae</code> and<code>val_mae</code> over the training epochs.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">memory_efficient_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'./memoryEfficient_weights_only_b1024_tf.h5'</span><span class="p">,</span></span>
<span class="code-line">                            <span class="n">save_format</span><span class="o">=</span><span class="s1">'tf'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'loss'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'val_loss'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Model Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epoch'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">'Train'</span><span class="p">,</span> <span class="s1">'Eval'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,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
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'mae'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'val_mae'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Model Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epoch'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">'Train'</span><span class="p">,</span> <span class="s1">'Eval'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,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
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's now load the test set and the model so we can <code>evaluate</code> the trained model for  <code>mae</code> using the test set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">get_dataset_from_csv</span><span class="p">(</span><span class="s1">'eval_filtered.csv'</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span></span>
<span class="code-line">                                    <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s1">'./memoryEfficient_weights_only_b1024_tf.h5'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">eval_dataset</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">Evaluation on the test set:'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">display</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line"></span>
<span class="code-line">Evaluation on the test set:</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_text output_subarea">
<pre><span class="code-line">{'loss': 1.359154462814331, 'mae': 0.9445576071739197}</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Ranking-System-in-Tensorflow"><code>Ranking System in Tensorflow</code><a class="anchor-link" href="#Ranking-System-in-Tensorflow">¶</a></h1><p>   <font size="4">We can utilize the previous approach to set up the environment including setting the seed with a <code>init_seeds</code> function for reproducibility.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>tensorflow-recommenders<span class="o">==</span><span class="m">0</span>.7.2</span>
<span class="code-line"><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">tensorflow</span><span class="o">==</span><span class="m">2</span>.9.2</span>
<span class="code-line"><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'CUDA and NVIDIA GPU Information'</span><span class="p">)</span></span>
<span class="code-line"><span class="o">!</span>/usr/local/cuda/bin/nvcc<span class="w"> </span>--version</span>
<span class="code-line"><span class="o">!</span>nvidia-smi</span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'TensorFlow version: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Eager execution is: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">()))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Keras version: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Num GPUs Available: '</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s1">'GPU'</span><span class="p">)))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Requirement already satisfied: tensorflow-recommenders==0.7.2 in /usr/local/lib/python3.10/dist-packages (0.7.2)</span>
<span class="code-line">Requirement already satisfied: tensorflow&gt;=2.9.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow-recommenders==0.7.2) (2.9.2)</span>
<span class="code-line">Requirement already satisfied: absl-py&gt;=0.1.6 in /usr/local/lib/python3.10/dist-packages (from tensorflow-recommenders==0.7.2) (1.4.0)</span>
<span class="code-line">Requirement already satisfied: astunparse&gt;=1.6.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (1.6.3)</span>
<span class="code-line">Requirement already satisfied: flatbuffers&lt;2,&gt;=1.12 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (1.12)</span>
<span class="code-line">Requirement already satisfied: gast&lt;=0.4.0,&gt;=0.2.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (0.4.0)</span>
<span class="code-line">Requirement already satisfied: google-pasta&gt;=0.1.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (0.2.0)</span>
<span class="code-line">Requirement already satisfied: grpcio&lt;2.0,&gt;=1.24.3 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (1.59.0)</span>
<span class="code-line">Requirement already satisfied: h5py&gt;=2.9.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (3.9.0)</span>
<span class="code-line">Requirement already satisfied: keras&lt;2.10.0,&gt;=2.9.0rc0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (2.9.0)</span>
<span class="code-line">Requirement already satisfied: keras-preprocessing&gt;=1.1.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (1.1.2)</span>
<span class="code-line">Requirement already satisfied: libclang&gt;=13.0.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (16.0.6)</span>
<span class="code-line">Requirement already satisfied: numpy&gt;=1.20 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (1.23.5)</span>
<span class="code-line">Requirement already satisfied: opt-einsum&gt;=2.3.2 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (3.3.0)</span>
<span class="code-line">Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (23.2)</span>
<span class="code-line">Requirement already satisfied: protobuf&lt;3.20,&gt;=3.9.2 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (3.19.6)</span>
<span class="code-line">Requirement already satisfied: setuptools in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (67.7.2)</span>
<span class="code-line">Requirement already satisfied: six&gt;=1.12.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (1.16.0)</span>
<span class="code-line">Requirement already satisfied: tensorboard&lt;2.10,&gt;=2.9 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (2.9.1)</span>
<span class="code-line">Requirement already satisfied: tensorflow-io-gcs-filesystem&gt;=0.23.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (0.34.0)</span>
<span class="code-line">Requirement already satisfied: tensorflow-estimator&lt;2.10.0,&gt;=2.9.0rc0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (2.9.0)</span>
<span class="code-line">Requirement already satisfied: termcolor&gt;=1.1.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (2.3.0)</span>
<span class="code-line">Requirement already satisfied: typing-extensions&gt;=3.6.6 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (4.5.0)</span>
<span class="code-line">Requirement already satisfied: wrapt&gt;=1.11.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (1.15.0)</span>
<span class="code-line">Requirement already satisfied: wheel&lt;1.0,&gt;=0.23.0 in /usr/local/lib/python3.10/dist-packages (from astunparse&gt;=1.6.0-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (0.41.2)</span>
<span class="code-line">Requirement already satisfied: google-auth&lt;3,&gt;=1.6.3 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (2.17.3)</span>
<span class="code-line">Requirement already satisfied: google-auth-oauthlib&lt;0.5,&gt;=0.4.1 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (0.4.6)</span>
<span class="code-line">Requirement already satisfied: markdown&gt;=2.6.8 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (3.5)</span>
<span class="code-line">Requirement already satisfied: requests&lt;3,&gt;=2.21.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (2.31.0)</span>
<span class="code-line">Requirement already satisfied: tensorboard-data-server&lt;0.7.0,&gt;=0.6.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (0.6.1)</span>
<span class="code-line">Requirement already satisfied: tensorboard-plugin-wit&gt;=1.6.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (1.8.1)</span>
<span class="code-line">Requirement already satisfied: werkzeug&gt;=1.0.1 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (3.0.0)</span>
<span class="code-line">Requirement already satisfied: cachetools&lt;6.0,&gt;=2.0.0 in /usr/local/lib/python3.10/dist-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (5.3.1)</span>
<span class="code-line">Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in /usr/local/lib/python3.10/dist-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (0.3.0)</span>
<span class="code-line">Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in /usr/local/lib/python3.10/dist-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (4.9)</span>
<span class="code-line">Requirement already satisfied: requests-oauthlib&gt;=0.7.0 in /usr/local/lib/python3.10/dist-packages (from google-auth-oauthlib&lt;0.5,&gt;=0.4.1-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (1.3.1)</span>
<span class="code-line">Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.10/dist-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (3.3.0)</span>
<span class="code-line">Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.10/dist-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (3.4)</span>
<span class="code-line">Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (2.0.6)</span>
<span class="code-line">Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (2023.7.22)</span>
<span class="code-line">Requirement already satisfied: MarkupSafe&gt;=2.1.1 in /usr/local/lib/python3.10/dist-packages (from werkzeug&gt;=1.0.1-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (2.1.3)</span>
<span class="code-line">Requirement already satisfied: pyasn1&lt;0.6.0,&gt;=0.4.6 in /usr/local/lib/python3.10/dist-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (0.5.0)</span>
<span class="code-line">Requirement already satisfied: oauthlib&gt;=3.0.0 in /usr/local/lib/python3.10/dist-packages (from requests-oauthlib&gt;=0.7.0-&gt;google-auth-oauthlib&lt;0.5,&gt;=0.4.1-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow&gt;=2.9.0-&gt;tensorflow-recommenders==0.7.2) (3.2.2)</span>
<span class="code-line">Requirement already satisfied: tensorflow==2.9.2 in /usr/local/lib/python3.10/dist-packages (2.9.2)</span>
<span class="code-line">Requirement already satisfied: absl-py&gt;=1.0.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (1.4.0)</span>
<span class="code-line">Requirement already satisfied: astunparse&gt;=1.6.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (1.6.3)</span>
<span class="code-line">Requirement already satisfied: flatbuffers&lt;2,&gt;=1.12 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (1.12)</span>
<span class="code-line">Requirement already satisfied: gast&lt;=0.4.0,&gt;=0.2.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (0.4.0)</span>
<span class="code-line">Requirement already satisfied: google-pasta&gt;=0.1.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (0.2.0)</span>
<span class="code-line">Requirement already satisfied: grpcio&lt;2.0,&gt;=1.24.3 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (1.59.0)</span>
<span class="code-line">Requirement already satisfied: h5py&gt;=2.9.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (3.9.0)</span>
<span class="code-line">Requirement already satisfied: keras&lt;2.10.0,&gt;=2.9.0rc0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (2.9.0)</span>
<span class="code-line">Requirement already satisfied: keras-preprocessing&gt;=1.1.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (1.1.2)</span>
<span class="code-line">Requirement already satisfied: libclang&gt;=13.0.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (16.0.6)</span>
<span class="code-line">Requirement already satisfied: numpy&gt;=1.20 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (1.23.5)</span>
<span class="code-line">Requirement already satisfied: opt-einsum&gt;=2.3.2 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (3.3.0)</span>
<span class="code-line">Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (23.2)</span>
<span class="code-line">Requirement already satisfied: protobuf&lt;3.20,&gt;=3.9.2 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (3.19.6)</span>
<span class="code-line">Requirement already satisfied: setuptools in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (67.7.2)</span>
<span class="code-line">Requirement already satisfied: six&gt;=1.12.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (1.16.0)</span>
<span class="code-line">Requirement already satisfied: tensorboard&lt;2.10,&gt;=2.9 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (2.9.1)</span>
<span class="code-line">Requirement already satisfied: tensorflow-io-gcs-filesystem&gt;=0.23.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (0.34.0)</span>
<span class="code-line">Requirement already satisfied: tensorflow-estimator&lt;2.10.0,&gt;=2.9.0rc0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (2.9.0)</span>
<span class="code-line">Requirement already satisfied: termcolor&gt;=1.1.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (2.3.0)</span>
<span class="code-line">Requirement already satisfied: typing-extensions&gt;=3.6.6 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (4.5.0)</span>
<span class="code-line">Requirement already satisfied: wrapt&gt;=1.11.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow==2.9.2) (1.15.0)</span>
<span class="code-line">Requirement already satisfied: wheel&lt;1.0,&gt;=0.23.0 in /usr/local/lib/python3.10/dist-packages (from astunparse&gt;=1.6.0-&gt;tensorflow==2.9.2) (0.41.2)</span>
<span class="code-line">Requirement already satisfied: google-auth&lt;3,&gt;=1.6.3 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (2.17.3)</span>
<span class="code-line">Requirement already satisfied: google-auth-oauthlib&lt;0.5,&gt;=0.4.1 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (0.4.6)</span>
<span class="code-line">Requirement already satisfied: markdown&gt;=2.6.8 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (3.5)</span>
<span class="code-line">Requirement already satisfied: requests&lt;3,&gt;=2.21.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (2.31.0)</span>
<span class="code-line">Requirement already satisfied: tensorboard-data-server&lt;0.7.0,&gt;=0.6.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (0.6.1)</span>
<span class="code-line">Requirement already satisfied: tensorboard-plugin-wit&gt;=1.6.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (1.8.1)</span>
<span class="code-line">Requirement already satisfied: werkzeug&gt;=1.0.1 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (3.0.0)</span>
<span class="code-line">Requirement already satisfied: cachetools&lt;6.0,&gt;=2.0.0 in /usr/local/lib/python3.10/dist-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (5.3.1)</span>
<span class="code-line">Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in /usr/local/lib/python3.10/dist-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (0.3.0)</span>
<span class="code-line">Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in /usr/local/lib/python3.10/dist-packages (from google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (4.9)</span>
<span class="code-line">Requirement already satisfied: requests-oauthlib&gt;=0.7.0 in /usr/local/lib/python3.10/dist-packages (from google-auth-oauthlib&lt;0.5,&gt;=0.4.1-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (1.3.1)</span>
<span class="code-line">Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.10/dist-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (3.3.0)</span>
<span class="code-line">Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.10/dist-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (3.4)</span>
<span class="code-line">Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (2.0.6)</span>
<span class="code-line">Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests&lt;3,&gt;=2.21.0-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (2023.7.22)</span>
<span class="code-line">Requirement already satisfied: MarkupSafe&gt;=2.1.1 in /usr/local/lib/python3.10/dist-packages (from werkzeug&gt;=1.0.1-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (2.1.3)</span>
<span class="code-line">Requirement already satisfied: pyasn1&lt;0.6.0,&gt;=0.4.6 in /usr/local/lib/python3.10/dist-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth&lt;3,&gt;=1.6.3-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (0.5.0)</span>
<span class="code-line">Requirement already satisfied: oauthlib&gt;=3.0.0 in /usr/local/lib/python3.10/dist-packages (from requests-oauthlib&gt;=0.7.0-&gt;google-auth-oauthlib&lt;0.5,&gt;=0.4.1-&gt;tensorboard&lt;2.10,&gt;=2.9-&gt;tensorflow==2.9.2) (3.2.2)</span>
<span class="code-line">CUDA and NVIDIA GPU Information</span>
<span class="code-line">nvcc: NVIDIA (R) Cuda compiler driver</span>
<span class="code-line">Copyright (c) 2005-2022 NVIDIA Corporation</span>
<span class="code-line">Built on Wed_Sep_21_10:33:58_PDT_2022</span>
<span class="code-line">Cuda compilation tools, release 11.8, V11.8.89</span>
<span class="code-line">Build cuda_11.8.r11.8/compiler.31833905_0</span>
<span class="code-line">Sun Oct 15 22:05:18 2023       </span>
<span class="code-line">+-----------------------------------------------------------------------------+</span>
<span class="code-line">| NVIDIA-SMI 525.105.17   Driver Version: 525.105.17   CUDA Version: 12.0     |</span>
<span class="code-line">|-------------------------------+----------------------+----------------------+</span>
<span class="code-line">| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |</span>
<span class="code-line">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |</span>
<span class="code-line">|                               |                      |               MIG M. |</span>
<span class="code-line">|===============================+======================+======================|</span>
<span class="code-line">|   0  Tesla T4            Off  | 00000000:00:04.0 Off |                    0 |</span>
<span class="code-line">| N/A   41C    P8     9W /  70W |      3MiB / 15360MiB |      0%      Default |</span>
<span class="code-line">|                               |                      |                  N/A |</span>
<span class="code-line">+-------------------------------+----------------------+----------------------+</span>
<span class="code-line">                                                                               </span>
<span class="code-line">+-----------------------------------------------------------------------------+</span>
<span class="code-line">| Processes:                                                                  |</span>
<span class="code-line">|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |</span>
<span class="code-line">|        ID   ID                                                   Usage      |</span>
<span class="code-line">|=============================================================================|</span>
<span class="code-line">|  No running processes found                                                 |</span>
<span class="code-line">+-----------------------------------------------------------------------------+</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">TensorFlow version: 2.9.2</span>
<span class="code-line">Eager execution is: True</span>
<span class="code-line">Keras version: 2.9.0</span>
<span class="code-line">Num GPUs Available:  1</span>
<span class="code-line"></span>
<span class="code-line"></span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's now load the <code>pandas.Dataframe</code> as a dictionary to a<code>tensorflow.data.Dataset</code> and map the variables with a <code>lambda function</code>. Then we can prepare the train/test sets by shuffling and sampling. Then we can generate a vocabulary that maps the features to the embedding vector in the model, determine the unique <code>items</code> and <code>reviewer_ids</code> for the vocabulary and set the dimensions for the embeddings.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">shuffle</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">ratings</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">df</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="s1">'item'</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'item'</span><span class="p">],</span></span>
<span class="code-line">                                 <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'reviewerID'</span><span class="p">],</span></span>
<span class="code-line">                                 <span class="s1">'rating'</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">]})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">shuffled</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">reshuffle_each_iteration</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">train</span> <span class="o">=</span> <span class="n">shuffled</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">500_000</span><span class="p">)</span></span>
<span class="code-line"><span class="n">test</span> <span class="o">=</span> <span class="n">shuffled</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">500_000</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">items</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">3_000_000</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'item'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">reviewer_ids</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">3_000_000</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">unique_items</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)))</span></span>
<span class="code-line"><span class="n">unique_reviewer_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">reviewer_ids</span><span class="p">)))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">embedding_dimension</span> <span class="o">=</span> <span class="mi">64</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model-Architecture-and-Metrics"><code>Model Architecture and Metrics</code><a class="anchor-link" href="#Model-Architecture-and-Metrics">¶</a></h2><p>   <font size="4">We can use a class <code>RankingModel</code> to set up the ranking model containing embeddings for the reviewers and items using the created vocabulary for each. Then the model can be defined with multiple stacked <code>Dense</code> layers containing <code>activation='relu'</code> with decreasing number of nodes.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">class</span> <span class="nc">RankingModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line">  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="w">    </span><span class="sd">"""</span></span>
<span class="code-line"><span class="sd">    Initialize the model by setting up the layers.</span></span>
<span class="code-line"><span class="sd">    """</span></span>
<span class="code-line">    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="bp">self</span><span class="o">.</span><span class="n">reviewer_embeddings</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span></span>
<span class="code-line">        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span><span class="n">vocabulary</span><span class="o">=</span><span class="n">unique_reviewer_ids</span><span class="p">,</span></span>
<span class="code-line">                                     <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span></span>
<span class="code-line">        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_reviewer_ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span></span>
<span class="code-line">                                  <span class="n">embedding_dimension</span><span class="p">)])</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="bp">self</span><span class="o">.</span><span class="n">item_embeddings</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span></span>
<span class="code-line">        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span><span class="n">vocabulary</span><span class="o">=</span><span class="n">unique_items</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span></span>
<span class="code-line">        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_items</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">embedding_dimension</span><span class="p">)])</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="bp">self</span><span class="o">.</span><span class="n">ratings</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span></span>
<span class="code-line">        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span></span>
<span class="code-line">        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span></span>
<span class="code-line">        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span></span>
<span class="code-line"></span>
<span class="code-line">  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span></span>
<span class="code-line">      <span class="n">reviewer_id</span><span class="p">,</span> <span class="n">item</span> <span class="o">=</span> <span class="n">inputs</span></span>
<span class="code-line">      <span class="n">reviewer_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reviewer_embeddings</span><span class="p">(</span><span class="n">reviewer_id</span><span class="p">)</span></span>
<span class="code-line">      <span class="n">item_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_embeddings</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratings</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">reviewer_embedding</span><span class="p">,</span> <span class="n">item_embedding</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><font size="4">Let's now examine a sample:</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">RankingModel</span><span class="p">()(([</span><span class="s1">'31'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'2726956'</span><span class="p">]))</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="code-line">WARNING:tensorflow:Layers in a Sequential model should only have a single input tensor. Received: inputs=['31']. Consider rewriting this model with the Functional API.</span>
<span class="code-line">WARNING:tensorflow:Layers in a Sequential model should only have a single input tensor. Received: inputs=['2726956']. Consider rewriting this model with the Functional API.</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">&lt;tf.Tensor: shape=(1, 1), dtype=float32, numpy=array([[0.00874423]], dtype=float32)&gt;</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Next, we can define the <code>loss</code> and<code>metrics</code> using<code>tensorflow_recommenders</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">tensorflow_recommenders</span> <span class="k">as</span> <span class="nn">tfrs</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">task</span> <span class="o">=</span> <span class="n">tfrs</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">Ranking</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span></span>
<span class="code-line">                          <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">RootMeanSquaredError</span><span class="p">()])</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can now define the complete model by generating another class <code>AmazonReviewsMode</code> where the <code>rankingModel()</code> is added in the<code>__init__</code> method, and the <code>compute_loss</code> method calculates a loss given the feautres as input. The base model creates the training loop. The function <code>compute_loss</code> computes the loss and the metrics for the model.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">pprint</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Text</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">class</span> <span class="nc">AmazonReviewsModel</span><span class="p">(</span><span class="n">tfrs</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span></span>
<span class="code-line"></span>
<span class="code-line">  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></span>
<span class="code-line">    <span class="bp">self</span><span class="o">.</span><span class="n">ranking_model</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span> <span class="o">=</span> <span class="n">RankingModel</span><span class="p">()</span></span>
<span class="code-line">    <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span> <span class="o">=</span> <span class="n">tfrs</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">Ranking</span><span class="p">(</span></span>
<span class="code-line">        <span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span></span>
<span class="code-line">        <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">RootMeanSquaredError</span><span class="p">()])</span></span>
<span class="code-line"></span>
<span class="code-line">  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span></span>
<span class="code-line">      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranking_model</span><span class="p">((</span><span class="n">features</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">],</span> <span class="n">features</span><span class="p">[</span><span class="s1">'item'</span><span class="p">]))</span></span>
<span class="code-line"></span>
<span class="code-line">  <span class="k">def</span> <span class="nf">compute_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span></span>
<span class="code-line">      <span class="n">labels</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'rating'</span><span class="p">)</span></span>
<span class="code-line">      <span class="n">rating_predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">features</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="o">=</span><span class="n">rating_predictions</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now, we can initiate the model and prepare the train/test sets.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">AmazonReviewsModel</span><span class="p">()</span></span>
<span class="code-line"><span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adagrad</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">cached_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">)</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span></span>
<span class="code-line"><span class="n">cached_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fit,-Evaluate-and-Save-Mode"><code>Fit, Evaluate and Save Mode</code><a class="anchor-link" href="#Fit,-Evaluate-and-Save-Mode">¶</a></h2><p>   <font size="4">Let's now set the path where model is saved and set up the logs/callbacks containing the <code>EarlyStopping</code> class that monitors the <code>root_mean_squared_error</code> and will stop training if it does not improve after 3 <code>epochs</code>, the <code>ModelCheckpoint</code> class that monitors the <code>root_mean_squared_error</code> saving only the best one with a <code>min</code> loss as well as the <code>TensorBoard</code> class that enables visualizations using the <code>TensorBoard</code>.</font></p>
<p>   <font size="4">Now the model can be trained by calling <code>fit</code> utilizing the <code>cached_train</code> dataset for 20 <code>epochs</code>, which is the iterations over the entire <code>cached_train</code>, using a <code>batch_size=1</code>, which is the number of samples per gradient update, and the specified callbacks from the <code>callbacks_list</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">datetime</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span><span class="p">,</span> <span class="n">ModelCheckpoint</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="o">!</span>rm<span class="w"> </span>-rf<span class="w"> </span>/logs/</span>
<span class="code-line"></span>
<span class="code-line"><span class="o">%</span><span class="k">load_ext</span> tensorboard</span>
<span class="code-line"></span>
<span class="code-line"><span class="n">log_folder</span> <span class="o">=</span> <span class="s1">'logs/fit/'</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y%m</span><span class="si">%d</span><span class="s1">-%H%M%S'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">filepath</span> <span class="o">=</span> <span class="s1">'rankingBaseline_MoviesTV_weights_only.h5'</span></span>
<span class="code-line"><span class="n">checkpoint_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">tensorboard_callback</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">TensorBoard</span><span class="p">(</span><span class="n">log_folder</span><span class="p">,</span></span>
<span class="code-line">                                                      <span class="n">histogram_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">callbacks_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">'root_mean_squared_error'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">'root_mean_squared_error'</span><span class="p">,</span></span>
<span class="code-line">                                  <span class="n">save_weights_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'min'</span><span class="p">),</span></span>
<span class="code-line">                  <span class="n">tensorboard_callback</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cached_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks_list</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Epoch 1/20</span>
<span class="code-line">500000/500000 [==============================] - 1359s 3ms/step - root_mean_squared_error: 0.8855 - loss: 0.7844 - regularization_loss: 0.0000e+00 - total_loss: 0.7844</span>
<span class="code-line">Epoch 2/20</span>
<span class="code-line">500000/500000 [==============================] - 1350s 3ms/step - root_mean_squared_error: 0.8323 - loss: 0.6929 - regularization_loss: 0.0000e+00 - total_loss: 0.6929</span>
<span class="code-line">Epoch 3/20</span>
<span class="code-line">500000/500000 [==============================] - 1351s 3ms/step - root_mean_squared_error: 0.7777 - loss: 0.6051 - regularization_loss: 0.0000e+00 - total_loss: 0.6051</span>
<span class="code-line">Epoch 4/20</span>
<span class="code-line">500000/500000 [==============================] - 1346s 3ms/step - root_mean_squared_error: 0.7191 - loss: 0.5173 - regularization_loss: 0.0000e+00 - total_loss: 0.5173</span>
<span class="code-line">Epoch 5/20</span>
<span class="code-line">500000/500000 [==============================] - 1344s 3ms/step - root_mean_squared_error: 0.6644 - loss: 0.4416 - regularization_loss: 0.0000e+00 - total_loss: 0.4416</span>
<span class="code-line">Epoch 6/20</span>
<span class="code-line">500000/500000 [==============================] - 1345s 3ms/step - root_mean_squared_error: 0.6109 - loss: 0.3734 - regularization_loss: 0.0000e+00 - total_loss: 0.3734</span>
<span class="code-line">Epoch 7/20</span>
<span class="code-line">500000/500000 [==============================] - 1345s 3ms/step - root_mean_squared_error: 0.5578 - loss: 0.3113 - regularization_loss: 0.0000e+00 - total_loss: 0.3113</span>
<span class="code-line">Epoch 8/20</span>
<span class="code-line">500000/500000 [==============================] - 1342s 3ms/step - root_mean_squared_error: 0.5080 - loss: 0.2582 - regularization_loss: 0.0000e+00 - total_loss: 0.2582</span>
<span class="code-line">Epoch 9/20</span>
<span class="code-line">500000/500000 [==============================] - 1352s 3ms/step - root_mean_squared_error: 0.4633 - loss: 0.2147 - regularization_loss: 0.0000e+00 - total_loss: 0.2147</span>
<span class="code-line">Epoch 10/20</span>
<span class="code-line">500000/500000 [==============================] - 1363s 3ms/step - root_mean_squared_error: 0.4246 - loss: 0.1804 - regularization_loss: 0.0000e+00 - total_loss: 0.1804</span>
<span class="code-line">Epoch 11/20</span>
<span class="code-line">500000/500000 [==============================] - 1347s 3ms/step - root_mean_squared_error: 0.3915 - loss: 0.1533 - regularization_loss: 0.0000e+00 - total_loss: 0.1533</span>
<span class="code-line">Epoch 12/20</span>
<span class="code-line">500000/500000 [==============================] - 1352s 3ms/step - root_mean_squared_error: 0.3629 - loss: 0.1318 - regularization_loss: 0.0000e+00 - total_loss: 0.1318</span>
<span class="code-line">Epoch 13/20</span>
<span class="code-line">500000/500000 [==============================] - 1347s 3ms/step - root_mean_squared_error: 0.3384 - loss: 0.1145 - regularization_loss: 0.0000e+00 - total_loss: 0.1145</span>
<span class="code-line">Epoch 14/20</span>
<span class="code-line">500000/500000 [==============================] - 1352s 3ms/step - root_mean_squared_error: 0.3171 - loss: 0.1006 - regularization_loss: 0.0000e+00 - total_loss: 0.1006</span>
<span class="code-line">Epoch 15/20</span>
<span class="code-line">500000/500000 [==============================] - 1367s 3ms/step - root_mean_squared_error: 0.2982 - loss: 0.0889 - regularization_loss: 0.0000e+00 - total_loss: 0.0889</span>
<span class="code-line">Epoch 16/20</span>
<span class="code-line">500000/500000 [==============================] - 1364s 3ms/step - root_mean_squared_error: 0.2819 - loss: 0.0795 - regularization_loss: 0.0000e+00 - total_loss: 0.0795</span>
<span class="code-line">Epoch 17/20</span>
<span class="code-line">500000/500000 [==============================] - 1357s 3ms/step - root_mean_squared_error: 0.2675 - loss: 0.0716 - regularization_loss: 0.0000e+00 - total_loss: 0.0716</span>
<span class="code-line">Epoch 18/20</span>
<span class="code-line">500000/500000 [==============================] - 1359s 3ms/step - root_mean_squared_error: 0.2548 - loss: 0.0649 - regularization_loss: 0.0000e+00 - total_loss: 0.0649</span>
<span class="code-line">Epoch 19/20</span>
<span class="code-line">500000/500000 [==============================] - 1356s 3ms/step - root_mean_squared_error: 0.2433 - loss: 0.0592 - regularization_loss: 0.0000e+00 - total_loss: 0.0592</span>
<span class="code-line">Epoch 20/20</span>
<span class="code-line">500000/500000 [==============================] - 1358s 3ms/step - root_mean_squared_error: 0.2330 - loss: 0.0543 - regularization_loss: 0.0000e+00 - total_loss: 0.0543</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now, let's save the model if we need to reload it in the future and <code>evaluate</code> on the test set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">'rankingBaseline_MoviesTV_20epochs'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="code-line">WARNING:absl:Found untraced functions such as ranking_10_layer_call_fn, ranking_10_layer_call_and_return_conditional_losses while saving (showing 2 of 2). These functions will not be directly callable after loading.</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">cached_test</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">100000/100000 [==============================] - 197s 2ms/step - root_mean_squared_error: 1.2426 - loss: 1.5440 - regularization_loss: 0.0000e+00 - total_loss: 1.5440</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">{'root_mean_squared_error': 1.2425607442855835,</span>
<span class="code-line"> 'loss': 0.1961183398962021,</span>
<span class="code-line"> 'regularization_loss': 0,</span>
<span class="code-line"> 'total_loss': 0.1961183398962021}</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can examine metrics from the model and plot the model <code>loss</code> over the training epochs.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">'loss'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Model Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Loss'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epoch'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">'Train'</span><span class="p">,</span> <span class="s1">'Eval'</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_png output_subarea">
<img class="img-fluid" src="data:image/png;base64,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
"/>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's now load the trained model and <code>evaluate</code> using the cached test set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">loaded</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">saved_model</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">'rankingBaseline_MoviesTV_20epochs'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">loaded</span><span class="p">({</span><span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'AV6QDP8Q0ONK4'</span><span class="p">]),</span></span>
<span class="code-line">        <span class="s1">'item'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'B009934S5M'</span><span class="p">]})</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">array([[4.7614393]], dtype=float32)</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">cached_test</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">100000/100000 [==============================] - 204s 2ms/step - root_mean_squared_error: 1.2426 - loss: 1.5440 - regularization_loss: 0.0000e+00 - total_loss: 1.5440</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">{'root_mean_squared_error': 1.2425607442855835,</span>
<span class="code-line"> 'loss': 0.1961183398962021,</span>
<span class="code-line"> 'regularization_loss': 0,</span>
<span class="code-line"> 'total_loss': 0.1961183398962021}</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Predictions"><code>Predictions</code><a class="anchor-link" href="#Predictions">¶</a></h2><p>   <font size="4">We can test out the <code>Ranking Model</code> by computing predictions for a subset of the items and rank them based on the predictions.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="AV6QDP8Q0ONK4"><code>AV6QDP8Q0ONK4</code><a class="anchor-link" href="#AV6QDP8Q0ONK4">¶</a></h4><p>   <font size="4">This reviewer had 3981 ratings in the filtered set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">test_ratings</span> <span class="o">=</span> <span class="p">{}</span></span>
<span class="code-line"><span class="n">test_item</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B009934S5M'</span><span class="p">,</span><span class="s1">'B00PY4Q9OS'</span><span class="p">,</span> <span class="s1">'B00R8GUXPG'</span><span class="p">,</span><span class="s1">'B00Q0G2VXM'</span><span class="p">,</span><span class="s1">'B00NYC65M8'</span><span class="p">]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_item</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">test_ratings</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">({</span></span>
<span class="code-line">        <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'AV6QDP8Q0ONK4'</span><span class="p">]),</span></span>
<span class="code-line">        <span class="s1">'item'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">])})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Ratings:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">test_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Ratings:</span>
<span class="code-line">B00NYC65M8: [[5.2519903]]</span>
<span class="code-line">B00R8GUXPG: [[4.836647]]</span>
<span class="code-line">B009934S5M: [[4.7614393]]</span>
<span class="code-line">B00PY4Q9OS: [[4.7345595]]</span>
<span class="code-line">B00Q0G2VXM: [[4.623266]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="ABO2ZI2Y5DQ9T"><code>ABO2ZI2Y5DQ9T</code><a class="anchor-link" href="#ABO2ZI2Y5DQ9T">¶</a></h4><p>   <font size="4">This reviewer had 2068 ratings in the filtered set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">test_ratings</span> <span class="o">=</span> <span class="p">{}</span></span>
<span class="code-line"><span class="n">test_item</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B009934S5M'</span><span class="p">,</span><span class="s1">'B00PY4Q9OS'</span><span class="p">,</span> <span class="s1">'B00R8GUXPG'</span><span class="p">,</span><span class="s1">'B00Q0G2VXM'</span><span class="p">,</span><span class="s1">'B00NYC65M8'</span><span class="p">]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_item</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">test_ratings</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">({</span></span>
<span class="code-line">       <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'ABO2ZI2Y5DQ9T'</span><span class="p">]),</span></span>
<span class="code-line">       <span class="s1">'item'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">])})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Ratings:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">test_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Ratings:</span>
<span class="code-line">B00R8GUXPG: [[4.1731825]]</span>
<span class="code-line">B00PY4Q9OS: [[3.9811945]]</span>
<span class="code-line">B009934S5M: [[3.6320379]]</span>
<span class="code-line">B00NYC65M8: [[3.6279793]]</span>
<span class="code-line">B00Q0G2VXM: [[3.5430803]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">test_ratings</span> <span class="o">=</span> <span class="p">{}</span></span>
<span class="code-line"><span class="n">test_item</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B00KHW4XHM'</span><span class="p">,</span> <span class="s1">'B01F6EHOIK'</span><span class="p">,</span> <span class="s1">'B00199PP6U'</span><span class="p">,</span> <span class="s1">'B00009IAXL'</span><span class="p">]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_item</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">test_ratings</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">({</span></span>
<span class="code-line">        <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'ABO2ZI2Y5DQ9T'</span><span class="p">]),</span></span>
<span class="code-line">        <span class="s1">'item'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">])})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Ratings:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">test_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Ratings:</span>
<span class="code-line">B00KHW4XHM: [[4.799788]]</span>
<span class="code-line">B00199PP6U: [[4.7554584]]</span>
<span class="code-line">B00009IAXL: [[3.4191265]]</span>
<span class="code-line">B01F6EHOIK: [[1.9375358]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">test_ratings</span> <span class="o">=</span> <span class="p">{}</span></span>
<span class="code-line"><span class="n">test_item</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B0006FFRKM'</span><span class="p">,</span> <span class="s1">'6304492952'</span><span class="p">,</span> <span class="s1">'B009934S5M'</span><span class="p">,</span> <span class="s1">'B000HT3QBY'</span><span class="p">]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_item</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">test_ratings</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">({</span></span>
<span class="code-line">        <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'ABO2ZI2Y5DQ9T'</span><span class="p">]),</span></span>
<span class="code-line">        <span class="s1">'item'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">])})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Ratings:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">test_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Ratings:</span>
<span class="code-line">B0006FFRKM: [[5.2371516]]</span>
<span class="code-line">B009934S5M: [[3.6320379]]</span>
<span class="code-line">B000HT3QBY: [[3.4291909]]</span>
<span class="code-line">6304492952: [[3.126309]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="A328S9RN3U5M68"><code>A328S9RN3U5M68</code><a class="anchor-link" href="#A328S9RN3U5M68">¶</a></h4><p>   <font size="4">This reviewer had 1997  ratings in the filtered set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">test_ratings</span> <span class="o">=</span> <span class="p">{}</span></span>
<span class="code-line"><span class="n">test_item</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B009934S5M'</span><span class="p">,</span><span class="s1">'B00PY4Q9OS'</span><span class="p">,</span> <span class="s1">'B00R8GUXPG'</span><span class="p">,</span><span class="s1">'B00Q0G2VXM'</span><span class="p">,</span><span class="s1">'B00NYC65M8'</span><span class="p">]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_item</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">test_ratings</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">({</span></span>
<span class="code-line">        <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'A328S9RN3U5M68'</span><span class="p">]),</span></span>
<span class="code-line">        <span class="s1">'item'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">])})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Ratings:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">test_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Ratings:</span>
<span class="code-line">B00R8GUXPG: [[4.9083266]]</span>
<span class="code-line">B00PY4Q9OS: [[4.6880455]]</span>
<span class="code-line">B009934S5M: [[4.497545]]</span>
<span class="code-line">B00Q0G2VXM: [[4.416779]]</span>
<span class="code-line">B00NYC65M8: [[3.2599416]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">test_ratings</span> <span class="o">=</span> <span class="p">{}</span></span>
<span class="code-line"><span class="n">test_item</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B00KHW4XHM'</span><span class="p">,</span> <span class="s1">'B01F6EHOIK'</span><span class="p">,</span> <span class="s1">'B00199PP6U'</span><span class="p">,</span> <span class="s1">'B00009IAXL'</span><span class="p">]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_item</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">test_ratings</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">({</span></span>
<span class="code-line">        <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'A328S9RN3U5M68'</span><span class="p">]),</span></span>
<span class="code-line">        <span class="s1">'item'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">])})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Ratings:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">test_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Ratings:</span>
<span class="code-line">B00KHW4XHM: [[5.38043]]</span>
<span class="code-line">B00199PP6U: [[5.1638284]]</span>
<span class="code-line">B00009IAXL: [[3.2683938]]</span>
<span class="code-line">B01F6EHOIK: [[3.0241704]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">test_ratings</span> <span class="o">=</span> <span class="p">{}</span></span>
<span class="code-line"><span class="n">test_item</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B0006FFRKM'</span><span class="p">,</span> <span class="s1">'6304492952'</span><span class="p">,</span> <span class="s1">'B009934S5M'</span><span class="p">,</span> <span class="s1">'B000HT3QBY'</span><span class="p">]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_item</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">test_ratings</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">({</span></span>
<span class="code-line">        <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'A328S9RN3U5M68'</span><span class="p">]),</span></span>
<span class="code-line">        <span class="s1">'item'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">])})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Ratings:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">test_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Ratings:</span>
<span class="code-line">B0006FFRKM: [[5.147983]]</span>
<span class="code-line">B009934S5M: [[4.497545]]</span>
<span class="code-line">B000HT3QBY: [[4.3494844]]</span>
<span class="code-line">6304492952: [[3.8749783]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="A3MV1KKHX51FYT"><code>A3MV1KKHX51FYT</code><a class="anchor-link" href="#A3MV1KKHX51FYT">¶</a></h4><p>   <font size="4">This reviewer had 1986 ratings in the filtered set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">test_ratings</span> <span class="o">=</span> <span class="p">{}</span></span>
<span class="code-line"><span class="n">test_item</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B009934S5M'</span><span class="p">,</span><span class="s1">'B00PY4Q9OS'</span><span class="p">,</span> <span class="s1">'B00R8GUXPG'</span><span class="p">,</span><span class="s1">'B00Q0G2VXM'</span><span class="p">,</span><span class="s1">'B00NYC65M8'</span><span class="p">]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_item</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">test_ratings</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">({</span></span>
<span class="code-line">        <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'A3MV1KKHX51FYT'</span><span class="p">]),</span></span>
<span class="code-line">        <span class="s1">'item'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">])})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Ratings:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">test_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Ratings:</span>
<span class="code-line">B009934S5M: [[3.0159693]]</span>
<span class="code-line">B00Q0G2VXM: [[2.8539734]]</span>
<span class="code-line">B00R8GUXPG: [[2.4100082]]</span>
<span class="code-line">B00PY4Q9OS: [[2.2210793]]</span>
<span class="code-line">B00NYC65M8: [[2.1591673]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">test_ratings</span> <span class="o">=</span> <span class="p">{}</span></span>
<span class="code-line"><span class="n">test_item</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B00KHW4XHM'</span><span class="p">,</span> <span class="s1">'B01F6EHOIK'</span><span class="p">,</span> <span class="s1">'B00199PP6U'</span><span class="p">,</span> <span class="s1">'B00009IAXL'</span><span class="p">]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_item</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">test_ratings</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">({</span></span>
<span class="code-line">        <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'A3MV1KKHX51FYT'</span><span class="p">]),</span></span>
<span class="code-line">        <span class="s1">'item'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">])})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Ratings:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">test_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Ratings:</span>
<span class="code-line">B00009IAXL: [[4.1028647]]</span>
<span class="code-line">B00KHW4XHM: [[3.1912699]]</span>
<span class="code-line">B00199PP6U: [[2.5072653]]</span>
<span class="code-line">B01F6EHOIK: [[1.9650021]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">test_ratings</span> <span class="o">=</span> <span class="p">{}</span></span>
<span class="code-line"><span class="n">test_item</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'B0006FFRKM'</span><span class="p">,</span> <span class="s1">'6304492952'</span><span class="p">,</span> <span class="s1">'B009934S5M'</span><span class="p">,</span> <span class="s1">'B000HT3QBY'</span><span class="p">]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test_item</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">test_ratings</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">({</span></span>
<span class="code-line">        <span class="s1">'reviewer_id'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'A3MV1KKHX51FYT'</span><span class="p">]),</span></span>
<span class="code-line">        <span class="s1">'item'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">item</span><span class="p">])})</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Ratings:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">test_ratings</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">score</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Ratings:</span>
<span class="code-line">B000HT3QBY: [[5.27298]]</span>
<span class="code-line">B0006FFRKM: [[3.945326]]</span>
<span class="code-line">B009934S5M: [[3.0159693]]</span>
<span class="code-line">6304492952: [[2.4662666]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can also convert the<code>TensorfloW</code> model to<code>Tensorflow Lite</code> model to run on-device.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">converter</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">lite</span><span class="o">.</span><span class="n">TFLiteConverter</span><span class="o">.</span><span class="n">from_saved_model</span><span class="p">(</span><span class="s1">'rankingBaseline_MoviesTV_20epochs'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">tflite_model</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span></span>
<span class="code-line"><span class="nb">open</span><span class="p">(</span><span class="s1">'converted_model.tflite'</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tflite_model</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">34591500</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's now get the input and output tensors and test the model for a few of the observations in the set.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">interpreter</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">lite</span><span class="o">.</span><span class="n">Interpreter</span><span class="p">(</span><span class="n">model_path</span><span class="o">=</span><span class="s1">'converted_model.tflite'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">interpreter</span><span class="o">.</span><span class="n">allocate_tensors</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">input_details</span> <span class="o">=</span> <span class="n">interpreter</span><span class="o">.</span><span class="n">get_input_details</span><span class="p">()</span></span>
<span class="code-line"><span class="n">output_details</span> <span class="o">=</span> <span class="n">interpreter</span><span class="o">.</span><span class="n">get_output_details</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">if</span> <span class="n">input_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'serving_default_item:0'</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'B009934S5M'</span><span class="p">]))</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'AV6QDP8Q0ONK4'</span><span class="p">]))</span></span>
<span class="code-line"><span class="k">else</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'AV6QDP8Q0ONK4'</span><span class="p">]))</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'B009934S5M'</span><span class="p">]))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">interpreter</span><span class="o">.</span><span class="n">invoke</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">rating</span> <span class="o">=</span> <span class="n">interpreter</span><span class="o">.</span><span class="n">get_tensor</span><span class="p">(</span><span class="n">output_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'index'</span><span class="p">])</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">[[4.7614403]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">if</span> <span class="n">input_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'serving_default_item:0'</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'B00PY4Q9OS'</span><span class="p">]))</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'ABO2ZI2Y5DQ9T'</span><span class="p">]))</span></span>
<span class="code-line"><span class="k">else</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'ABO2ZI2Y5DQ9T'</span><span class="p">]))</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'B00PY4Q9OS'</span><span class="p">]))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">interpreter</span><span class="o">.</span><span class="n">invoke</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">rating</span> <span class="o">=</span> <span class="n">interpreter</span><span class="o">.</span><span class="n">get_tensor</span><span class="p">(</span><span class="n">output_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'index'</span><span class="p">])</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">[[3.9811943]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">if</span> <span class="n">input_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'serving_default_item:0'</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'B00R8GUXPG'</span><span class="p">]))</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'A328S9RN3U5M68'</span><span class="p">]))</span></span>
<span class="code-line"><span class="k">else</span><span class="p">:</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span></span>
<span class="code-line">                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'A328S9RN3U5M68'</span><span class="p">]))</span></span>
<span class="code-line">    <span class="n">interpreter</span><span class="o">.</span><span class="n">set_tensor</span><span class="p">(</span><span class="n">input_details</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">'index'</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'B00R8GUXPG'</span><span class="p">]))</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">interpreter</span><span class="o">.</span><span class="n">invoke</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">rating</span> <span class="o">=</span> <span class="n">interpreter</span><span class="o">.</span><span class="n">get_tensor</span><span class="p">(</span><span class="n">output_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'index'</span><span class="p">])</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">[[4.9083266]]</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Recommendation-Systems-using-Surprise"><code>Recommendation Systems using Surprise</code><a class="anchor-link" href="#Recommendation-Systems-using-Surprise">¶</a></h1><p>   <font size="4">The data is loaded using the <code>Reader</code> class from a<code>pandas.Dataframes</code> prior to modeling. For the initial training of the models using<code>surprise</code>, the default parameters of <code>BaselineOnly</code>, <code>KNNBaseline</code>, <code>KNNBasic</code>, <code>KNNWithMeans</code>, <code>KNNWithZScore</code>, <code>CoClustering</code>,<code>SVD</code>,<code>SVDp</code> (an extension of SVD which taking into account implicit ratings),<code>NMF</code>, were evaluated using the <code>cross_validate</code> method using 3-fold cross validation to determine which algorithm yielded the lowest  <code>RMSE</code> errors.</font></p>
<h2 id="Basic-algorithms"><code>Basic algorithms</code><a class="anchor-link" href="#Basic-algorithms">¶</a></h2><p>-<code>NormalPredictor: NormalPredictor algorithm predicts a random rating based on the distribution of the training set, which is assumed to be normal. This is one of the most basic algorithms that do not do much work</code></p>
<ul>
<li><code>BaselineOnly: BaselineOnly algorithm predicts the baseline estimate for given user and item</code></li>
</ul>
<h2 id="k-NN-algorithms"><code>k-NN algorithms</code><a class="anchor-link" href="#k-NN-algorithms">¶</a></h2><ul>
<li><p><code>KNNBasic: KNNBasic is a basic collaborative filtering algorithm</code></p>
</li>
<li><p><code>KNNWithMeans: KNNWithMeans is basic collaborative filtering algorithm, taking into account the mean ratings of each user</code></p>
</li>
<li><p><code>KNNWithZScore: KNNWithZScore is a basic collaborative filtering algorithm, taking into account the z-score normalization of each user</code></p>
</li>
<li><p><code>KNNBaseline: KNNBaseline is a basic collaborative filtering algorithm taking into account a baseline rating</code></p>
</li>
</ul>
<h2 id="Matrix-Factorization-based-algorithms"><code>Matrix Factorization-based algorithms</code><a class="anchor-link" href="#Matrix-Factorization-based-algorithms">¶</a></h2><p>-<code>SVD: SVD algorithm is equivalent to Probabilistic Matrix Factorization</code></p>
<p>-<code>SVDpp: The SVDpp algorithm is an extension of SVD that takes into account implicit ratings</code></p>
<p>-<code>NMF: NMF is a collaborative filtering algorithm based on Non-negative Matrix Factorization. It is very similar with SVD</code></p>
<ul>
<li><code>Co-clustering: Coclustering is a collaborative filtering algorithm based on co-clustering</code></li>
</ul>
<p>   <font size="4">This revealed that<code>SVDpp</code> generated the lowest  <code>RMSE</code>, but it took the longest to fit the model and test. The default parameters for<code>SVDpp</code> uses 20 epochs for fitting the model, so experimenting with less epochs and other model parameters will reduce the runtime and potentially maintain a low  <code>RMSE</code>. The results from using <code>KNNBaseline</code> demonstrate a close loss with a significantly lower runtime, so hyperparameter tuning might allow this to be a better choice, especially given larger sample sizes. <font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">Reader</span></span>
<span class="code-line"><span class="kn">import</span> <span class="nn">time</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">BaselineOnly</span><span class="p">,</span> <span class="n">KNNBaseline</span><span class="p">,</span> <span class="n">KNNBasic</span><span class="p">,</span> <span class="n">KNNWithMeans</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">KNNWithZScore</span><span class="p">,</span> <span class="n">CoClustering</span><span class="p">,</span> <span class="n">SVD</span><span class="p">,</span> <span class="n">SVDpp</span><span class="p">,</span> <span class="n">NMF</span><span class="p">,</span> <span class="n">NormalPredictor</span></span>
<span class="code-line"><span class="kn">from</span> <span class="nn">surprise.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">rating_scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span></span>
<span class="code-line"><span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rating'</span><span class="p">]],</span> <span class="n">reader</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Time for iterating through different algorithms..'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">search_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></span>
<span class="code-line"><span class="n">benchmark</span> <span class="o">=</span> <span class="p">[]</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="p">[</span><span class="n">BaselineOnly</span><span class="p">(),</span> <span class="n">KNNBaseline</span><span class="p">(),</span> <span class="n">KNNBasic</span><span class="p">(),</span> <span class="n">KNNWithMeans</span><span class="p">(),</span></span>
<span class="code-line">                  <span class="n">KNNWithZScore</span><span class="p">(),</span> <span class="n">CoClustering</span><span class="p">(),</span> <span class="n">SVD</span><span class="p">(),</span> <span class="n">SVDpp</span><span class="p">(),</span> <span class="n">NMF</span><span class="p">(),</span></span>
<span class="code-line">                  <span class="n">NormalPredictor</span><span class="p">()]:</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">algorithm</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'RMSE'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span></span>
<span class="code-line">                             <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="n">tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></span>
<span class="code-line">    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span></span>
<span class="code-line">                               <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">'Algorithm'</span><span class="p">]))</span></span>
<span class="code-line">    <span class="n">benchmark</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Finished iterating through different algorithms:'</span><span class="p">,</span></span>
<span class="code-line"><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">search_time_start</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">surprise_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">benchmark</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Algorithm'</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'test_rmse'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Results from testing different algorithms:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">surprise_results</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">surprise_results</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Time for iterating through different algorithms..</span>
<span class="code-line">Finished iterating through different algorithms: 1877.5992422103882</span>
<span class="code-line">Results from testing different algorithms:</span>
<span class="code-line">                 test_rmse     fit_time  test_time</span>
<span class="code-line">Algorithm                                         </span>
<span class="code-line">SVDpp             0.951981  1449.569379  34.628475</span>
<span class="code-line">SVD               0.956978    56.881580   3.054269</span>
<span class="code-line">BaselineOnly      0.958829     0.541074   2.015631</span>
<span class="code-line">KNNBaseline       0.986208    12.493270  27.932690</span>
<span class="code-line">KNNWithMeans      0.996443    12.406364  24.509705</span>
<span class="code-line">KNNWithZScore     1.002136    13.109460  26.066691</span>
<span class="code-line">CoClustering      1.012724    18.731312   2.226075</span>
<span class="code-line">NMF               1.051432    59.292935   2.782387</span>
<span class="code-line">KNNBasic          1.106805    12.031695  23.257696</span>
<span class="code-line">NormalPredictor   1.505521     0.629097   2.384375</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's read the train/test sets and load them using the <code>reader</code> from<code>surprise</code>.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'train_filtered.csv'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">'|'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">train</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'rating'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'reviewer_id'</span><span class="p">]</span></span>
<span class="code-line"><span class="n">train</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="s1">'(\d+)'</span><span class="p">,</span></span>
<span class="code-line">                                                        <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">train</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="s1">'(\d+)'</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">train</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span class="code-line"><span class="n">train</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'eval_filtered.csv'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">'|'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">test</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'rating'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'reviewer_id'</span><span class="p">]</span></span>
<span class="code-line"><span class="n">test</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="s1">'(\d+)'</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">test</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="s1">'(\d+)'</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"><span class="n">test</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span class="code-line"><span class="n">test</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">'item_id'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">train</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">train</span><span class="p">[[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rating'</span><span class="p">]],</span> <span class="n">reader</span><span class="p">)</span></span>
<span class="code-line"><span class="n">test</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">test</span><span class="p">[[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rating'</span><span class="p">]],</span> <span class="n">reader</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SVDpp-with-Lowest-RMSE"><code>SVDpp with Lowest RMSE</code><a class="anchor-link" href="#SVDpp-with-Lowest-RMSE">¶</a></h3><p>   <font size="4">Then, we can set the path to save the  results, fit the model using 3-fold cross validation with the default parameters for 3 epochs and examine the  <code>RMSE</code> for the train/test sets.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">dump</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Train/predict using SVDpp default parameters for 3 epochs:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Time for iterating through SVDpp default parameters..'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">search_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></span>
<span class="code-line"><span class="n">algo</span> <span class="o">=</span> <span class="n">SVDpp</span><span class="p">(</span><span class="n">n_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed_value</span><span class="p">)</span></span>
<span class="code-line"><span class="n">cv</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'RMSE'</span><span class="p">,</span> <span class="s1">'MAE'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span></span>
<span class="code-line">                    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Finished iterating through SVDpp default parameters:'</span><span class="p">,</span></span>
<span class="code-line">      <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">search_time_start</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Cross validation results:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">' : '</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">predictions</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">test</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'RMSE from fit best parameters on train predict on test:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">))</span></span>
<span class="code-line"><span class="n">dump</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">'./SVDpp_3epochs_DefaultParamModel_file'</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">algo</span><span class="p">)</span></span>
<span class="code-line"><span class="c1">#predictions, algo = dump.load('./SVDpp_3epochs_DefaultParamModel_file')</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Train/predict using SVDpp default parameters for 3 epochs:</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Time for iterating through SVDpp default parameters..</span>
<span class="code-line">Finished iterating through SVDpp default parameters: 259.01811718940735</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Cross validation results:</span>
<span class="code-line">test_rmse  :  [0.99186233 0.99067176 0.98925811]</span>
<span class="code-line">test_mae  :  [0.75639429 0.75586697 0.75391987]</span>
<span class="code-line">fit_time  :  (212.8136830329895, 213.71945691108704, 214.16111540794373)</span>
<span class="code-line">test_time  :  (34.81285309791565, 35.151495695114136, 34.626320362091064)</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">RMSE from fit best parameters on train predict on test:</span>
<span class="code-line">RMSE: 0.9811</span>
<span class="code-line">0.9811266996736911</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Since we removed the orginal <code>item</code> and <code>reviewerID</code> and created a numerical to handle the sparsity issue, let's read the <code>Movies_and_TV_idMatch.csv</code> set so the original features are present.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'Movies_and_TV_idMatch.csv'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Sample observations:'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Sample observations:</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe table-striped table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>item</th>
<th>item_id</th>
<th>reviewerID</th>
<th>reviewer_id</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>0001527665</td>
<td>45044</td>
<td>A2VHSG6TZHU1OB</td>
<td>1406814</td>
</tr>
<tr>
<th>1</th>
<td>0001527665</td>
<td>45044</td>
<td>A23EJWOW1TLENE</td>
<td>3722126</td>
</tr>
<tr>
<th>2</th>
<td>0001527665</td>
<td>45044</td>
<td>A1KM9FNEJ8Q171</td>
<td>842275</td>
</tr>
<tr>
<th>3</th>
<td>0001527665</td>
<td>45044</td>
<td>A38LY2SSHVHRYB</td>
<td>2915259</td>
</tr>
<tr>
<th>4</th>
<td>0001527665</td>
<td>45044</td>
<td>AHTYUW2H1276L</td>
<td>2915260</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">To examine the results from fitting models, let's now define two functions, <code>get_Ir</code>, which determines the number of items rated by a given reviewer, and <code>get_Ri</code>, which determines the number of reviewers that rated a given item, from the model prediction results.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="k">def</span> <span class="nf">get_Ir</span><span class="p">(</span><span class="n">reviewer_id</span><span class="p">):</span></span>
<span class="code-line"><span class="w">    </span><span class="sd">"""</span></span>
<span class="code-line"><span class="sd">    Determine the number of items rated by given reviewer</span></span>
<span class="code-line"><span class="sd">    Args:</span></span>
<span class="code-line"><span class="sd">      reviewerID: the id of the reviewer</span></span>
<span class="code-line"><span class="sd">    Returns:</span></span>
<span class="code-line"><span class="sd">      Number of items rated by the reviewer</span></span>
<span class="code-line"><span class="sd">    """</span></span>
<span class="code-line">    <span class="k">try</span><span class="p">:</span></span>
<span class="code-line">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">ur</span><span class="p">[</span><span class="n">train</span><span class="o">.</span><span class="n">to_inner_uid</span><span class="p">(</span><span class="n">reviewer_id</span><span class="p">)])</span></span>
<span class="code-line">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span></span>
<span class="code-line">        <span class="k">return</span> <span class="mi">0</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">def</span> <span class="nf">get_Ri</span><span class="p">(</span><span class="n">item_id</span><span class="p">):</span></span>
<span class="code-line"><span class="w">    </span><span class="sd">"""</span></span>
<span class="code-line"><span class="sd">    Determine number of reviewers that rated given item</span></span>
<span class="code-line"><span class="sd">    Args:</span></span>
<span class="code-line"><span class="sd">      itemID: the id of the item</span></span>
<span class="code-line"><span class="sd">    Returns:</span></span>
<span class="code-line"><span class="sd">     Number of reviewers that have rated the item</span></span>
<span class="code-line"><span class="sd">    """</span></span>
<span class="code-line">    <span class="k">try</span><span class="p">:</span></span>
<span class="code-line">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">ir</span><span class="p">[</span><span class="n">train</span><span class="o">.</span><span class="n">to_inner_iid</span><span class="p">(</span><span class="n">item_id</span><span class="p">)])</span></span>
<span class="code-line">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span></span>
<span class="code-line">        <span class="k">return</span> <span class="mi">0</span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can convert the predictions from the model to a <code>pandas.Dataframe</code>, apply the functions and examine the top 10 best predictions:<font size=""></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rui'</span><span class="p">,</span> <span class="s1">'est'</span><span class="p">,</span></span>
<span class="code-line">                                         <span class="s1">'details'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Iu'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reviewerID</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ir</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Ui'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">itemID</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ri</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'err'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">est</span> <span class="o">-</span> <span class="n">df1</span><span class="o">.</span><span class="n">rui</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'right'</span><span class="p">,</span></span>
<span class="code-line">               <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">],</span></span>
<span class="code-line">               <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">best_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Best 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">best_predictions</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Best 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">2465    B00005JMFQ      286   ATOHBACMBJQQP         1901  5.0  5.0   </span>
<span class="code-line">103694  B005LAJ23A      300   ALJ0ANSP3D93H         2922  5.0  5.0   </span>
<span class="code-line">140212  B001UHOWX8      444  A1QE1C5NZL4AVN        11094  5.0  5.0   </span>
<span class="code-line">196650  B0027VST2Q     1488   A246D56KFO5CG          198  5.0  5.0   </span>
<span class="code-line">34119   6302428122     2501   AKD3NT9SO1VT6         2454  5.0  5.0   </span>
<span class="code-line">14052   B00003CWT6      151  A3C96IWQ26Q46I         3719  5.0  5.0   </span>
<span class="code-line">34137   6305800073     2600  A3RTSDHZFK344J         3916  5.0  5.0   </span>
<span class="code-line">159982  B00PY4Q9OS       14  A2YW1GDT8MQB88         1066  5.0  5.0   </span>
<span class="code-line">64899   B00DY64C8S      147  A12DWEETVVOX4G         5448  5.0  5.0   </span>
<span class="code-line">103569  B00003CY6C     5672  A1E0ILXNP3LKAS          882  5.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                          details   Iu   Ui  err  </span>
<span class="code-line">2465    {'was_impossible': False}   81  247  0.0  </span>
<span class="code-line">103694  {'was_impossible': False}   59  190  0.0  </span>
<span class="code-line">140212  {'was_impossible': False}   28  193  0.0  </span>
<span class="code-line">196650  {'was_impossible': False}  284   47  0.0  </span>
<span class="code-line">34119   {'was_impossible': False}   62   43  0.0  </span>
<span class="code-line">14052   {'was_impossible': False}   51  440  0.0  </span>
<span class="code-line">34137   {'was_impossible': False}   50   92  0.0  </span>
<span class="code-line">159982  {'was_impossible': False}   97  837  0.0  </span>
<span class="code-line">64899   {'was_impossible': False}   39  223  0.0  </span>
<span class="code-line">103569  {'was_impossible': False}  121   79  0.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's examine the worst 10 predictions as well:<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">worst_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Worst 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">worst_predictions</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">best_predictions</span><span class="p">,</span> <span class="n">worst_predictions</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Worst 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui       est  \</span>
<span class="code-line">26621   6303921248      269  A1C1T97KIJPGIX         4844  1.0  4.995164   </span>
<span class="code-line">148629  B0002WYTWG      172   A7Y6AVS576M03           42  1.0  5.000000   </span>
<span class="code-line">44833   B0000VCZK2      409  A3K89LA3W7YS1Q         5789  1.0  5.000000   </span>
<span class="code-line">67997   6302168465      534  A2X5WF3FPJ8C9J         8107  1.0  5.000000   </span>
<span class="code-line">29490   B01D9EUNBY     2691  A3FWD37OUCOQDL          778  1.0  5.000000   </span>
<span class="code-line">110642  B00005JNJV      451  A1JU644REKXCNO         1311  1.0  5.000000   </span>
<span class="code-line">119911  B00DMK6WN4     1915   ANHTCXAG77MBM         1331  1.0  5.000000   </span>
<span class="code-line">109341  B01G06T00S     2752  A3NONVSAUJAFXC          835  1.0  5.000000   </span>
<span class="code-line">33420   0800141709      752  A28YE81E63ZOZT         4933  1.0  5.000000   </span>
<span class="code-line">118018  B00AMSLDW4     1834  A157SI9J9ECKYH         1666  1.0  5.000000   </span>
<span class="code-line"></span>
<span class="code-line">                          details   Iu   Ui       err  </span>
<span class="code-line">26621   {'was_impossible': False}   38  158  3.995164  </span>
<span class="code-line">148629  {'was_impossible': False}  660  588  4.000000  </span>
<span class="code-line">44833   {'was_impossible': False}   41  243  4.000000  </span>
<span class="code-line">67997   {'was_impossible': False}   29  262  4.000000  </span>
<span class="code-line">29490   {'was_impossible': False}  122   79  4.000000  </span>
<span class="code-line">110642  {'was_impossible': False}   93  461  4.000000  </span>
<span class="code-line">119911  {'was_impossible': False}   95   63  4.000000  </span>
<span class="code-line">109341  {'was_impossible': False}  116    4  4.000000  </span>
<span class="code-line">33420   {'was_impossible': False}   43  209  4.000000  </span>
<span class="code-line">118018  {'was_impossible': False}   77   97  4.000000  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Hyperparameter-optimization-(HPO)-using-Grid-Search"><code>Hyperparameter optimization (HPO) using Grid Search</code><a class="anchor-link" href="#Hyperparameter-optimization-(HPO)-using-Grid-Search">¶</a></h4><p>   <font size="4">Hyperparameter optimization using <code>GridSearchCV</code> was performed to find the best parameters. Since this algorithm is computationally expensive with gradient descent, 10 epochs was used. A larger number of factors compared to the default <code>n_factors=20</code>, The default parameters for <code>lr_all=0.007</code> and <code>reg_all=0.02</code> were included in the search. Let's now define the parameters for the grid search.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'n_epochs'</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'n_factors'</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'lr_all'</span><span class="p">:</span> <span class="p">[</span><span class="mf">7e-4</span><span class="p">,</span> <span class="mf">7e-3</span><span class="p">,</span> <span class="mf">7e-2</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'reg_all'</span><span class="p">:</span> <span class="p">[</span><span class="mf">7e-2</span><span class="p">,</span> <span class="mf">5e-2</span><span class="p">,</span> <span class="mf">2e-2</span><span class="p">,</span> <span class="mf">7e-1</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'random_state'</span><span class="p">:</span> <span class="p">[</span><span class="n">seed_value</span><span class="p">]}</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Grid search parameters:'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">param_grid</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Grid search parameters:</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">{'n_epochs': [20],</span>
<span class="code-line"> 'n_factors': [5, 10, 15],</span>
<span class="code-line"> 'lr_all': [0.0007, 0.007, 0.07],</span>
<span class="code-line"> 'reg_all': [0.07, 0.05, 0.02, 0.7],</span>
<span class="code-line"> 'random_state': [42]}</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now we can run the grid search with  <code>rmse</code> and  <code>mae</code> as the metrics. Then examine the parameters that resulted in the lowest  <code>RMSE</code>.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="kn">from</span> <span class="nn">surprise.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">gs</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">SVDpp</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">,</span> <span class="s1">'mae'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span></span>
<span class="code-line">                  <span class="n">joblib_verbose</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Time for iterating grid search parameters..'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">search_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></span>
<span class="code-line"><span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Finished iterating grid search parameters:'</span><span class="p">,</span></span>
<span class="code-line">      <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">search_time_start</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Lowest RMSE from Grid Search:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_score</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">])</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Parameters of Model with lowest RMSE from Grid Search:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_params</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">])</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Time for iterating grid search parameters..</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="code-line">[Parallel(n_jobs=-1)]: Using backend LokyBackend with 16 concurrent workers.</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done  40 tasks      | elapsed: 87.7min</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Finished iterating grid search parameters: 13742.905663013458</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Lowest RMSE from Grid Search:</span>
<span class="code-line">0.9454947143378393</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Parameters of Model with lowest RMSE from Grid Search:</span>
<span class="code-line">{'n_epochs': 20, 'n_factors': 5, 'lr_all': 0.007, 'reg_all': 0.05, 'random_state': 42}</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="code-line">[Parallel(n_jobs=-1)]: Done 108 out of 108 | elapsed: 229.0min finished</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">cv_results</span><span class="p">)</span></span>
<span class="code-line"><span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'mean_test_rmse'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'SVDpp GridSearch HPO Cross Validation Results:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">results_df</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">SVDpp GridSearch HPO Cross Validation Results:</span>
<span class="code-line">    split0_test_rmse  split1_test_rmse  split2_test_rmse  mean_test_rmse  \</span>
<span class="code-line">5           0.948897          0.943507          0.944079        0.945495   </span>
<span class="code-line">4           0.948880          0.943676          0.944297        0.945618   </span>
<span class="code-line">16          0.948938          0.943844          0.944304        0.945695   </span>
<span class="code-line">28          0.948962          0.943712          0.944634        0.945769   </span>
<span class="code-line">17          0.949299          0.943932          0.944247        0.945826   </span>
<span class="code-line"></span>
<span class="code-line">    std_test_rmse  rank_test_rmse  split0_test_mae  split1_test_mae  \</span>
<span class="code-line">5        0.002417               1         0.684832         0.682043   </span>
<span class="code-line">4        0.002321               2         0.686716         0.684125   </span>
<span class="code-line">16       0.002301               3         0.686884         0.684269   </span>
<span class="code-line">28       0.002289               4         0.686872         0.684129   </span>
<span class="code-line">17       0.002459               5         0.685130         0.682168   </span>
<span class="code-line"></span>
<span class="code-line">    split2_test_mae  mean_test_mae  std_test_mae  rank_test_mae  \</span>
<span class="code-line">5          0.681793       0.682889      0.001377              4   </span>
<span class="code-line">4          0.683896       0.684913      0.001279              7   </span>
<span class="code-line">16         0.683806       0.684986      0.001355              8   </span>
<span class="code-line">28         0.684206       0.685069      0.001276              9   </span>
<span class="code-line">17         0.681556       0.682951      0.001561              5   </span>
<span class="code-line"></span>
<span class="code-line">    mean_fit_time  std_fit_time  mean_test_time  std_test_time  \</span>
<span class="code-line">5     1538.214133      9.366337       74.756616       0.963164   </span>
<span class="code-line">4     1544.355476      3.865669       74.432318       1.427925   </span>
<span class="code-line">16    1910.758532      9.697008       73.113926       0.483212   </span>
<span class="code-line">28    2274.356767     17.361908       70.215237       1.224627   </span>
<span class="code-line">17    1896.146014      8.418769       71.352642       0.601564   </span>
<span class="code-line"></span>
<span class="code-line">                                               params  param_n_epochs  \</span>
<span class="code-line">5   {'n_epochs': 20, 'n_factors': 5, 'lr_all': 0.0...              20   </span>
<span class="code-line">4   {'n_epochs': 20, 'n_factors': 5, 'lr_all': 0.0...              20   </span>
<span class="code-line">16  {'n_epochs': 20, 'n_factors': 10, 'lr_all': 0....              20   </span>
<span class="code-line">28  {'n_epochs': 20, 'n_factors': 15, 'lr_all': 0....              20   </span>
<span class="code-line">17  {'n_epochs': 20, 'n_factors': 10, 'lr_all': 0....              20   </span>
<span class="code-line"></span>
<span class="code-line">    param_n_factors  param_lr_all  param_reg_all  param_random_state  </span>
<span class="code-line">5                 5         0.007           0.05                  42  </span>
<span class="code-line">4                 5         0.007           0.07                  42  </span>
<span class="code-line">16               10         0.007           0.07                  42  </span>
<span class="code-line">28               15         0.007           0.07                  42  </span>
<span class="code-line">17               10         0.007           0.05                  42  </span>
<span class="code-line"></span>
<span class="code-line"></span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Then use the parameters that resulted in the lowest  <code>rmse</code> on the train/test sets, predict, apply functions and save the prediction results.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">best_estimator</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">predictions</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">test</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'RMSE from fit best parameters on train predict on test:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">))</span></span>
<span class="code-line"><span class="n">dump</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">'./SVDpp_bestGrid_Model_file'</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">algo</span><span class="p">)</span></span>
<span class="code-line"><span class="c1">#predictions, algo = dump.load('./SVDpp_bestGrid_Model_file')</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rui'</span><span class="p">,</span> <span class="s1">'est'</span><span class="p">,</span></span>
<span class="code-line">                                         <span class="s1">'details'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Iu'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reviewer_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ir</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Ui'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ri</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'err'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">est</span> <span class="o">-</span> <span class="n">df1</span><span class="o">.</span><span class="n">rui</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'right'</span><span class="p">,</span></span>
<span class="code-line">               <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">],</span></span>
<span class="code-line">               <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">df1</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">RMSE from fit best parameters on train predict on test:</span>
<span class="code-line">RMSE: 0.9466</span>
<span class="code-line">0.9465595720332523</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's now examine the top 10 best predictions:<font size=""></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">best_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Best 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">best_predictions</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Best 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">66148   0790732300     3391  A26JGAM6GZMM4V         1115  5.0  5.0   </span>
<span class="code-line">68178   B004AUP3F8     5195   A3B3182H8G4VF        12878  5.0  5.0   </span>
<span class="code-line">68175   B000LXGXY8     9565  A3KOWOXEUEHJX8         3186  5.0  5.0   </span>
<span class="code-line">175864  6304618352     2453  A1ADL615ZYH2ZZ         3773  5.0  5.0   </span>
<span class="code-line">213457  B00364K7AU      420  A1E7VTRDMI4XMV         6532  5.0  5.0   </span>
<span class="code-line">68171   0800141660      512  A37FC6SI13C7ZG         9096  5.0  5.0   </span>
<span class="code-line">68168   6300213730     2956   APNWI1W2D3HGH        13356  5.0  5.0   </span>
<span class="code-line">68158   6301933532     8075  A1TN8INXTQN040         3830  5.0  5.0   </span>
<span class="code-line">68123   B0002F6BTM     2041   AI71P00BG70FQ         7200  5.0  5.0   </span>
<span class="code-line">68113   B000BITV1A     7983   A4WNCSJJY011A         7108  5.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                          details   Iu   Ui  err  </span>
<span class="code-line">66148   {'was_impossible': False}  101  112  0.0  </span>
<span class="code-line">68178   {'was_impossible': False}   25   29  0.0  </span>
<span class="code-line">68175   {'was_impossible': False}   51   28  0.0  </span>
<span class="code-line">175864  {'was_impossible': False}   47  137  0.0  </span>
<span class="code-line">213457  {'was_impossible': False}   40  185  0.0  </span>
<span class="code-line">68171   {'was_impossible': False}   27  168  0.0  </span>
<span class="code-line">68168   {'was_impossible': False}   25   75  0.0  </span>
<span class="code-line">68158   {'was_impossible': False}   47   46  0.0  </span>
<span class="code-line">68123   {'was_impossible': False}   31   52  0.0  </span>
<span class="code-line">68113   {'was_impossible': False}   38   24  0.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's examine the worst 10 predictions as well:<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">worst_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Worst 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">worst_predictions</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">best_predictions</span><span class="p">,</span> <span class="n">worst_predictions</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Worst 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">110642  B00005JNJV      451  A1JU644REKXCNO         1311  1.0  5.0   </span>
<span class="code-line">39171   B000E5LEXS      906  A3TY31K1VXAGSX         3522  1.0  5.0   </span>
<span class="code-line">67997   6302168465      534  A2X5WF3FPJ8C9J         8107  1.0  5.0   </span>
<span class="code-line">12513   B00007K027    23913  A192UPT6KST3E2          804  1.0  5.0   </span>
<span class="code-line">11064   6304961693     2718   AK2FSJJ7GAN8B        10089  1.0  5.0   </span>
<span class="code-line">132808  6300158764    11537  A3LRLY9YUNZAGS         4212  1.0  5.0   </span>
<span class="code-line">53552   6302969794    10674  A29ND8RD38SEUZ         2548  1.0  5.0   </span>
<span class="code-line">157725  B00005U0JX     5196  A19RHMNYUFAN4L        14167  1.0  5.0   </span>
<span class="code-line">80945   6300216977     2118  A1RVXYN8QAXXNB        18177  1.0  5.0   </span>
<span class="code-line">204198  6305492042     3565  A2N03TUL3EZZDD         6386  1.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                          details   Iu   Ui  err  </span>
<span class="code-line">110642  {'was_impossible': False}   93  461  4.0  </span>
<span class="code-line">39171   {'was_impossible': False}   51   46  4.0  </span>
<span class="code-line">67997   {'was_impossible': False}   29  262  4.0  </span>
<span class="code-line">12513   {'was_impossible': False}  117    4  4.0  </span>
<span class="code-line">11064   {'was_impossible': False}   28   90  4.0  </span>
<span class="code-line">132808  {'was_impossible': False}   43   35  4.0  </span>
<span class="code-line">53552   {'was_impossible': False}   68   41  4.0  </span>
<span class="code-line">157725  {'was_impossible': False}   25   29  4.0  </span>
<span class="code-line">80945   {'was_impossible': False}   20   61  4.0  </span>
<span class="code-line">204198  {'was_impossible': False}   32   34  4.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SVD"><code>SVD</code><a class="anchor-link" href="#SVD">¶</a></h3><p>   <font size="4">Let's now fit the model using 3-fold cross validation the default parameters for 3 epochs and examine the  <code>RMSE</code> for the train/test sets.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Train/predict using SVD default parameters for 3 epochs:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Time for iterating through SVD default parameters..'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">search_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></span>
<span class="code-line"><span class="n">algo</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">(</span><span class="n">n_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed_value</span><span class="p">)</span></span>
<span class="code-line"><span class="n">cv</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'RMSE'</span><span class="p">,</span> <span class="s1">'MAE'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span></span>
<span class="code-line">                    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Finished iterating through SVD default parameters:'</span><span class="p">,</span></span>
<span class="code-line">      <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">search_time_start</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Cross validation results:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">' : '</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">predictions</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">test</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'RMSE from fit best parameters on train predict on test:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">))</span></span>
<span class="code-line"><span class="n">dump</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">'./SVD_3epochs_DefaultParamModel_file'</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">algo</span><span class="p">)</span></span>
<span class="code-line"><span class="c1">#predictions, algo = dump.load('./SVD_3epochs_DefaultParamModel_file')</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rui'</span><span class="p">,</span> <span class="s1">'est'</span><span class="p">,</span></span>
<span class="code-line">                                         <span class="s1">'details'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Iu'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reviewer_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ir</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Ui'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ri</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'err'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">est</span> <span class="o">-</span> <span class="n">df1</span><span class="o">.</span><span class="n">rui</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'right'</span><span class="p">,</span></span>
<span class="code-line">               <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">],</span></span>
<span class="code-line">               <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df2</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">'predictions_SVD_DefaultParamModel.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">df1</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Train/predict using SVD default parameters for 3 epochs:</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Time for iterating through SVD default parameters..</span>
<span class="code-line">Finished iterating through SVD default parameters: 21.718221426010132</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Cross validation results:</span>
<span class="code-line">test_rmse  :  [1.01170944 1.01306478 1.00997506]</span>
<span class="code-line">test_mae  :  [0.77944209 0.78081871 0.77882791]</span>
<span class="code-line">fit_time  :  (9.072836875915527, 8.729201793670654, 8.824720859527588)</span>
<span class="code-line">test_time  :  (2.9705753326416016, 3.0572056770324707, 2.9552011489868164)</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">RMSE from fit best parameters on train predict on test:</span>
<span class="code-line">RMSE: 0.9995</span>
<span class="code-line">0.9995495492030135</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's examine the best 10 predictions:<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">best_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Best 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">best_predictions</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Best 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">0       B00YSG2ZPA        0  A37PPLULHT6CFQ         4911  5.0  5.0   </span>
<span class="code-line">163930  B017RR6YJE     1286   AUDXDMFM49NGY         1279  5.0  5.0   </span>
<span class="code-line">210635  6303365752      959  A35ZK3M8L9JUPX           55  5.0  5.0   </span>
<span class="code-line">21967   0790729342     1683   AWG2O9C42XW5G           10  5.0  5.0   </span>
<span class="code-line">195113  B000QGDJGK    11155  A3FL6CIO8QIJ2F          120  5.0  5.0   </span>
<span class="code-line">2540    B00BNAE6M4     4244   AS2SJP1G389FE         1761  5.0  5.0   </span>
<span class="code-line">163781  6300215628     1893  A3DTNUZALZDZPR          313  5.0  5.0   </span>
<span class="code-line">116666  B00006JE59      407  A3LZBOBV9H1HDV          192  5.0  5.0   </span>
<span class="code-line">54574   B00004Z4U9     1238   AXOZ5BWOEDL76          142  5.0  5.0   </span>
<span class="code-line">163763  6304500831      526   AIHBP1TQ3JA86         8633  5.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                          details    Iu   Ui  err  </span>
<span class="code-line">0       {'was_impossible': False}    41  334  0.0  </span>
<span class="code-line">163930  {'was_impossible': False}    92  102  0.0  </span>
<span class="code-line">210635  {'was_impossible': False}   605  186  0.0  </span>
<span class="code-line">21967   {'was_impossible': False}  1262  122  0.0  </span>
<span class="code-line">195113  {'was_impossible': False}   392   15  0.0  </span>
<span class="code-line">2540    {'was_impossible': False}    76   61  0.0  </span>
<span class="code-line">163781  {'was_impossible': False}   216   71  0.0  </span>
<span class="code-line">116666  {'was_impossible': False}   286  258  0.0  </span>
<span class="code-line">54574   {'was_impossible': False}   336  212  0.0  </span>
<span class="code-line">163763  {'was_impossible': False}    31  186  0.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's examine the worst 10 predictions as well:<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">worst_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Worst 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">worst_predictions</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">best_predictions</span><span class="p">,</span> <span class="n">worst_predictions</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Worst 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui       est  \</span>
<span class="code-line">217222  B0009AK57Y       92  A1IWR4YH4ZA9BM          246  1.0  4.974257   </span>
<span class="code-line">21188   6305622825     3674    ASRB35ZZQZGB          291  1.0  4.989281   </span>
<span class="code-line">83087   B0002Z16HY     1672   AHW9HY6U7MV1Y        17415  1.0  5.000000   </span>
<span class="code-line">185192  B005X5XIF6      833   AWG2O9C42XW5G           10  1.0  5.000000   </span>
<span class="code-line">98948   B000E5LEXS      906  A3TY31K1VXAGSX         3522  1.0  5.000000   </span>
<span class="code-line">184013  6304618352     2453  A3D2VIUT2HWP0Z          439  1.0  5.000000   </span>
<span class="code-line">201875  1562550888      608  A3B1IPR94VFG1K         3590  1.0  5.000000   </span>
<span class="code-line">71015   0788832492     1558  A335JCRHG40DUK         4132  1.0  5.000000   </span>
<span class="code-line">135268  B000M341QE      536   AWG2O9C42XW5G           10  1.0  5.000000   </span>
<span class="code-line">17450   B00003CXIU     3035  A2JQJ7S0LOXH1G          243  5.0  1.000000   </span>
<span class="code-line"></span>
<span class="code-line">                          details    Iu   Ui       err  </span>
<span class="code-line">217222  {'was_impossible': False}   248  151  3.974257  </span>
<span class="code-line">21188   {'was_impossible': False}   224   92  3.989281  </span>
<span class="code-line">83087   {'was_impossible': False}    21  169  4.000000  </span>
<span class="code-line">185192  {'was_impossible': False}  1262  187  4.000000  </span>
<span class="code-line">98948   {'was_impossible': False}    55   52  4.000000  </span>
<span class="code-line">184013  {'was_impossible': False}   175  131  4.000000  </span>
<span class="code-line">201875  {'was_impossible': False}    53  248  4.000000  </span>
<span class="code-line">71015   {'was_impossible': False}    48  152  4.000000  </span>
<span class="code-line">135268  {'was_impossible': False}  1262  335  4.000000  </span>
<span class="code-line">17450   {'was_impossible': False}   261  104  4.000000  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="HPO-using-Grid-Search"><code>HPO using Grid Search</code><a class="anchor-link" href="#HPO-using-Grid-Search">¶</a></h4><p>   <font size="4">Let's now define the parameters for the grid search.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'n_epochs'</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'n_factors'</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span> <span class="p">,</span><span class="mi">45</span> <span class="p">,</span> <span class="mi">50</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'lr_all'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">,</span> <span class="mf">0.007</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'reg_all'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'random_state'</span><span class="p">:</span> <span class="p">[</span><span class="n">seed_value</span><span class="p">]}</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'SVD HPO Grid search parameters:'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">param_grid</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">SVD HPO Grid search parameters:</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">{'n_epochs': [30, 35, 40, 45, 50, 55, 60, 65, 70],</span>
<span class="code-line"> 'n_factors': [20, 25, 30, 35, 40, 45, 50],</span>
<span class="code-line"> 'lr_all': [0.002, 0.003, 0.004, 0.005, 0.006, 0.007],</span>
<span class="code-line"> 'reg_all': [0.0001, 0.001, 0.01, 0.02, 0.03, 0.04],</span>
<span class="code-line"> 'random_state': [42]}</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now we can run the grid search with  <code>rmse</code> and  <code>mae</code> as the metrics. Then examine the parameters that resulted in the lowest  <code>RMSE</code>.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">gs</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">SVD</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">,</span> <span class="s1">'mae'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span></span>
<span class="code-line">                  <span class="n">joblib_verbose</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Time for iterating grid search parameters..'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">search_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></span>
<span class="code-line"><span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Finished iterating grid search parameters:'</span><span class="p">,</span></span>
<span class="code-line">      <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">search_time_start</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Lowest RMSE from Grid Search:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_score</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">])</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Parameters of Model with lowest RMSE from Grid Search:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_params</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">])</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Time for iterating grid search parameters..</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="code-line">[Parallel(n_jobs=-1)]: Using backend LokyBackend with 16 concurrent workers.</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done  40 tasks      | elapsed:  3.2min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 256 tasks      | elapsed: 18.0min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 616 tasks      | elapsed: 48.1min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 1120 tasks      | elapsed: 90.8min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 1768 tasks      | elapsed: 153.8min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 2560 tasks      | elapsed: 238.1min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 3496 tasks      | elapsed: 350.8min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 4576 tasks      | elapsed: 501.9min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 5800 tasks      | elapsed: 687.2min</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Finished iterating grid search parameters: 51872.37151479721</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Lowest RMSE from Grid Search:</span>
<span class="code-line">0.9470577657248332</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Parameters of Model with lowest RMSE from Grid Search:</span>
<span class="code-line">{'n_epochs': 65, 'n_factors': 20, 'lr_all': 0.002, 'reg_all': 0.04, 'random_state': 42}</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="code-line">[Parallel(n_jobs=-1)]: Done 6804 out of 6804 | elapsed: 864.5min finished</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">cv_results</span><span class="p">)</span></span>
<span class="code-line"><span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'mean_test_rmse'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'SVD GridSearch HPO Cross Validation Results:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">results_df</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">SVD GridSearch HPO Cross Validation Results:</span>
<span class="code-line">      split0_test_rmse  split1_test_rmse  split2_test_rmse  mean_test_rmse  \</span>
<span class="code-line">1769          0.947837          0.947292          0.946044        0.947058   </span>
<span class="code-line">515           0.947919          0.947282          0.946094        0.947098   </span>
<span class="code-line">1517          0.947917          0.947291          0.946087        0.947098   </span>
<span class="code-line">767           0.947869          0.947354          0.946098        0.947107   </span>
<span class="code-line">17            0.947931          0.947284          0.946113        0.947109   </span>
<span class="code-line"></span>
<span class="code-line">      std_test_rmse  rank_test_rmse  split0_test_mae  split1_test_mae  \</span>
<span class="code-line">1769       0.000751               1         0.684882         0.684427   </span>
<span class="code-line">515        0.000756               2         0.685845         0.685306   </span>
<span class="code-line">1517       0.000760               3         0.685833         0.685298   </span>
<span class="code-line">767        0.000744               4         0.684506         0.684084   </span>
<span class="code-line">17         0.000752               5         0.685866         0.685321   </span>
<span class="code-line"></span>
<span class="code-line">      split2_test_mae  mean_test_mae  std_test_mae  rank_test_mae  \</span>
<span class="code-line">1769         0.683501       0.684270      0.000575             83   </span>
<span class="code-line">515          0.684445       0.685199      0.000576            168   </span>
<span class="code-line">1517         0.684431       0.685187      0.000578            164   </span>
<span class="code-line">767          0.683143       0.683911      0.000570             49   </span>
<span class="code-line">17           0.684465       0.685217      0.000577            172   </span>
<span class="code-line"></span>
<span class="code-line">      mean_fit_time  std_fit_time  mean_test_time  std_test_time  \</span>
<span class="code-line">1769     110.694426      0.793158        5.775399       0.235709   </span>
<span class="code-line">515       73.020183      0.826249        6.204501       0.493265   </span>
<span class="code-line">1517     105.295258      0.178649        5.506686       0.242048   </span>
<span class="code-line">767       78.236890      0.808342        5.835091       0.203345   </span>
<span class="code-line">17        55.468125      0.798048        5.672714       0.187081   </span>
<span class="code-line"></span>
<span class="code-line">                                                 params  param_n_epochs  \</span>
<span class="code-line">1769  {'n_epochs': 65, 'n_factors': 20, 'lr_all': 0....              65   </span>
<span class="code-line">515   {'n_epochs': 40, 'n_factors': 20, 'lr_all': 0....              40   </span>
<span class="code-line">1517  {'n_epochs': 60, 'n_factors': 20, 'lr_all': 0....              60   </span>
<span class="code-line">767   {'n_epochs': 45, 'n_factors': 20, 'lr_all': 0....              45   </span>
<span class="code-line">17    {'n_epochs': 30, 'n_factors': 20, 'lr_all': 0....              30   </span>
<span class="code-line"></span>
<span class="code-line">      param_n_factors  param_lr_all  param_reg_all  param_random_state  </span>
<span class="code-line">1769               20         0.002           0.04                  42  </span>
<span class="code-line">515                20         0.003           0.04                  42  </span>
<span class="code-line">1517               20         0.002           0.04                  42  </span>
<span class="code-line">767                20         0.003           0.04                  42  </span>
<span class="code-line">17                 20         0.004           0.04                  42  </span>
<span class="code-line"></span>
<span class="code-line"></span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Then use the parameters that resulted in the lowest  <code>RMSE</code> on the train/test sets, predict, apply functions and save the prediction results.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">best_estimator</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">predictions</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">test</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'RMSE from fit best parameters on train predict on test:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">dump</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">'./SVD_bestGrid_Model_file'</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">algo</span><span class="p">)</span></span>
<span class="code-line"><span class="c1">#predictions, algo = dump.load('./SVD_bestGrid_Model_file')</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rui'</span><span class="p">,</span> <span class="s1">'est'</span><span class="p">,</span></span>
<span class="code-line">                                         <span class="s1">'details'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Iu'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reviewer_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ir</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Ui'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ri</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'err'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">est</span> <span class="o">-</span> <span class="n">df1</span><span class="o">.</span><span class="n">rui</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'right'</span><span class="p">,</span></span>
<span class="code-line">               <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">],</span></span>
<span class="code-line">               <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">df1</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">RMSE from fit best parameters on train predict on test:</span>
<span class="code-line">RMSE: 0.9426</span>
<span class="code-line">0.9426279412758342</span>
<span class="code-line"></span>
<span class="code-line"></span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can examine the top 10 best predictions:<font size=""></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">best_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Best 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">best_predictions</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Best 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">176329  B000068TSI      806  A12BXTSI4P73PA        16449  5.0  5.0   </span>
<span class="code-line">13930   0792846133     1456   AT07UZQQR7ZEH         1410  5.0  5.0   </span>
<span class="code-line">38632   6305807655    21418  A3LKO630Z5MC5P        11133  5.0  5.0   </span>
<span class="code-line">197661  B00005JO2V     6502  A2P5WV8GFN1HQO         4184  5.0  5.0   </span>
<span class="code-line">38643   6303042503      362  A1VIZFPC5FDDI5         4880  5.0  5.0   </span>
<span class="code-line">97976   6304401132      577   AL7HW45VDAWUZ        10433  5.0  5.0   </span>
<span class="code-line">97971   6300215695      435  A32R3MTF6UVLGE        14696  5.0  5.0   </span>
<span class="code-line">38631   B001KX50AQ    33032  A3QMO4Z0U2R8P1         3128  5.0  5.0   </span>
<span class="code-line">97969   B00BEIYP1W      918  A3LZBOBV9H1HDV          192  5.0  5.0   </span>
<span class="code-line">197652  B000095J2Q    22792  A3NONVSAUJAFXC          835  5.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                          details   Iu   Ui  err  </span>
<span class="code-line">176329  {'was_impossible': False}   18  206  0.0  </span>
<span class="code-line">13930   {'was_impossible': False}   84  122  0.0  </span>
<span class="code-line">38632   {'was_impossible': False}   27   15  0.0  </span>
<span class="code-line">197661  {'was_impossible': False}   47   23  0.0  </span>
<span class="code-line">38643   {'was_impossible': False}   44  336  0.0  </span>
<span class="code-line">97976   {'was_impossible': False}   25  245  0.0  </span>
<span class="code-line">97971   {'was_impossible': False}   23  188  0.0  </span>
<span class="code-line">38631   {'was_impossible': False}   56    6  0.0  </span>
<span class="code-line">97969   {'was_impossible': False}  293  154  0.0  </span>
<span class="code-line">197652  {'was_impossible': False}  131   14  0.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's examine the worst 10 predictions as well:<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">worst_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Worst 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">worst_predictions</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">best_predictions</span><span class="p">,</span> <span class="n">worst_predictions</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Worst 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">12813   B00OV3VGP0       22  A107BIW9F8FHZK         6703  1.0  5.0   </span>
<span class="code-line">114206  6303832563     4884  A2UKC1X32PBQZ9         1053  1.0  5.0   </span>
<span class="code-line">113120  B00ID3TPA2    22390  A2KASTU01ARCF9         6928  1.0  5.0   </span>
<span class="code-line">77728   B00753M8U0    23406  A31W21E1FQ8Q76         1563  1.0  5.0   </span>
<span class="code-line">80302   B002HEXVUI       50  A1JTTJ7M7EC7Q7          705  1.0  5.0   </span>
<span class="code-line">57297   B004X0MHEU     1821  A3G16L6SE9WQJW        18154  1.0  5.0   </span>
<span class="code-line">121154  B000069HYZ    45548   ASFCEIBZOZFHF         2098  1.0  5.0   </span>
<span class="code-line">99084   B00E0KWBE4     4451   AH4USMNP4MV4I        12373  1.0  5.0   </span>
<span class="code-line">907     B003Y7TJXA    24721   AH06UFDUCQLUI         5443  1.0  5.0   </span>
<span class="code-line">221274  630365147X     1178  A35E0VGWQKCADS         5108  1.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                          details   Iu   Ui  err  </span>
<span class="code-line">12813   {'was_impossible': False}   36  739  4.0  </span>
<span class="code-line">114206  {'was_impossible': False}  109   25  4.0  </span>
<span class="code-line">113120  {'was_impossible': False}   34   11  4.0  </span>
<span class="code-line">77728   {'was_impossible': False}   85   11  4.0  </span>
<span class="code-line">80302   {'was_impossible': False}  133  646  4.0  </span>
<span class="code-line">57297   {'was_impossible': False}   21   47  4.0  </span>
<span class="code-line">121154  {'was_impossible': False}   70    5  4.0  </span>
<span class="code-line">99084   {'was_impossible': False}   24   39  4.0  </span>
<span class="code-line">907     {'was_impossible': False}   40    4  4.0  </span>
<span class="code-line">221274  {'was_impossible': False}   42  152  4.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="BaselineOnly"><code>BaselineOnly</code><a class="anchor-link" href="#BaselineOnly">¶</a></h3><p>   <font size="4">Now we can run the 3-fold cross validation using the default parameters for 3 epochs using <code>method='als'</code> with  <code>RMSE</code> and  <code>mae</code> as the metrics. Then predict with the model, apply the functions and save the prediction results.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Train/predict using Baseline default parameters with Alternating Least Squares for 3 epochs:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">bsl_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'method'</span><span class="p">:</span> <span class="s1">'als'</span><span class="p">,</span></span>
<span class="code-line">               <span class="s1">'n_epochs'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Baselines estimates configuration:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">bsl_options</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Model parameters:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">BaselineOnly</span><span class="p">(</span><span class="n">bsl_options</span><span class="o">=</span><span class="n">bsl_options</span><span class="p">))</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Train/predict using Baseline default parameters with Alternating Least Squares for 3 epochs:</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Baselines estimates configuration:</span>
<span class="code-line">{'method': 'als', 'n_epochs': 3}</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Model parameters:</span>
<span class="code-line">&lt;surprise.prediction_algorithms.baseline_only.BaselineOnly object at 0x000002F2AB988C40&gt;</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Time for iterating through Baseline default parameters epochs=3 using ALS..'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">search_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></span>
<span class="code-line"><span class="n">algo</span> <span class="o">=</span> <span class="n">BaselineOnly</span><span class="p">(</span><span class="n">bsl_options</span><span class="o">=</span><span class="n">bsl_options</span><span class="p">)</span></span>
<span class="code-line"><span class="n">cv</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'RMSE'</span><span class="p">,</span> <span class="s1">'MAE'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span></span>
<span class="code-line">                    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Finished iterating through Baseline default parameters epochs=3 using ALS:'</span><span class="p">,</span></span>
<span class="code-line">      <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">search_time_start</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Cross validation results:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">' : '</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">predictions</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">test</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'RMSE from fit best parameters on train predict on test:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">))</span></span>
<span class="code-line"><span class="n">dump</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">'./Baseline_3epochs_DefaultParamModel_file'</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">algo</span><span class="p">)</span></span>
<span class="code-line"><span class="c1">#predictions, algo = dump.load('./Baseline_3epochs_DefaultParamModel_file')</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rui'</span><span class="p">,</span> <span class="s1">'est'</span><span class="p">,</span></span>
<span class="code-line">                                         <span class="s1">'details'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Iu'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reviewer_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ir</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Ui'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ri</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'err'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">est</span> <span class="o">-</span> <span class="n">df1</span><span class="o">.</span><span class="n">rui</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'right'</span><span class="p">,</span></span>
<span class="code-line">               <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">],</span></span>
<span class="code-line">               <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">df1</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Time for iterating through Baseline default parameters epochs=3 using ALS..</span>
<span class="code-line">Finished iterating through Baseline default parameters epochs=3 using ALS: 18.00507688522339</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Cross validation results:</span>
<span class="code-line">test_rmse  :  [0.96236564 0.9575281  0.95800474]</span>
<span class="code-line">test_mae  :  [0.7192956  0.71624087 0.71744233]</span>
<span class="code-line">fit_time  :  (0.45334315299987793, 0.5258574485778809, 0.4615175724029541)</span>
<span class="code-line">test_time  :  (3.44765043258667, 3.460092782974243, 3.342712163925171)</span>
<span class="code-line">Estimating biases using als...</span>
<span class="code-line">RMSE from fit best parameters on train predict on test:</span>
<span class="code-line">RMSE: 0.9532</span>
<span class="code-line">0.9532457019820773</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can examine the top 10 best predictions:<font size=""></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">best_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Best 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">best_predictions</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Best 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">22719   6303824358      652  A3UGURGJMNRSH5         6615  5.0  5.0   </span>
<span class="code-line">154698  6303521231     3897   ARMESRCOD7ZRV         5721  5.0  5.0   </span>
<span class="code-line">190758  B00IV3FLO8      504  A3CXEYHXHR5RSE         1293  5.0  5.0   </span>
<span class="code-line">86407   7799128836      123  A3TGQ0Y8ILUGBP         9774  5.0  5.0   </span>
<span class="code-line">154699  0792834917     3899   A8KI69T8XEYH8        11191  5.0  5.0   </span>
<span class="code-line">215986  B001KVZ6HK      489  A2YUA3H1LLU53Z           13  5.0  5.0   </span>
<span class="code-line">51302   6302799112     7144  A18EXIAW8NU3DP          764  5.0  5.0   </span>
<span class="code-line">66610   B0013LRKRQ     8910  A1QNLOV3985VUP         2518  5.0  5.0   </span>
<span class="code-line">51298   6301966554      107  A2BVCF2AKHHCDF         3942  5.0  5.0   </span>
<span class="code-line">51296   B001ATWK2Q    14068  A12CN8FQSR18H9          452  5.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                          details    Iu   Ui  err  </span>
<span class="code-line">22719   {'was_impossible': False}    32  124  0.0  </span>
<span class="code-line">154698  {'was_impossible': False}    36   28  0.0  </span>
<span class="code-line">190758  {'was_impossible': False}    92   72  0.0  </span>
<span class="code-line">86407   {'was_impossible': False}    31  254  0.0  </span>
<span class="code-line">154699  {'was_impossible': False}    28   59  0.0  </span>
<span class="code-line">215986  {'was_impossible': False}  1171  222  0.0  </span>
<span class="code-line">51302   {'was_impossible': False}   118   22  0.0  </span>
<span class="code-line">66610   {'was_impossible': False}    63   32  0.0  </span>
<span class="code-line">51298   {'was_impossible': False}    43  264  0.0  </span>
<span class="code-line">51296   {'was_impossible': False}   170    8  0.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's examine the worst 10 predictions as well:<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">worst_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Worst 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">worst_predictions</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">best_predictions</span><span class="p">,</span> <span class="n">worst_predictions</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Worst 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">214948  B005BYBZCM    14976   APSOSLICIDIFX         4500  1.0  5.0   </span>
<span class="code-line">118018  B00AMSLDW4     1834  A157SI9J9ECKYH         1666  1.0  5.0   </span>
<span class="code-line">110642  B00005JNJV      451  A1JU644REKXCNO         1311  1.0  5.0   </span>
<span class="code-line">108646  B0046ZT40W       20  A15XO0U10UDT8O         8302  1.0  5.0   </span>
<span class="code-line">125152  B000BGQSEA     1999   AWG2O9C42XW5G           10  1.0  5.0   </span>
<span class="code-line">33420   0800141709      752  A28YE81E63ZOZT         4933  1.0  5.0   </span>
<span class="code-line">44833   B0000VCZK2      409  A3K89LA3W7YS1Q         5789  1.0  5.0   </span>
<span class="code-line">29490   B01D9EUNBY     2691  A3FWD37OUCOQDL          778  1.0  5.0   </span>
<span class="code-line">119911  B00DMK6WN4     1915   ANHTCXAG77MBM         1331  1.0  5.0   </span>
<span class="code-line">39171   B000E5LEXS      906  A3TY31K1VXAGSX         3522  1.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                          details    Iu   Ui  err  </span>
<span class="code-line">214948  {'was_impossible': False}    48   10  4.0  </span>
<span class="code-line">118018  {'was_impossible': False}    77   97  4.0  </span>
<span class="code-line">110642  {'was_impossible': False}    93  461  4.0  </span>
<span class="code-line">108646  {'was_impossible': False}    32   53  4.0  </span>
<span class="code-line">125152  {'was_impossible': False}  1270   25  4.0  </span>
<span class="code-line">33420   {'was_impossible': False}    43  209  4.0  </span>
<span class="code-line">44833   {'was_impossible': False}    41  243  4.0  </span>
<span class="code-line">29490   {'was_impossible': False}   122   79  4.0  </span>
<span class="code-line">119911  {'was_impossible': False}    95   63  4.0  </span>
<span class="code-line">39171   {'was_impossible': False}    51   46  4.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="HPO-using-Grid-Search"><code>HPO using Grid Search</code><a class="anchor-link" href="#HPO-using-Grid-Search">¶</a></h4><p>   <font size="4">Let's now define the parameters for the grid search.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'BaselineOnly HPO using Grid Search Minimized:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'bsl_options'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'method'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'als'</span><span class="p">,</span> <span class="s1">'sgd'</span><span class="p">],</span></span>
<span class="code-line">                             <span class="s1">'n_epochs'</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span></span>
<span class="code-line">                             <span class="s1">'reg_u'</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span></span>
<span class="code-line">                             <span class="s1">'reg_i'</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]}}</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Grid search parameters:'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">param_grid</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">BaselineOnly HPO using Grid Search Minimized:</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Grid search parameters:</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">{'bsl_options': {'method': ['als', 'sgd'],</span>
<span class="code-line">  'n_epochs': [10, 15, 20, 25, 30, 35, 40, 45, 50],</span>
<span class="code-line">  'reg_u': [0, 1, 2, 3, 4, 5, 10, 15, 20],</span>
<span class="code-line">  'reg_i': [0, 1, 2, 3, 4, 5, 10, 15, 20]}}</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now we can run the grid search with  <code>rmse</code> and  <code>mae</code> as the metrics. Then examine the parameters that resulted in the lowest  <code>rmse</code>.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">gs</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">BaselineOnly</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">,</span> <span class="s1">'mae'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span></span>
<span class="code-line">                  <span class="n">joblib_verbose</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Time for iterating grid search parameters..'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">search_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></span>
<span class="code-line"><span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Finished iterating grid search parameters:'</span><span class="p">,</span></span>
<span class="code-line">      <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">search_time_start</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Lowest RMSE from Grid Search:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_score</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">])</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Parameters of Model with lowest RMSE from Grid Search:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_params</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">])</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Time for iterating grid search parameters..</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="code-line">[Parallel(n_jobs=-1)]: Using backend LokyBackend with 16 concurrent workers.</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done  40 tasks      | elapsed:   45.6s</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 256 tasks      | elapsed:  4.4min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 616 tasks      | elapsed: 10.5min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 1120 tasks      | elapsed: 19.6min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 1768 tasks      | elapsed: 32.1min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 2560 tasks      | elapsed: 46.8min</span>
<span class="code-line">[Parallel(n_jobs=-1)]: Done 3496 tasks      | elapsed: 63.2min</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Finished iterating grid search parameters: 4817.081090688705</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Lowest RMSE from Grid Search:</span>
<span class="code-line">0.9429468447894139</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Parameters of Model with lowest RMSE from Grid Search:</span>
<span class="code-line">{'bsl_options': {'method': 'als', 'n_epochs': 50, 'reg_u': 1, 'reg_i': 3}}</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="code-line">[Parallel(n_jobs=-1)]: Done 4374 out of 4374 | elapsed: 80.2min finished</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Then use the parameters that resulted in the lowest  <code>rmse</code> on the train/test sets, predict, apply functions and save the prediction results.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">best_estimator</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">predictions</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">test</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'RMSE from fit best parameters on train predict on test:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">))</span></span>
<span class="code-line"><span class="n">dump</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">'./BaselineOnly_moreParams_bestGrid_Model_file'</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">algo</span><span class="p">)</span></span>
<span class="code-line"><span class="c1">#predictions, algo = dump.load('./BaselineOnly_moreParams_bestGrid_Model_file')</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rui'</span><span class="p">,</span> <span class="s1">'est'</span><span class="p">,</span></span>
<span class="code-line">                                         <span class="s1">'details'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Iu'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reviewer_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ir</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Ui'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ri</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'err'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">est</span> <span class="o">-</span> <span class="n">df1</span><span class="o">.</span><span class="n">rui</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'right'</span><span class="p">,</span></span>
<span class="code-line">               <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">],</span></span>
<span class="code-line">               <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">df1</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Estimating biases using als...</span>
<span class="code-line">RMSE from fit best parameters on train predict on test:</span>
<span class="code-line">RMSE: 0.9400</span>
<span class="code-line">0.9400458413742169</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can examine the top 10 best predictions:<font size=""></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">best_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Best 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">best_predictions</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Best 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">111339  B0053O89WY      757  A10EU5IAKELBDI        14872  5.0  5.0   </span>
<span class="code-line">204037  B000YDMPCO     7653   A551XY0L7WQXU         1218  5.0  5.0   </span>
<span class="code-line">74750   B00U38W0X4    18648  A227P36VP2YMFJ        12389  5.0  5.0   </span>
<span class="code-line">158992  B00FDJGL6A      306  A16J08RGNPYXW6        11073  5.0  5.0   </span>
<span class="code-line">204044  B00005JKZU      366  A36GQV2C4O0DXE         5800  5.0  5.0   </span>
<span class="code-line">204054  B000059H6T     2016   AP40TY8769CBM        16798  5.0  5.0   </span>
<span class="code-line">158983  B00005BJWN    13388  A3ESQSCCM2IR24         7591  5.0  5.0   </span>
<span class="code-line">158982  B00S89IAWU    20893  A2545BZKJ6FLF6        16037  5.0  5.0   </span>
<span class="code-line">204055  B0012Z36FI     4689   AWD6SR6I52C5C          476  5.0  5.0   </span>
<span class="code-line">158978  B00D91GRA4       87  A2RC58KZZC41QW         2180  5.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                          details   Iu   Ui  err  </span>
<span class="code-line">111339  {'was_impossible': False}   19  107  0.0  </span>
<span class="code-line">204037  {'was_impossible': False}   98   32  0.0  </span>
<span class="code-line">74750   {'was_impossible': False}   29   17  0.0  </span>
<span class="code-line">158992  {'was_impossible': False}   22   52  0.0  </span>
<span class="code-line">204044  {'was_impossible': False}   38  365  0.0  </span>
<span class="code-line">204054  {'was_impossible': False}   22   50  0.0  </span>
<span class="code-line">158983  {'was_impossible': False}   33   12  0.0  </span>
<span class="code-line">158982  {'was_impossible': False}   18    6  0.0  </span>
<span class="code-line">204055  {'was_impossible': False}  174   25  0.0  </span>
<span class="code-line">158978  {'was_impossible': False}   66  694  0.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's examine the worst 10 predictions as well:<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">worst_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Worst 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">worst_predictions</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">best_predictions</span><span class="p">,</span> <span class="n">worst_predictions</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Worst 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">162516  B000VS20M2      148  A1GFX8FS58ZDHR         6479  1.0  5.0   </span>
<span class="code-line">220011  B01DPPMPSG     6988  A30BQKQU5XGGS1        15523  1.0  5.0   </span>
<span class="code-line">126619  6305627401     1667   AJ32DH3NMIES9         5904  1.0  5.0   </span>
<span class="code-line">99713   6302707722    65249  A1JFJFHKG8Y7LB         3612  1.0  5.0   </span>
<span class="code-line">99311   B000NOIX6G    12926  A3VHB8OAQQF9W6         1094  1.0  5.0   </span>
<span class="code-line">13116   6303686850     3483  A3N3Y4UJ07LOVG         3284  1.0  5.0   </span>
<span class="code-line">54348   B01D5MQQ2A    61254  A3AEZXERB7JP4R        11448  1.0  5.0   </span>
<span class="code-line">108646  B0046ZT40W       20  A15XO0U10UDT8O         8302  1.0  5.0   </span>
<span class="code-line">26866   B00005T33K     2680  A28UFH7QJBZZMU         4268  1.0  5.0   </span>
<span class="code-line">96274   B000BKVKSA     7802  A10175AMUHOQC4          458  1.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                          details   Iu   Ui  err  </span>
<span class="code-line">162516  {'was_impossible': False}   40  450  4.0  </span>
<span class="code-line">220011  {'was_impossible': False}   19   21  4.0  </span>
<span class="code-line">126619  {'was_impossible': False}   36  105  4.0  </span>
<span class="code-line">99713   {'was_impossible': False}   44    1  4.0  </span>
<span class="code-line">99311   {'was_impossible': False}  102   18  4.0  </span>
<span class="code-line">13116   {'was_impossible': False}   54  101  4.0  </span>
<span class="code-line">54348   {'was_impossible': False}   29    4  4.0  </span>
<span class="code-line">108646  {'was_impossible': False}   32   53  4.0  </span>
<span class="code-line">26866   {'was_impossible': False}   45   14  4.0  </span>
<span class="code-line">96274   {'was_impossible': False}  163   22  4.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="KNNBaseline"><code>KNNBaseline</code><a class="anchor-link" href="#KNNBaseline">¶</a></h3><p>   <font size="4">Now we can run the 3-fold cross validation using the default parameters for 3 epochs using<code>method='als'</code> with  <code>RMSE</code> and  <code>mae</code> as the metrics. Then predict with the model, apply the functions and save the prediction results.</font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Train/predict using KNNBaseline default parameters with Alternating Least Squares for 3 epochs:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">bsl_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'method'</span><span class="p">:</span> <span class="s1">'als'</span><span class="p">,</span></span>
<span class="code-line">               <span class="s1">'n_epochs'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Baselines estimates configuration:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">bsl_options</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Model parameters:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'KNNBaseline(k=40, min_k=1, bsl_options=bsl_options, verbose=False)'</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Train/predict using KNNBaseline default parameters with Alternating Least Squares for 3 epochs:</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Baselines estimates configuration:</span>
<span class="code-line">{'method': 'als', 'n_epochs': 3}</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Model parameters:</span>
<span class="code-line">KNNBaseline(k=40, min_k=1, bsl_options=bsl_options, verbose=False)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Time for iterating through KNNBaseline default parameters epochs=3 using ALS..'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">search_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></span>
<span class="code-line"><span class="n">algo</span> <span class="o">=</span> <span class="n">KNNBaseline</span><span class="p">(</span><span class="n">bsl_options</span><span class="o">=</span><span class="n">bsl_options</span><span class="p">)</span></span>
<span class="code-line"><span class="n">cv</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'RMSE'</span><span class="p">,</span> <span class="s1">'MAE'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span></span>
<span class="code-line">                    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Finished iterating through KNNBaseline default parameters epochs=3 using ALS:'</span><span class="p">,</span></span>
<span class="code-line">      <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">search_time_start</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Cross validation results:'</span><span class="p">)</span></span>
<span class="code-line"><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></span>
<span class="code-line">    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">' : '</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Time for iterating through KNNBaseline default parameters epochs=3 using ALS..</span>
<span class="code-line">Finished iterating through KNNBaseline default parameters epochs=3 using ALS: 52.3457145690918</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Cross validation results:</span>
<span class="code-line">test_rmse  :  [0.98871454 0.98392946 0.98468003]</span>
<span class="code-line">test_mae  :  [0.70193266 0.6991709  0.69981287]</span>
<span class="code-line">fit_time  :  (12.814245462417603, 12.74767255783081, 12.50976276397705)</span>
<span class="code-line">test_time  :  (27.62490439414978, 28.00885558128357, 28.005619525909424)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">predictions</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">test</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'RMSE from fit best parameters on train predict on test:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">))</span></span>
<span class="code-line"><span class="n">dump</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">'./KNNBaseline_3epochs_DefaultParamModel_file'</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">algo</span><span class="p">)</span></span>
<span class="code-line"><span class="c1">#predictions, algo = dump.load('./KNNBaseline_3epochs_DefaultParamModel_file')</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rui'</span><span class="p">,</span> <span class="s1">'est'</span><span class="p">,</span></span>
<span class="code-line">                                         <span class="s1">'details'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Iu'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reviewer_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ir</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Ui'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ri</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'err'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">est</span> <span class="o">-</span> <span class="n">df1</span><span class="o">.</span><span class="n">rui</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'right'</span><span class="p">,</span></span>
<span class="code-line">               <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">],</span></span>
<span class="code-line">               <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">df1</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Estimating biases using als...</span>
<span class="code-line">Computing the msd similarity matrix...</span>
<span class="code-line">Done computing similarity matrix.</span>
<span class="code-line">RMSE from fit best parameters on train predict on test:</span>
<span class="code-line">RMSE: 0.9639</span>
<span class="code-line">0.9638924023238667</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can examine the top 10 best predictions:<font size=""></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">best_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Best 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">best_predictions</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Best 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">82292   B002ZG97EC      599  A29TWAFI927A05         7359  5.0  5.0   </span>
<span class="code-line">66702   B016LGTB1A     1054  A3UCR3ANY81Y3X        10988  5.0  5.0   </span>
<span class="code-line">199042  B00000JQU8     4924   AHD101501WCN1         3797  5.0  5.0   </span>
<span class="code-line">66720   B000ANDBTY     5079   ALWB64XOXNMDP          305  5.0  5.0   </span>
<span class="code-line">66728   B00OJ0X41E     1670  A3HYD0KTB8XKPQ        13455  5.0  5.0   </span>
<span class="code-line">66730   B001EHDSRK    10371   AR0BHE8D3J5LD          567  5.0  5.0   </span>
<span class="code-line">199038  B007K7IC6K    20933  A35X4WCJ3K67BY         3490  5.0  5.0   </span>
<span class="code-line">66697   B0066E6RWE    33621   A1UJPR7G1TX5D        16570  5.0  5.0   </span>
<span class="code-line">66734   6304493703    10521  A386NVAVQV5WUO         4546  5.0  5.0   </span>
<span class="code-line">66745   B0000C508X    32981  A1XEVKJR5FBBSK        12943  5.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                                          details   Iu   Ui  err  </span>
<span class="code-line">82292   {'actual_k': 40, 'was_impossible': False}   36  104  0.0  </span>
<span class="code-line">66702   {'actual_k': 40, 'was_impossible': False}   26  257  0.0  </span>
<span class="code-line">199042  {'actual_k': 40, 'was_impossible': False}   47   73  0.0  </span>
<span class="code-line">66720   {'actual_k': 40, 'was_impossible': False}  226   57  0.0  </span>
<span class="code-line">66728    {'actual_k': 3, 'was_impossible': False}   24   13  0.0  </span>
<span class="code-line">66730    {'actual_k': 5, 'was_impossible': False}  153    5  0.0  </span>
<span class="code-line">199038   {'actual_k': 9, 'was_impossible': False}   49   15  0.0  </span>
<span class="code-line">66697    {'actual_k': 1, 'was_impossible': False}   23    9  0.0  </span>
<span class="code-line">66734    {'actual_k': 1, 'was_impossible': False}   47    5  0.0  </span>
<span class="code-line">66745    {'actual_k': 2, 'was_impossible': False}   26    8  0.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's examine the worst 10 predictions as well:<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">worst_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Worst 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">worst_predictions</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">best_predictions</span><span class="p">,</span> <span class="n">worst_predictions</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Worst 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">50924   B000UYN9PY    41193  A2POT13FER5L82         1518  5.0  1.0   </span>
<span class="code-line">162946  B00AZMFG48     3768  A1NFCJXNYVJ0O1         5015  1.0  5.0   </span>
<span class="code-line">64718   B00LT1JHLW     2240  A1QWGK4SXTRXMD         3387  1.0  5.0   </span>
<span class="code-line">121979  630249933X    46077  A2WHWME9PTOS0E        14782  1.0  5.0   </span>
<span class="code-line">87343   6304329008     6536  A30NXBU3CDNDFR         5468  1.0  5.0   </span>
<span class="code-line">1375    B0009UVCO4    55298  A141HP4LYPWMSR           76  5.0  1.0   </span>
<span class="code-line">37276   B00435KP44    22619  A347I00XTPNIUP         3867  5.0  1.0   </span>
<span class="code-line">128317  B00000IYR0    24076  A1POCQWA3VAY8T        17696  1.0  5.0   </span>
<span class="code-line">21647   B000JMKJPK    44655   AETEH7SOTOFRT        11177  5.0  1.0   </span>
<span class="code-line">7373    B000QCUZ7U    28629   AJTQS6KM9ZV5L         1420  1.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                                          details   Iu  Ui  err  </span>
<span class="code-line">50924    {'actual_k': 1, 'was_impossible': False}   85   5  4.0  </span>
<span class="code-line">162946   {'actual_k': 6, 'was_impossible': False}   43  21  4.0  </span>
<span class="code-line">64718   {'actual_k': 22, 'was_impossible': False}   49  66  4.0  </span>
<span class="code-line">121979   {'actual_k': 1, 'was_impossible': False}   23   1  4.0  </span>
<span class="code-line">87343    {'actual_k': 7, 'was_impossible': False}   42  48  4.0  </span>
<span class="code-line">1375     {'actual_k': 2, 'was_impossible': False}  503   2  4.0  </span>
<span class="code-line">37276    {'actual_k': 1, 'was_impossible': False}   46   3  4.0  </span>
<span class="code-line">128317   {'actual_k': 1, 'was_impossible': False}   20  11  4.0  </span>
<span class="code-line">21647    {'actual_k': 1, 'was_impossible': False}   26   2  4.0  </span>
<span class="code-line">7373     {'actual_k': 2, 'was_impossible': False}   89   4  4.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="HPO-using-Grid-Search"><code>HPO using Grid Search</code><a class="anchor-link" href="#HPO-using-Grid-Search">¶</a></h4><p>   <font size="4">Let's now define the parameters for the grid search.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'KNNBaseline HPO using Grid Search:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'bsl_options'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'method'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'als'</span><span class="p">,</span> <span class="s1">'sgd'</span><span class="p">]},</span></span>
<span class="code-line">              <span class="s1">'k'</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'min_k'</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'random_state'</span><span class="p">:</span> <span class="p">[</span><span class="n">seed_value</span><span class="p">],</span></span>
<span class="code-line">              <span class="s1">'sim_options'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'name'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'pearson_baseline'</span><span class="p">],</span></span>
<span class="code-line">                              <span class="s1">'min_support'</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span></span>
<span class="code-line">                              <span class="s1">'shrinkage'</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}}</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Grid search parameters:'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">param_grid</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">KNNBaseline HPO using Grid Search:</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Grid search parameters:</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre><span class="code-line">{'bsl_options': {'method': ['als', 'sgd']},</span>
<span class="code-line"> 'k': [30, 35, 40, 45, 50],</span>
<span class="code-line"> 'min_k': [20, 25],</span>
<span class="code-line"> 'random_state': [42],</span>
<span class="code-line"> 'sim_options': {'name': ['pearson_baseline'],</span>
<span class="code-line">  'min_support': [5, 10],</span>
<span class="code-line">  'shrinkage': [0, 100]}}</span></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Now we can run the grid search with  <code>rmse</code> and  <code>mae</code> as the metrics. Then examine the parameters that resulted in the lowest  <code>rmse</code>.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">gs</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">KNNBaseline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">,</span> <span class="s1">'mae'</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span></span>
<span class="code-line">                  <span class="n">joblib_verbose</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Start time for iterating grid search parameters..'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">search_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span></span>
<span class="code-line"><span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Finished iterating grid search parameters:'</span><span class="p">,</span></span>
<span class="code-line">      <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">search_time_start</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Model with lowest RMSE:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_score</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">])</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Parameters with the lowest RMSE:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_params</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">])</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Start time for iterating grid search parameters..</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="code-line">[Parallel(n_jobs=5)]: Using backend LokyBackend with 5 concurrent workers.</span>
<span class="code-line">[Parallel(n_jobs=5)]: Done  62 tasks      | elapsed: 11.1min</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Finished iterating grid search parameters: 2447.833321094513</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Model with lowest RMSE:</span>
<span class="code-line">0.9453110845949882</span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line">Parameters with the lowest RMSE:</span>
<span class="code-line">{'bsl_options': {'method': 'sgd'}, 'k': 40, 'min_k': 20, 'random_state': 42, 'sim_options': {'name': 'pearson_baseline', 'min_support': 5, 'shrinkage': 100, 'user_based': True}}</span>
</pre>
</div>
</div>
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stderr output_text">
<pre><span class="code-line">[Parallel(n_jobs=5)]: Done 240 out of 240 | elapsed: 40.7min finished</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Then use the parameters that resulted in the lowest  <code>rmse</code> on the train/test sets, predict, apply functions and save the prediction results.<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">algo</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">best_estimator</span><span class="p">[</span><span class="s1">'rmse'</span><span class="p">]</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">predictions</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">test</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'RMSE from fit best parameters on train predict on test:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">))</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span></span>
<span class="code-line"><span class="n">dump</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">'./KNNBaseline_bestGrid_Model_file'</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">algo</span><span class="p">)</span></span>
<span class="code-line"><span class="c1">#predictions, algo = dump.load('./KNNBaseline_bestGrid_Model_file')</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">,</span> <span class="s1">'rui'</span><span class="p">,</span> <span class="s1">'est'</span><span class="p">,</span></span>
<span class="code-line">                                         <span class="s1">'details'</span><span class="p">])</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Iu'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reviewer_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ir</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'Ui'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_Ri</span><span class="p">)</span></span>
<span class="code-line"><span class="n">df1</span><span class="p">[</span><span class="s1">'err'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">est</span> <span class="o">-</span> <span class="n">df1</span><span class="o">.</span><span class="n">rui</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'right'</span><span class="p">,</span></span>
<span class="code-line">               <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">],</span></span>
<span class="code-line">               <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">'reviewer_id'</span><span class="p">,</span> <span class="s1">'item_id'</span><span class="p">])</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">df1</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Estimating biases using sgd...</span>
<span class="code-line">Computing the pearson_baseline similarity matrix...</span>
<span class="code-line">Done computing similarity matrix.</span>
<span class="code-line">RMSE from fit best parameters on train predict on test:</span>
<span class="code-line">RMSE: 0.9379</span>
<span class="code-line">0.9378743356689234</span>
<span class="code-line"></span>
<span class="code-line"></span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">We can examine the top 10 best predictions:<font size=""></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">best_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Best 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">best_predictions</span><span class="p">)</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Best 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">90940   B00O2IZPD8      211  A2Q9961GP0RMBT         4608  5.0  5.0   </span>
<span class="code-line">159489  6303686761    14836   AZIV57ZFSUYI6        18439  5.0  5.0   </span>
<span class="code-line">134670  B000063EME     3672   AN49MA84I1W13        12176  5.0  5.0   </span>
<span class="code-line">41605   B00C888NFQ       90  A2EQRK5VKWY4UL         5787  5.0  5.0   </span>
<span class="code-line">214781  B00FEP9PQG      188   AKWS79G5WUYUE        16444  5.0  5.0   </span>
<span class="code-line">14334   079073463X     1319  A3MQAQT8C6D1I7         7397  5.0  5.0   </span>
<span class="code-line">41607   B000UFIYQ2     8628  A1QWQF0CXTE41E          602  5.0  5.0   </span>
<span class="code-line">200020  B000CDSS18    17834  A2XOH1PC423E2S         8201  5.0  5.0   </span>
<span class="code-line">41613   B00FR23GPW     7599   AJC05Q1I8IG0U         8629  5.0  5.0   </span>
<span class="code-line">91520   B00HEPCRLE      874  A12XYDOWQA4H5B         6810  5.0  5.0   </span>
<span class="code-line"></span>
<span class="code-line">                                          details   Iu   Ui  err  </span>
<span class="code-line">90940    {'actual_k': 6, 'was_impossible': False}   48  231  0.0  </span>
<span class="code-line">159489   {'actual_k': 2, 'was_impossible': False}   17   26  0.0  </span>
<span class="code-line">134670   {'actual_k': 0, 'was_impossible': False}   24   54  0.0  </span>
<span class="code-line">41605    {'actual_k': 1, 'was_impossible': False}   40  152  0.0  </span>
<span class="code-line">214781   {'actual_k': 2, 'was_impossible': False}   20   96  0.0  </span>
<span class="code-line">14334    {'actual_k': 2, 'was_impossible': False}   35   96  0.0  </span>
<span class="code-line">41607    {'actual_k': 0, 'was_impossible': False}  133    7  0.0  </span>
<span class="code-line">200020   {'actual_k': 0, 'was_impossible': False}   33    4  0.0  </span>
<span class="code-line">41613    {'actual_k': 0, 'was_impossible': False}   33   31  0.0  </span>
<span class="code-line">91520   {'actual_k': 25, 'was_impossible': False}   35  261  0.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>   <font size="4">Let's examine the worst 10 predictions as well:<font></font></font></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span class="code-line"><span></span><span class="n">worst_predictions</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'err'</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="s1">'Worst 10 predictions:'</span><span class="p">)</span></span>
<span class="code-line"><span class="nb">print</span><span class="p">(</span><span class="n">worst_predictions</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="k">del</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">best_predictions</span><span class="p">,</span> <span class="n">worst_predictions</span></span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="code-line">Worst 10 predictions:</span>
<span class="code-line">              item  item_id      reviewerID  reviewer_id  rui  est  \</span>
<span class="code-line">199613  B00005JO20      733  A167KI3P7XN1AM         2527  1.0  5.0   </span>
<span class="code-line">111347  B000J10F8C    20835  A33RN6T49VEFUO          302  1.0  5.0   </span>
<span class="code-line">128997  B019T8QBR4      700  A2BXZJPLOTMI5A         7822  1.0  5.0   </span>
<span class="code-line">13429   6304961693     2718   AK2FSJJ7GAN8B        10089  1.0  5.0   </span>
<span class="code-line">135680  B00007K027    23913  A192UPT6KST3E2          804  1.0  5.0   </span>
<span class="code-line">105987  B00FF9SKSK      388   AE35V0M480BBV         9570  1.0  5.0   </span>
<span class="code-line">145506  6304178360     8074   AWG2O9C42XW5G           10  1.0  5.0   </span>
<span class="code-line">44675   B00008MTW7     4328   AXOIYNI70LPN1         5849  1.0  5.0   </span>
<span class="code-line">64715   B00G3D732Q      100  A3JDBLJIN704EW         3907  1.0  5.0   </span>
<span class="code-line">201633  B0009PW4D2     1842  A2JHYW5V7UFIQ2         3958  5.0  1.0   </span>
<span class="code-line"></span>
<span class="code-line">                                          details    Iu   Ui  err  </span>
<span class="code-line">199613   {'actual_k': 5, 'was_impossible': False}    65  417  4.0  </span>
<span class="code-line">111347   {'actual_k': 0, 'was_impossible': False}   218    5  4.0  </span>
<span class="code-line">128997   {'actual_k': 4, 'was_impossible': False}    34  114  4.0  </span>
<span class="code-line">13429    {'actual_k': 0, 'was_impossible': False}    30   87  4.0  </span>
<span class="code-line">135680   {'actual_k': 0, 'was_impossible': False}   122    5  4.0  </span>
<span class="code-line">105987   {'actual_k': 0, 'was_impossible': False}    25  299  4.0  </span>
<span class="code-line">145506   {'actual_k': 8, 'was_impossible': False}  1307   38  4.0  </span>
<span class="code-line">44675    {'actual_k': 1, 'was_impossible': False}    40   71  4.0  </span>
<span class="code-line">64715   {'actual_k': 26, 'was_impossible': False}    49  452  4.0  </span>
<span class="code-line">201633   {'actual_k': 0, 'was_impossible': False}    54   29  4.0  </span>
</pre>
</div>
</div>
</div>
</div>
</div>

<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'adataschultz'; // required: replace example with your forum shortname

            var disqus_config = function () {
                this.language = "en";

                        this.page.identifier = '2023-06-15-second-post';
                        this.page.url = 'https://adataschultz.github.io/second-post.html';
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="https://github.com/adataschultz/" target="_blank">Github</a>
    </li>
    <li class="list-group-item">
      <a href="https://www.linkedin.com/in/andrew-schultz-mph-22a88b60/" target="_blank">Linkedin</a>
    </li>
    <li class="list-group-item">
      <a href="https://www.researchgate.net/profile/Andrew-Schultz-2" target="_blank">ResearchGate</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2023 Andrew Schultz
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>                <p><small>  <a rel="license" href="https://creativecommons.org/licenses/{'name': 'creative commons attribution-sharealike', 'version': '4.0', 'slug': 'by-sa'}/4.0/deed.en"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/{'name': 'creative commons attribution-sharealike', 'version': '4.0', 'slug': 'by-sa'}/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/{'name': 'creative commons attribution-sharealike', 'version': '4.0', 'slug': 'by-sa'}/4.0/deed.en">Creative Commons Attribution{'name': 'creative commons attribution-sharealike', 'version': '4.0', 'slug': '-ShareAlike'} 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://adataschultz.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://adataschultz.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://adataschultz.github.io/theme/js/respond.min.js"></script>


    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'adataschultz'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->


</body>
</html>